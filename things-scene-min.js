!function e(t,n,r){function o(a,u){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){(function(t){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/things-scene"),i=r(o);n["default"]=i,"undefined"!=typeof window&&(window.scene=i),"undefined"!=typeof t&&(t.scene=i)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./src/things-scene":129}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){return function(n){return 1-e(1-n,t)}}function i(e,t){return function(n){return.5>n?e(2*n,t)/2:(2-e(2*(1-n),t))/2}}function a(e){var t=e.duration,n=void 0===t?1e3:t,r=(e.delay,e.step),a=e.delta,u=e.ease,l=e.options,c=e.repeat,f=void 0===c?!1:c;"string"==typeof a&&(a=s["default"][a]),"out"==u?a=o(a,l):"inout"==u&&(a=i(a,l));var h=!1;return{start:function(){var e=this;if(h)return this;h=!0;var t=new Date,o=function i(){if(h){var o=new Date-t,u=o/n,s=f?u%1:Math.min(u,1);r(a(s,l)),!(u>=1)||f&&h||e.stop(),h&&requestAnimationFrame(i)}};return requestAnimationFrame(o),this},stop:function(){return h=!1,this}}}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=a;var u=e("./delta"),s=r(u)},{"./delta":10}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){return function(n){return 1-e(1-n,t)}}function a(e,t){return function(n){return.5>n?e(2*n,t)/2:(2-e(2*(1-n),t))/2}}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../delta"),l=r(s),c=function(){function e(t,n){o(this,e),this.client=t,this.config=n,this._started=!1;var r=this.config,u=r.delta,s=void 0===u?"linear":u,c=r.options,f=r.ease;"string"==typeof s&&(this.delta=l["default"][s]),"out"==f?this.delta=i(s,c):"inout"==f&&(this.delta=a(s,c)),this.init()}return u(e,[{key:"dispose",value:function(){this.stop(),delete this.client}},{key:"init",value:function(){}},{key:"start",value:function(){var e=this,t=this.config,n=t.duration,r=void 0===n?2e3:n,o=t.delay,i=void 0===o?0:o,a=t.repeat,u=void 0===a?!1:a;setTimeout(function(){e.stop(),e._started=!0;var t=new Date,n=function o(){if(e._started){var n=new Date-t,i=n/r,a=u?i%1:Math.min(i,1);e.step(e.delta(a)),e.client&&e.client.invalidate(),!(i>=1)||u&&e._started||e.stop(),e._started&&requestAnimationFrame(o)}};requestAnimationFrame(n)},i)}},{key:"stop",value:function(){this._started=!1}},{key:"started",get:function(){return this._started},set:function(e){this.started!=!!e&&(e?this.start():this.stop())}}]),e}();n["default"]=c},{"../delta":10}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./animation"),l=r(s),c=20,f=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"init",value:function(){var e=this.config.cycle,t=void 0===e?c:e;this.state={count:0,delta:((this.config.scale||1.05)-1)/(t/2)}}},{key:"step",value:function(e){var t=this.config.cycle,n=void 0===t?c:t;this.state.count=(this.state.count+1)%n;var r,o=this.state,i=o.count,e=o.delta;r=n/2>i?1+e*i:1+e*(n-i),this.client.delta("sx",r),this.client.delta("sy",r)}}]),t}(l["default"]);n["default"]=f},{"./animation":3}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./animation"),l=r(s),c=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"step",value:function(e){var t=this.config,n=t.x,r=void 0===n?0:n,o=t.y,i=void 0===o?0:o;this.client.delta("tx",e*r),this.client.delta("ty",e*i)}}]),t}(l["default"]);n["default"]=c},{"./animation":3}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./animation"),l=r(s),c=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"step",value:function(e){var t=this.config.rideOn,n=this.client;if(t&&n&&n.root){var r=n.center,o=n.root.findById(t);if(o){var i=o.outline(e),r=n.transcoordS2T(r.x,r.y);o&&(n.delta("tx",i.x-r.x),n.delta("ty",i.y-r.y))}}}}]),t}(l["default"]);n["default"]=c},{"./animation":3}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./animation"),l=r(s),c=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"step",value:function(e){var t=this.config.theta,n=void 0===t?1:t;this.client.delta("theta",e*n)}}]),t}(l["default"]);n["default"]=c},{"./animation":3}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./animation"),l=r(s),c=4,f=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"init",value:function(){var e=this.config.cycle,t=void 0===e?c:e;this.state={count:0,delta:(this.config.tilt||2*Math.PI/180)/(t/2)}}},{key:"step",value:function(e){var t=this.config.cycle,n=void 0===t?c:t;this.state.count=(this.state.count+1)%n;var r,o=this.state,i=o.count,e=o.delta;r=1*n/4>i?-e*i:3*n/4>i?e*(i-1*n/2):e*(n-i),this.client.delta("theta",r)}}]),t}(l["default"]);n["default"]=f},{"./animation":3}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=y[t.type];return n?new n(e,t):null}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o;var i=e("./animations/rotation"),a=r(i),u=e("./animations/vibration"),s=r(u),l=e("./animations/heartbeat"),c=r(l),f=e("./animations/moving"),h=r(f),d=e("./animations/outline"),p=r(d),y={rotation:a["default"],vibration:s["default"],heartbeat:c["default"],moving:h["default"],outline:p["default"]}},{"./animations/heartbeat":4,"./animations/moving":5,"./animations/outline":6,"./animations/rotation":7,"./animations/vibration":8}],10:[function(e,t,n){"use strict";function r(e){return e}function o(e){return Math.pow(e,2)}function i(e){return 1-Math.sin(Math.acos(e))}function a(e,t){return Math.pow(e,2)*((t.x+1)*e-t.x)}function u(e){for(var t=0,n=1;1;t+=n,n/=2)if(e>=(7-4*t)/11)return-Math.pow((11-6*t-11*e)/4,2)+Math.pow(n,2)}function s(e,t){return Math.pow(2,10*(e-1))*Math.cos(20*Math.PI*t.x/3*e)}Object.defineProperty(n,"__esModule",{value:!0}),n.linear=r,n.quad=o,n.circ=i,n.back=a,n.bounce=u,n.elastic=s,n["default"]={linear:r,quad:o,circ:i,back:a,bounce:u,elastic:s}},{}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./compile");Object.defineProperty(n,"compile",{enumerable:!0,get:function(){return r(o)["default"]}})},{"./compile":9}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./command"),l=r(s),c=(e("../core/utils"),function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"execute",value:function(){this.params.changes.forEach(function(e){return e.component.set(e.after)})}}],[{key:"before",value:function(e){return e.map(function(e){return{component:e}})}},{key:"after",value:function(e,t){t.execute(null,!1)}},{key:"around",value:function(e,t,n,r){n.call(r),t.execute(null,!1)}}]),t}(l["default"]));n["default"]=c},{"../core/utils":69,"./command":14}],13:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){if(e.isRootModel())return e.bounds;var t=e.bounds,n=e.rotatePoint,r=n;return r=e.transcoordS2T(r.x,r.y),{left:r.x-(n.x-t.left),top:r.y-(n.y-t.top),width:t.width,height:t.height}}function s(e,t){if(t.isRootModel())return e.bounds;var n=e.bounds,r=e.rotatePoint,o=t.transcoordT2S(r.x,r.y),i=t.bounds;return{left:o.x-(r.x-n.left)-i.left,top:o.y-(r.y-n.top)-i.top,width:n.width,height:n.height}}function l(e){for(var t=0;e&&!e.isRootModel();)t+=e.get("rotation")||0,e=e.parent;return t%(2*Math.PI)}function c(e,t){var n=e.get("rotation")||0,r=l(t);return(n-r)%(2*Math.PI)}Object.defineProperty(n,"__esModule",{value:!0});var f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h=e("../components/component"),d=(r(h),e("./command")),p=r(d),y=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),f(t,[{key:"execute",value:function(){var e=this.params.changes;e.forEach(function(e){var t=e.component,n=e.to_container,r=e.to_index,o=e.to_left,i=e.to_top,a=(e.hint,u(t)),f=l(t);if(t.removeSelf(!n),t.bounds=a,t.set("rotation",f),n){t.set("rotation",c(t,n));var h=s(t,n);e.to_left=void 0!==o?o:h.left,e.to_top=void 0!==i?i:h.top,t.bounds={left:e.to_left,top:e.to_top,width:h.width,height:h.height},"undefined"==typeof r?n.addComponent(t):n.insertComponentAt(t,r)}})}}]),t}(p["default"]);n["default"]=y},{"../components/component":17,"./command":14}],14:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t){r(this,e),this.params=Object.assign({},t)}return o(e,[{key:"excute",value:function(){}},{key:"merge",value:function(){return null}}]),e}();n["default"]=i},{}],15:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){var n=t.model_layer.get("scale"),r=t.model_layer.get("translate");if(e){var o=JSON.parse(e);o.scale=n,o.translate=r,t.rebuildContentModel(o)}}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../core"),l=o(s),c=e("../core/timecapsule"),f=r(c),h=e("../core/snapshot-taker"),d=r(h),p=function(){function e(t){i(this,e),this.container=t,this.timecapsule=new f["default"](20);var n=this;this.snapshot_taker=new d["default"]({get state(){var e=n.container.model_layer.hierarchy;return JSON.stringify(e)}},this.timecapsule),this.snapshot_taker.take(!0)}return u(e,[{key:"dispose",value:function(){this.reset(),this.timecapsule.dispose(),this.snapshot_taker.dispose(),delete this.snapshot}},{key:"execute",value:function(e,t){t!==!1&&e&&e.execute(),this.snapshot_taker.touch(),this.trigger("execute",e,!0,!1)}},{key:"undo",value:function(){this.timecapsule.backwardable&&(a(this.timecapsule.backward(),this.container),this.trigger("undo",this.undoable(),this.redoable()))}},{key:"redo",value:function(){this.timecapsule.forwadable&&(a(this.timecapsule.forward(),this.container),this.trigger("redo",this.undoable(),this.redoable()))}},{key:"undoable",value:function(){return this.timecapsule.backwardable}},{key:"redoable",value:function(){return this.timecapsule.forwardable}},{key:"reset",value:function(){this.timecapsule.reset(),this.trigger("command-reset")}}]),e}();n["default"]=p,l.mixin(p.prototype,l.event.withEvent)},{"../core":60,"../core/snapshot-taker":66,"../core/timecapsule":68}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=n.createCanvas=void 0;n.createCanvas=r="undefined"==typeof document?function(e,t){return new Canvas(e,t)}:function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n}},{}],17:[function(require,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_selector=require("../model/selector"),selector=_interopRequireWildcard(_selector),_core=require("../core"),core=_interopRequireWildcard(_core),_animation2=require("../animation"),animation=_interopRequireWildcard(_animation2),_effect2=require("../effect"),_effect3=_interopRequireDefault(_effect2),_utils=require("../core/utils"),utils=_interopRequireWildcard(_utils),_deepEquals=require("../core/deep-equals"),_deepEquals2=_interopRequireDefault(_deepEquals),_logger=require("../core/logger"),_memoize=require("../core/memoize"),memoize=_interopRequireWildcard(_memoize),_animate2=require("../animation/animate"),_animate3=_interopRequireDefault(_animate2),_shadow=require("../effect/shadow"),_union=require("./geometry/union"),_union2=_interopRequireDefault(_union),_canvas=require("./canvas/canvas"),_fill=require("./drawer/fill"),_pathOutline=require("./outline/path-outline"),_pathOutline2=_interopRequireDefault(_pathOutline),_stroke=require("./drawer/stroke"),_stroke2=_interopRequireDefault(_stroke),_effect4=require("./drawer/effect"),_effect5=_interopRequireDefault(_effect4),_format=require("./drawer/format"),_format2=_interopRequireDefault(_format),_text=require("./drawer/text"),_path=require("./mutater/path"),_path2=_interopRequireDefault(_path),_bounds3=require("./mutater/bounds"),_bounds4=_interopRequireDefault(_bounds3),_data=require("./data/data"),_transcoord=require("./geometry/transcoord"),registry={},NATURE={mutable:!1,resizable:!0,rotatable:!0,properties:[]},VOLATILE_PROPS=[],DEFALUT_DELTA={theta:0,tx:0,ty:0,sx:1,sy:1},Component=function(){function Component(e,t){if(_classCallCheck(this,Component),this._app=t,this._model=e,this._delta=utils.clone(DEFALUT_DELTA),t&&this.animOnCreate&&this.animOnCreate.start(),this.clearCache(),this.retension&&this.app.isViewMode&&!this.isTemplate()){this.touch();var n=this;this.remover=setTimeout(function r(){var e=Date.now();e-n.updatedAt>=n.retension?n.removeSelf(!0):n.remover=setTimeout(r,n.updatedAt+n.retension-e)},this.retension)}}return _createClass(Component,null,[{key:"register",value:function(e,t){return t?void(registry[e]=t):registry[e]}}]),_createClass(Component,[{key:"created",value:function(){}},{key:"added",value:function(){}},{key:"removed",value:function(){}},{key:"touch",value:function(){this.updatedAt=Date.now()}},{key:"clearCache",value:function(){memoize.reset(this)}},{key:"removeSelf",value:function(e){this.parent&&this.parent.removeComponent(this),e&&this.dispose()}},{key:"dispose",value:function(){this._animOnChange&&(this._animOnChange.dispose(),delete this._animOnChange),this._animOnCreate&&(this._animOnCreate.dispose(),delete this._animOnCreate),this.destroyMappings(),this.remover&&clearTimeout(this.remover),this._disposed=!0}},{key:"isLayer",value:function(){return!1}},{key:"isGroup",value:function(){return!1}},{key:"isContainer",value:function(){return!1}},{key:"isLine",value:function(){return!1}},{key:"isRoot",value:function(){return!1}},{key:"isRootModel",value:function(){return!1}},{key:"is3dish",value:function(){return!1}},{key:"isTemplate",value:function(){return!!this.get("templatePrefix")}},{key:"get",value:function(e){return this._model[e]}},{key:"set",value:function(e,t){if("string"==typeof e)return this.set(_defineProperty({},e,t));var n={},r={},o=!1,e=utils.clone(e),i=this;return Object.getOwnPropertyNames(e).forEach(function(t){var a=i._model[t],u=e[t];_deepEquals2["default"](a,u)||(r[t]=a,n[t]=u,i._model[t]=u,o=!0)}),o&&(this.clearCache(),this.onchangeFill(n,r),this.onchangeMappings(n,r),this.onchangeData(n,r),this.onchange&&this.onchange(n,r),this.trigger("change",n,r)),this}},{key:"getContext",value:function(){return this._parent.getContext()}},{key:"outline",value:function(e){return _pathOutline2["default"](this,e||0)}},{key:"contains",value:function(e,t){var n=this.bounds,r=n.left,o=n.top,i=n.width,a=n.height;return e<Math.max(r+i,r)&&e>Math.min(r+i,r)&&t<Math.max(o+a,o)&&t>Math.min(o+a,o)}},{key:"adjustResize",value:function(e,t,n){if(n){var r=this.bounds,o=r.height/r.width,i=e.width-r.width,a=e.height-r.height;i*o>a?a=i*o:i=a/o;var u=e.left-r.left,s=e.top-r.top;return 0!=u&&0!=s?(s=-a,u=-i):0!=u?u=-i:0!=s&&(s=-a),{left:r.left+u,top:r.top+s,width:r.width+i,height:r.height+a}}return e}},{key:"adjustRotation",value:function(e,t){if(t||this.app.rotateStepForced){var n=this.app.rotateStep;return Math.floor((e+n/2)/n)*n}return e}},{key:"findFirst",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];return e.apply(void 0,[this].concat(n))?this:void 0}},{key:"findAll",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];return"string"==typeof e?selector.select(e,this,n[0]||this):"function"==typeof e&&e.apply(void 0,[this].concat(n))?[this]:void 0}},{key:"capture",value:function(e,t){if(!this.capturable)return!1;var n=this.transcoordP2S(e,t);return this.contains(n.x,n.y)?this:void 0}},{key:"prepare",value:function(e){e(this)}},{key:"prepareIf",value:function(e){var t=this;e&&this.prepare&&this.prepare(function(){t.invalidate()},function(e){_logger.error(e)})}},{key:"draw",value:function(e){e.save(),this._pre_draw(e),this._draw(e),this._post_draw(e),e.restore()}},{key:"delta",value:function(e,t){return void 0===t?e?this._delta[e]:this._delta:void(this._delta[e]=t)}},{key:"_pre_draw",value:function(e){var t=this.rotatePoint,n=this.model,r=n.scale,o=n.rotation,i=n.shadow,a=n.hidden,u=(r&&r.x||1)*this._delta.sx,s=(r&&r.y||1)*this._delta.sy,l=(o||0)+this._delta.theta,c=this._delta,f=c.tx,h=void 0===f?0:f,d=c.ty,p=void 0===d?0:d;(h||p)&&e.translate(h,p),(1!=u||1!=s||l)&&(e.translate(t.x,t.y),(1!=u||1!=s)&&e.scale(u,s),l&&e.rotate(l),e.translate(-t.x,-t.y)),i&&_shadow.setShadow(e,i,this),a&&(e.globalAlpha*=.5)}},{key:"_draw",value:function(){}},{key:"_post_draw",value:function(e){this.drawText(e)}},{key:"drawText",value:function(e){!this.textHidden&&this.text&&this.hasTextProperty&&_text.drawText(e,this.textBounds,this.textLines(e),this.model)}},{key:"drawStroke",value:function(e){_stroke2["default"](e,this.model)}},{key:"drawFill",value:function(e){this.fillStyle&&"transparent"!=this.fillStyle&&(_fill.drawFill(e,this.bounds,this.center,this.model,this),_shadow.resetShadow(e))}},{key:"animate",value:function(e){return this._animate&&this._animate.stop(),this._animate=_animate3["default"](e),this._animate}},{key:"move",value:function(e){var t=e.x,n=e.y,r=this.path,o=t,i=n;this.path=r.map(function(e){return{x:e.x+o,y:e.y+i}})}},{key:"symmetryX",value:function(e){"number"!=typeof e&&(e=this.center.x);var t=this.model.rotation,n=this.fillStyle;if(this.set("rotation",2*Math.PI-t),n&&"gradient"===n.type&&"linear"===n.gradientType){var r=utils.clone(n);r.rotation=(Math.PI-parseFloat(n.rotation||0))%(2*Math.PI),this.set("fillStyle",r)}this.path=this.path.map(function(t){return{x:2*e-t.x,y:t.y}})}},{key:"symmetryY",value:function(e){this.symmetryX(),this.set("rotation",(Math.PI+this.model.rotation)%(2*Math.PI)),e&&this.move({x:0,y:2*(e-this.center.y)})}},{key:"_animation",value:function(e){var t=(this.model.animation||{})[e];return t?animation.compile(this,t):void 0}},{key:"effect",value:function(e,t){return _effect3["default"](this,e,t)}},{key:"invalidate",value:function(){this.parent&&this.parent.invalidate()}},{key:"substitute",value:function substitute(expression){var _this2=this,text=String(expression);try{var matches=text.match(/#{(\S*)}/gi);matches&&matches.forEach(function(match){var expression=match.substr(2,match.length-3).trim(),tuples=expression.match(/[\w-$ ]*/),property=tuples[0],value=_this2.model[property];property.length<expression.length&&(expression=expression.replace("(","*"),eval(expression.replace(property,"value = value"))),value=utils.objToVal(value),void 0===value&&(value=""),text=text.replace(match,value)}),matches=text.match(/\${[^}]*}/gi),matches&&matches.forEach(function(match){var expression=match.substr(2,match.length-3).trim(),tuples=expression.match(/[\w-$ ]*/),id=tuples[0],component=_this2.root.findById(id),value=component&&component.data;id.length<expression.length&&(expression=expression.replace("(","*"),eval(expression.replace(id,"value = value"))),value=utils.objToVal(value),void 0===value&&(value=""),text=text.replace(match,value)})}catch(e){_logger.error(e)}return text}},{key:"textLines",value:function(e){return _text.textLines(e||this.getContext(),this.textBounds.width,this.font,this.text,this.get("textWrap"))}},{key:"trim",value:function(){delete this._model[""],"chartjs"!==this._model.type&&delete this._model.chart}},{key:"serialize",value:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return JSON.stringify.apply(JSON,[this.hierarchy].concat(t))}},{key:"nature",get:function(){return NATURE}},{key:"disposed",get:function(){return!!this._disposed}},{key:"retension",get:function(){return Number(this.get("retension"))||0}},{key:"hasTextProperty",get:function(){return!0}},{key:"app",get:function(){return!this._app&&this.parent&&(this._app=this.parent.app),this._app}},{key:"model",get:function(){return this._model}},{key:"hierarchy",get:function(){var e=utils.clone(this._model);return this["volatile"].forEach(function(t){delete e[t]}),e}},{key:"volatile",get:function(){return VOLATILE_PROPS}},{key:"textHidden",get:function(){return!!this._textHidden},set:function(e){this._textHidden=!!e,this.invalidate()}},{key:"root",get:function(){return this.isRoot()?this:this.parent&&this.parent.root}},{key:"rootModel",get:function(){return this.isRootModel()?this:this.parent&&this.parent.rootModel}},{key:"parent",get:function(){return this._parent},set:function(e){this._parent=e}},{key:"center",get:function(){var e=this.bounds;return{x:e.left+e.width/2,y:e.top+e.height/2}},set:function(e){var t=this.center;if(Math.round(100*e.x)/100!=Math.round(100*t.x)/100||Math.round(100*e.y)/100!=Math.round(100*t.y)/100){var n=e.x-t.x,r=e.y-t.y;this.path=this.path.map(function(e){return{x:e.x+n,y:e.y+r}})}}},{key:"location",get:function(){return this.center},set:function(e){this.center=e}},{key:"dimension",get:function(){return this.get("dimension")},set:function(e){this.set("dimension",e)}},{key:"bounds",get:function(){var e,t,n,r,o=this.path;e=t=o[0].x,n=r=o[0].y;for(var i=1;i<o.length;i++){var a=o[i];a.x<e?e=a.x:a.x>t&&(t=a.x),a.y<n?n=a.y:a.y>r&&(r=a.y)}return{left:e,top:n,width:t-e,height:r-n}},set:function(e){var t=this.bounds;if(Math.round(100*e.width)/100!=Math.round(100*t.width)/100||Math.round(100*e.height)/100!=Math.round(100*t.height)/100||Math.round(100*e.left)/100!=Math.round(100*t.left)/100||Math.round(100*e.top)/100!=Math.round(100*t.top)/100){var n={x:0==t.width?1:e.width/t.width,y:0==t.height?1:e.height/t.height};this.path=this.path.map(function(r){return{x:e.left+(r.x-t.left)*n.x,y:e.top+(r.y-t.top)*n.y}})}}},{key:"path",get:function(){return _logger.error("이 컴포넌트에 get path 가 구현되어있지 않음.",this),[]},set:function(){_logger.error("이 컴포넌트에 get path 가 구현되어있지 않음.",this)}},{key:"anchors",get:function(){return[]}},{key:"strokeStyle",get:function(){return this.get("strokeStyle")},set:function(e){this.set("strokeStyle",e)}},{key:"fillStyle",get:function(){return this.get("fillStyle")},set:function(e){this.set("fillStyle",e)}},{key:"fontColor",get:function(){return this.get("fontColor")},set:function(e){this.set("fontColor",String(utils.objToVal(e)))}},{key:"rotation",get:function(){return this.get("rotation")},set:function(e){this.set("rotation",Number(utils.objToVal(e)))}},{key:"mutable",get:function(){return NATURE.mutable}},{key:"resizable",get:function(){return NATURE.resizable&&!this.stuck}},{key:"rotatable",get:function(){return NATURE.rotatable&&!this.stuck}},{key:"capturable",get:function(){return this.get("capturable")!==!1}},{key:"stuck",get:function(){return!!(this.parent&&this.parent.layout.isStuck(this)||this.get("locked"))}},{key:"hidden",get:function(){return this.app.isViewMode&&this.get("hidden")},set:function(e){this.set("hidden",e)}},{key:"animOnCreate",get:function(){return this.app.isViewMode?this.hasOwnProperty("_animOnCreate")?this._animOnCreate:(this._animOnCreate=this._animation("oncreate"),this._animOnCreate):void 0}},{key:"animOnChange",get:function(){return this.app.isViewMode?this.hasOwnProperty("_animOnChange")?this._animOnChange:(this._animOnChange=this._animation("onchange"),this._animOnChange):void 0}},{key:"started",set:function(e){this._animOnChange&&(this._animOnChange.started=e),
this._animOnCreate&&(this._animOnCreate.started=e)}},{key:"font",get:function(){return _text.font(this.model)}},{key:"lineHeight",get:function(){var e=this.get("lineHeight");return e?e:1.2*this.fontSize}},{key:"text",get:function(){{var e=this.model,t=e.text,n=e.textFormat;e.textCase}return t?(t=this.substitute(t),n&&(t=_format2["default"](n,t)),t):""},set:function(e){this.set("text",String(utils.objToVal(e)))}},{key:"textBounds",get:function(){var e=this.model,t=e.paddingTop,n=void 0===t?0:t,r=e.paddingLeft,o=void 0===r?0:r,i=e.paddingRight,a=void 0===i?0:i,u=e.paddingBottom,s=void 0===u?0:u,l=this.bounds,c=l.left,f=l.top,h=l.width,d=l.height;return{left:c+o,top:f+n,width:Math.max(h-o-a,0),height:Math.max(d-n-s,0)}}},{key:"rotatePoint",get:function(){return this.center}},{key:"value",get:function(){var e=this._model.value;return void 0===e||"number"==typeof e?e||0:Number(this.substitute(e))||0},set:function(e){this.set("value",Number(utils.objToVal(e)))}},{key:"data",get:function(){return this._model.data},set:function(e){this.set("data",e)}},{key:"mappings",get:function(){return!this._mappings&&this.parent&&this.buildMappings(),this._mappings}},{key:"controls",get:function(){}}]),Component}();exports["default"]=Component,Component.union=_union2["default"],Component.transcoordR=_transcoord.transcoordR,Component.transcoordRR=_transcoord.transcoordRR,Component.createCanvas=_canvas.createCanvas,Component.memoize=memoize.intercept,Component.mixin=core.mixin,Component.drawText=_text.drawText,Component.font=_text.font,Component.textLines=_text.textLines,Component.drawStroke=_stroke2["default"],Component.drawFill=_fill.drawFill,Object.assign(Component.prototype,{drawEffect:_effect5["default"],prepareFill:_fill.prepareFill,prepareFillIf:_fill.prepareFillIf,onchangeFill:_fill.onchangeFill,mutateBounds:_bounds4["default"],mutatePath:_path2["default"],onchangeMappings:_data.onchangeMappings,onchangeData:_data.onchangeData,buildMappings:_data.buildMappings,executeMappings:_data.executeMappings,destroyMappings:_data.destroyMappings,transcoordS2P:_transcoord.transcoordS2P,transcoordP2S:_transcoord.transcoordP2S,transcoordS2T:_transcoord.transcoordS2T,transcoordT2S:_transcoord.transcoordT2S,transcoordS2TR:_transcoord.transcoordS2TR,transcoordS2O:_transcoord.transcoordS2O,transcoordC2S:_transcoord.transcoordC2S,transcoordS2C:_transcoord.transcoordS2C}),["rotatePoint","font","lineHeight"].forEach(function(e){return Component.memoize(Component.prototype,e,!1)}),["bounds","center","textBounds"].forEach(function(e){return Component.memoize(Component.prototype,e,!0)}),Component.mixin(Component.prototype,core.event.withEvent)},{"../animation":11,"../animation/animate":2,"../core":60,"../core/deep-equals":58,"../core/logger":62,"../core/memoize":63,"../core/utils":69,"../effect":71,"../effect/shadow":72,"../model/selector":106,"./canvas/canvas":16,"./data/data":20,"./drawer/effect":23,"./drawer/fill":24,"./drawer/format":25,"./drawer/stroke":27,"./drawer/text":29,"./geometry/transcoord":31,"./geometry/union":32,"./mutater/bounds":41,"./mutater/path":42,"./outline/path-outline":44}],18:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function _(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:_(o,t,n)}if("value"in r)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},c=e("./component"),f=o(c),h=e("../model/selector"),d=r(h),p=e("../layout"),y=e("./mixins/rect-path"),v=o(y),m=[],g=function(e){function t(e,n){i(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r._components=[],r}return u(t,e),s(t,[{key:"dispose",value:function(){this.components.forEach(function(e){return e.dispose()}),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispose",this).call(this)}},{key:"isContainer",value:function(){return!0}},{key:"containable",value:function(e){return"variable"!==e.get("type")}},{key:"reflow",value:function(){this.layout.reflow(this),this.components&&this.components.forEach(function(e){e.isContainer()&&e.reflow()})}},{key:"addComponent",value:function(e){var t=e.parent;if(t){if(this===t)return;t.removeComponent(e)}var n=this._components.push(e)-1;e.parent=this,e.added(this),this.trigger("add",this,e,n),e.delegate_on(this),e.trigger("added",this,e,n)}},{key:"removeComponent",value:function(e){var t=this._components.indexOf(e);-1!=t&&(this._components.splice(t,1),e.parent=null,e.removed(this),this.trigger("remove",this,e),e.trigger("removed",this,e),e.delegate_off(this))}},{key:"insertComponentAt",value:function(e,t){var n=e.parent;n&&n.removeComponent(e);var r=this._components.splice(0,t);this._components=r.concat(e,this._components),t=this._components.indexOf(e),e.parent=this,e.added(this),this.trigger("add",this,e,t),e.delegate_on(this),e.trigger("added",this,e,t)}},{key:"add",value:function(e){var t=this;return e instanceof Array?(e.forEach(function(e){-1==t._components.indexOf(e)&&t.addComponent(e)}),this):this.add.call(this,[e])}},{key:"remove",value:function(e){var t=this;return e instanceof Array?this._components?(e.forEach(function(e){t.removeComponent(e)}),this):this:this.remove.call(this,[e])}},{key:"getAt",value:function(e){return this._components?this._components[e]:void 0}},{key:"forEach",value:function(e,t){this._components&&this._components.forEach(e,t)}},{key:"traverse",value:function(e,t){e.call(t,this),this._components&&this._components.forEach(function(n){n.isContainer()?n.traverse(e,t):e.call(t,n)})}},{key:"indexOf",value:function(e){return(this._components||m).indexOf(e)}},{key:"size",value:function(){return(this._components||m).length}},{key:"moveChildAt",value:function(e,t){var n=this.indexOf(t);if(-1!=n){var r=this._components.splice(0,n),o=this._components.splice(1);this._components=r.concat(o),e=Math.max(0,e),e=Math.min(e,this._components.length),r=this._components.splice(0,e),this._components=r.concat(t,this._components)}}},{key:"moveChildForward",value:function(e){var t=this.indexOf(e);-1!=t&&t!=this.size()-1&&(this._components[t]=this._components[t+1],this._components[t+1]=e)}},{key:"moveChildBackward",value:function(e){var t=this.indexOf(e);-1!=t&&0!=t&&(this._components[t]=this._components[t-1],this._components[t-1]=e)}},{key:"moveChildToFront",value:function(e){var t=this.indexOf(e);if(-1!=t&&t!=this.size()-1){var n=this._components.splice(0,t),r=this._components.splice(1);this._components=n.concat(r,this._components)}}},{key:"moveChildToBack",value:function(e){var t=this.indexOf(e);if(-1!=t&&0!=t){var n=this._components.splice(0,t),r=this._components.splice(0);this._components=this._components.concat(n,r)}}},{key:"symmetryX",value:function(e){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"symmetryX",this).call(this,e),this.components.map(function(e){e.symmetryX(0)})}},{key:"findAll",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];if("string"==typeof e)return d.select(e,this,n[0]||this);if("function"==typeof e){for(var o=[],i=this.components.length-1;i>=0;i--){var a,u=(a=this.components[i]).findAll.apply(a,[e].concat(n));u&&(o=o.concat(u))}return e.apply(void 0,[this].concat(n))&&o.push(this),o}}},{key:"findFirst",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];if("string"==typeof e)return d.select(e,this,n[0])[0];if("function"==typeof e){for(var o=this.components.length-1;o>=0;o--){var i,a=(i=this.components[o]).findFirst.apply(i,[e].concat(n));if(null!=a)return a}return e.apply(void 0,[this].concat(n))?this:null}}},{key:"findById",value:function(e){return this.root.findById(e)}},{key:"contains",value:function(e,t){var n=this.bounds,r=n.left,o=n.top,i=n.width,a=n.height,u=this.stuck?0:10;return e<Math.max(r+i,r)+u&&e>Math.min(r+i,r)-u&&t<Math.max(o+a,o)+u&&t>Math.min(o+a,o)-u}},{key:"capture",value:function(e,t){var n=this.transcoordP2S(e,t);if(!this.contains(n.x,n.y))return!1;var r=this.bounds;n.x-=r.left,n.y-=r.top;for(var o=this.layout.capturables(this),i=o.length-1;i>=0;i--){var a=o[i].capture(n.x,n.y);if(a)return a}return this.capturable&&this}},{key:"capturePath",value:function(e,t){if(t){if(t.indexOf(this)>-1)return!1;for(var n=0;n<t.length;n++)if(!this.containable(t[n]))return!1}for(var r=[],o=this.bounds,i=o.left,a=o.top,u=o.width,s=o.height,l=0;l<e.length;l++){var c=this.transcoordP2S(e[l].x,e[l].y);if(c.x<i||c.x>i+u||c.y<a||c.y>a+s)return!1;c.x-=i,c.y-=a,r.push(c)}for(var f=this.layout.capturables(this),h=f.length-1;h>=0;h--){var d=f[h];if(d.isContainer()){var p=d.capturePath(r,t);if(p)return p}}return this.focusible&&this}},{key:"_draw",value:function(e){var t=this.bounds,n=t.left,r=void 0===n?0:n,o=t.top,i=void 0===o?0:o,a=t.width,u=t.height;e.beginPath(),e.rect(r,i,a,u)}},{key:"_post_draw",value:function(e){this.drawFill(e),this.drawStroke(e);{var t=this.model,n=t.top,r=t.left;t.scale}e.translate(r,n),this.layout.drawables(this).forEach(function(t){t.draw(e)}),e.translate(-r,-n),this.drawText(e)}},{key:"trim",value:function(){this.components.forEach(function(e){e.trim()}),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"trim",this).call(this)}},{key:"hasTextProperty",get:function(){return!1}},{key:"components",get:function(){return this._components}},{key:"focusible",get:function(){return!0}},{key:"layout",get:function(){return p.Layout.get(this.get("layout"))||p.AbsoluteLayout}},{key:"hierarchy",get:function(){var e=l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"hierarchy",this);return this.components&&(e.components=this.components.map(function(e){return e.hierarchy})),e}}]),t}(v["default"](f["default"]));n["default"]=g,["layout"].forEach(function(e){return f["default"].memoize(g.prototype,e,!1)}),f["default"].register("container",g)},{"../layout":99,"../model/selector":106,"./component":17,"./mixins/rect-path":39}],19:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){switch(e){case"fillStyle":case"strokeStyle":return"string";default:return}}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("./evaluator"),s=r(u),l=function(){function e(t,n){o(this,e),this.owner=n,this.model=t}return a(e,[{key:"model",get:function(){return this._model},set:function(e){var t=(e.target,e.property),n=e.rule,r=e.param;this._model=e,this.evaluator=s["default"](this,this.owner,n,r,i(t))}},{key:"target",get:function(){return this.model.target}},{key:"property",get:function(){return this.model.property}},{key:"param",get:function(){return this.model.param}},{key:"accessor",get:function(){return this.model.accessor}}]),e}();n["default"]=l},{"./evaluator":21}],20:[function(require,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function executeMappings(){var _this=this;this.mappings&&this.mappings.forEach(function(mapping){try{var data=_this.data;if(mapping.accessor){var accessor=mapping.accessor;eval("["==accessor[0]?"data = data"+accessor:"data = data."+accessor)}var value=mapping.evaluator(data);_this.root.findAll(mapping.target,_this).forEach(function(e){return e[mapping.property]=value})}catch(e){_logger.error(e,_this,mapping)}})}function onchangeData(e){e.hasOwnProperty("data")&&executeMappings.call(this)}function buildMappings(){var e=this;return this._model.mappings?!this._model.mappings instanceof Array?(_logger.error("Mappings model is invalid (should be a Array) ..",this._model.mappings),void(this._mappings=[])):void(this._mappings=(this._model.mappings||[]).map(function(t){return new _dataMapping2["default"](t,e)})):void(this._mappings=[])}function destroyMappings(){delete this._mappings}function onchangeMappings(e){e.hasOwnProperty("mappings")&&(delete this._mappings,executeMappings.call(this))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.executeMappings=executeMappings,exports.onchangeData=onchangeData,exports.buildMappings=buildMappings,exports.destroyMappings=destroyMappings,exports.onchangeMappings=onchangeMappings;var _logger=require("../../core/logger"),_dataMapping=require("./data-mapping"),_dataMapping2=_interopRequireDefault(_dataMapping)},{"../../core/logger":62,"./data-mapping":19}],21:[function(require,module,exports){"use strict";function tostring(e){return String(_utils.objToVal(e)||"")}function tonumber(e){return Number(_utils.objToVal(e))}function value(e){return e}function valueString(e){return tostring(e)}function valueNumber(e){return tonumber(e)}function map(e){return this.param?(e=tostring(e),this.param.hasOwnProperty(e)?this.param[e]:this.param["default"]):void 0}function range(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"number",n=this.param;if(n){for(var r in n){var o=r.split("~"),i=_slicedToArray(o,2),a=i[0],u=i[1];if("number"===t?(a=parseFloat(a),u=parseFloat(u),e=tonumber(e)):(a=String(a),u=String(u),e=tostring(e)),e>=a&&u>e)return n[r]}return n["default"]}}function radian(e){return tonumber(e)*Math.PI/180}function build(script){var evaluator;try{return eval("evaluator = function(value, type) {"+script+"}"),evaluator}catch(e){return _logger.error(e),function(){}}}function buildEvaluator(e,t,n,r,o){switch(n){case"value":return"text"===o||"string"===o?valueString.bind(e):"number"===o?valueNumber.bind(e):value.bind(t);case"map":return map.bind(e);case"range":return range.bind(e);case"radian":return radian.bind(e);case"eval":return build(r).bind(t);default:return value.bind(t)}}Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(s){o=!0,i=s}finally{try{!r&&u["return"]&&u["return"]()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();exports["default"]=buildEvaluator;var _logger=require("../../core/logger"),_utils=require("../../core/utils")},{"../../core/logger":62,"../../core/utils":69}],22:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./component"),l=r(s),c=e("./ellipse"),f=r(c),h={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"ratio",name:"ratio",property:"ratio"}]},d={ondragmove:function(e,t,n){var r=(n.controls,n.model),o=r.cx,i=r.rx,a=n.transcoordP2S(e.x,e.y),u=(a.x-o)/i*100;u=u>=100||-100>=u?100:Math.abs(u),n.set({ratio:u})}},p=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"_draw",value:function(e){var t=this.model,n=t.ratio,r=void 0===n?50:n,o=t.cx,i=t.cy,a=t.rx,u=t.ry,s=t.startAngle,l=t.endAngle,c=t.anticlockwise;e.beginPath(),e.ellipse(o,i,Math.abs(a),Math.abs(u),0,s||0,l||2*Math.PI,c),e.moveTo(o+a/100*r,i),e.ellipse(o,i,Math.abs(a/100*r),Math.abs(u/100*r),0,s||0,l||2*Math.PI,!0)}},{key:"contains",value:function(e,t){var n=this.model,r=n.cx,o=n.cy,i=n.rx,a=n.ry,u=n.ratio,s=(e-r)/(2*i-.5),l=(t-o)/(2*a-.5),c=(e-r)/(i/100*u*2-.5),f=(t-o)/(a/100*u*2-.5),h=!1;return.25>s*s+l*l&&c*c+f*f>.25&&(h=!h),h}},{key:"controls",get:function(){var e=this.model,t=e.cx,n=e.cy,r=e.rx,o=e.ratio;return[{x:t+r/100*o,y:n,handler:d}]}},{key:"nature",get:function(){return h}}]),t}(f["default"]);n["default"]=p,l["default"].memoize(p.prototype,"controls",!1),l["default"].register("donut",p)},{"./component":17,"./ellipse":30}],23:[function(e,t,n){"use strict";function r(e){var t=this;this._model.effects&&this._model.effects.forEach(function(n){t.effect(e,n)})}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r},{}],24:[function(e,t,n){"use strict";function r(e,t,n,r,o){var i=r.alpha,a=void 0===i?1:i,s=o.fillStyle;if(e.globalAlpha*=a,s)if("string"==typeof s)e.fillStyle=s,e.fill();else if("object"==("undefined"==typeof s?"undefined":u(s)))if("gradient"==s.type){e.translate(n.x,n.y);var c=void 0,f=t.width,h=t.height;if("linear"==s.gradientType){var d=3.141592653589793,p=s.rotation;if(p>=.436332&&1.13446>=p||p>=2.00713&&2.70526>=p||p>=3.57792&&4.27606>=p||p>=5.14872&&5.84685>=p){var y=Math.sqrt(Math.pow((f-4)/2,2)+Math.pow((h-4)/2,2));y-=y-(f+h)/3,c=e.createLinearGradient(y*Math.cos(p+d),y*Math.sin(p+d),y*Math.cos(p),y*Math.sin(p))}else c=e.createLinearGradient((f-4)/2*Math.cos(p+d),(h-4)/2*Math.sin(p+d),(f-4)/2*Math.cos(p),(h-4)/2*Math.sin(p))}else if("radial"==s.gradientType){var v=.95*Math.sqrt(Math.pow((f-4)/2,2)+Math.pow((h-4)/2,2));switch(s.center){case"center":c=e.createRadialGradient(0,0,0,0,0,v);break;case"left-top":c=e.createRadialGradient(-f/2,-h/2,0,-f/2,-h/2,2*v);break;case"right-top":c=e.createRadialGradient(f/2,-h/2,0,f/2,-h/2,2*v);break;case"left-bottom":c=e.createRadialGradient(-f/2,h/2,0,-f/2,h/2,2*v);break;case"right-bottom":c=e.createRadialGradient(f/2,h/2,0,f/2,h/2,2*v);break;default:c=e.createRadialGradient(0,0,0,0,0,v)}}s.colorStops.forEach(function(e){if(e.position>=0&&e.position<=1)try{c.addColorStop(e.position,e.color)}catch(t){l.warn("Invalid Color for colorstop : ",e.color),c.addColorStop(e.position,"#fff")}}),e.fillStyle=c,e.fill(),e.translate(-n.x,-n.y)}else if("pattern"==s.type&&s.image){o.prepareFillIf(!o._pattern_image_origin);var m=o._pattern_image;if(!m)return;if(s.fitPattern)return void e.drawImage(o._pattern_image,0,0,o._pattern_image.width,o._pattern_image.height,t.left,t.top,t.width,t.height);var g=s.offsetX||0,_=s.offsetY||0,b=0,w=0;switch(s.align){case"center":b=t.width/2-(s.width?s.width/2:0),w=t.height/2+(s.height?s.height/2:0);break;case"left-top":break;case"left-bottom":w=s.height?t.height%s.height:t.height;break;case"right-top":b=s.width?t.width%s.width:t.width;break;case"right-bottom":b=s.width?t.width%s.width:t.width,w=s.height?t.height%s.height:t.height;break;case"left":w=t.height/2+(s.height?s.height/2:0);break;case"right":b=s.width?t.width%s.width:t.width,w=t.height/2+(s.height?s.height/2:0);break;case"top":b=t.width/2-(s.width?s.width/2:0);break;case"bottom":b=t.width/2-(s.width?s.width/2:0),w=s.height?t.height%s.height:t.height}var k=t.left+g+b,x=t.top+_+w;e.translate(k,x),e.fillStyle=e.createPattern(o._pattern_image,"repeat"),e.fill(),e.translate(-k,-x)}}function o(e,t){var n=this.fillStyle;if(!n||"pattern"!=n.type||!n.image)return void e(this);if("string"!=typeof n.image)return this._pattern_image_origin=this._pattern_image=n.image,void e(this);this._pattern_image=null,this._pattern_image_origin=new Image;var r=this;this._pattern_image_origin.onload=function(){if(n.fitPattern||!n.width&&!n.height)return r._pattern_image=r._pattern_image_origin,void e(this);var t=n.width||this.width,o=n.height||this.height;n.fitPattern&&(t=r.bounds.width,o=r.bounds.height);var i=s.createCanvas(t,o),a=i.getContext("2d");a.drawImage(this,0,0,this.width,this.height,0,0,t,o),r._pattern_image=i,e(this)},this._pattern_image_origin.onerror=function(e){t(e)};try{this._pattern_image_origin.crossOrigin="data"!==String(n.image).substring(0,4)?"use-credentials":null,this._pattern_image_origin.src=this.app.url(n.image)}catch(o){t(o)}}function i(e){var t=this;e&&this.prepareFill(function(){t.invalidate()},function(e){l.error(e)})}function a(e){if(e.hasOwnProperty("fillStyle")){var t=this.fillStyle;return"pattern"!==t.type?void(this._pattern_image&&(this._pattern_image=null,this._pattern_image_origin=null)):void this.prepareFillIf(t.image)}}Object.defineProperty(n,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.drawFill=r,n.prepareFill=o,n.prepareFillIf=i,n.onchangeFill=a;var s=e("../canvas/canvas"),l=e("../../core/logger")},{"../../core/logger":62,"../canvas/canvas":16}],25:[function(e,t,n){"use strict";function r(e,t){if(!e||isNaN(+t))return t;var n,r,o,i,a,u,s,l,c,f,h=e.length,d=e.search(/[0-9\-\+#]/),p=d>0?e.substring(0,d):"",y=e.split("").reverse().join(""),v=y.search(/[0-9\-\+#]/),m=h-v,g=e.substring(m,m+1),_=m+("."===g||","===g?1:0),b=v>0?e.substring(_,h):"";if(e=e.substring(d,_),t="-"===e.charAt(0)?-t:+t,n=0>t?t=-t:0,r=e.match(/[^\d\-\+#]/g),o=".",i=r&&r[1]&&r[0]||",",e=e.split(o),t=t.toFixed(e[1]&&e[1].length),t=+t+"",u=e[1]&&e[1].lastIndexOf("0"),l=t.split("."),(!l[1]||l[1]&&l[1].length<=u)&&(t=(+t).toFixed(u+1)),c=e[0].split(i),e[0]=c.join(""),a=e[0]&&e[0].indexOf("0"),a>-1)for(;l[0].length<e[0].length-a;)l[0]="0"+l[0];else 0===+l[0]&&(l[0]="");if(t=t.split("."),t[0]=l[0],s=c[1]&&c[c.length-1].length){for(f=t[0],y="",m=f.length%s,h=f.length,_=0;h>_;_++)y+=f.charAt(_),!((_-m+1)%s)&&h-s>_&&(y+=i);t[0]=y}t[1]=e[1]&&t[1]?o+t[1]:"",r=t.join(""),("0"===r||""===r)&&(n=!1);var w;return w="+"==e[0].substring(0,1)?n?"-":"+":n?"-":"",p+(w+r)+b}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r},{}],26:[function(e,t,n){"use strict";function r(e,t,n,r,o){var i=l+o,a=n.x,u=n.y,s=r.x,c=r.y;if(Math.abs(a-s)>i&&Math.abs(u-c)>i){var f=(c-u)/(s-a),h=u-f*a;if(Math.abs(t-(f*e+h))>i)return!1}var d,p,y,v;return a>s?(p=a,d=s):(p=s,d=a),u>c?(v=u,y=c):(v=c,y=u),e>p+l?!1:d-l>e?!1:t>v+l?!1:y-l>t?!1:!0}function o(e,t,n){for(var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,i=0;i<n.length-1;i++)if(r(e,t,n[i],n[i+1],o))return!0;return!1}function i(e,t,n,r){if("arrow"!=e.slice(-5))return n;var o=(n.x,n.y,Math.atan2(r.y-n.y,r.x-n.x)),i=1.5*t;return{x:n.x+Math.cos(o)*i,y:n.y+Math.sin(o)*i}}function a(e,t,n){var r=n.lineWidth,o=void 0===r?f:r,i=n.strokeStyle,a=void 0===i?"#000000":i,l=n.lineCap,c=void 0===l?!1:l,h=n.alpha,d=void 0===h?1:h,p=n.begin,y=void 0===p?"none":p,v=n.end,m=void 0===v?"none":v,g=n.beginSize,_=void 0===g?"size5":g,b=n.endSize,w=void 0===b?"size5":b;if(("none"!=y||"none"!=m)&&(o=Number(o)||f,e.lineCap=c,e.lineWidth=o,e.strokeStyle=a,e.fillStyle=a,e.globalAlpha*=d,"none"!=y&&u(e,t[0],t[1],o,y,s(_,o)),"none"!=m)){var k=t.length;u(e,t[k-1],t[k-2],o,m,s(w,o))}}function u(e,t,n,r,o,i){var a=t.x,u=t.y,s=Math.atan2(n.y-u,n.x-a);switch(e.beginPath(),e.translate(a,u),e.rotate(s),o){case"oval":e.ellipse(0,0,i.X,i.Y,0,0,2*Math.PI),e.fill();break;case"diamond":e.moveTo(-i.X,0),e.lineTo(0,-i.Y),e.lineTo(i.X,0),e.lineTo(0,i.Y),e.fill();break;case"arrow":e.moveTo(0,0),e.lineTo(c*i.X,-i.Y),e.lineTo(c*i.X,i.Y),e.fill();break;case"sharp-arrow":e.moveTo(0,0),e.lineTo(c*i.X,-i.Y),e.lineTo(-i.X/1.5+c*i.X,0),e.lineTo(c*i.X,i.Y),e.fill();break;case"open-arrow":e.moveTo(c*i.X+r,-i.Y),e.lineTo(r,0),e.lineTo(c*i.X+r,i.Y),e.stroke()}e.rotate(-s),e.translate(-a,-u),e.closePath()}function s(e,t){var n={};switch(t=1.2*t,e){case"size1":n.X=t,n.Y=t;break;case"size2":n.X=1.5*t,n.Y=t;break;case"size3":n.X=2*t,n.Y=t;break;case"size4":n.X=t,n.Y=1.5*t;break;case"size5":n.X=1.5*t,n.Y=1.5*t;break;case"size6":n.X=2*t,n.Y=1.5*t;break;case"size7":n.X=t,n.Y=2*t;break;case"size8":n.X=1.5*t,n.Y=2*t;break;case"size9":n.X=2*t,n.Y=2*t;break;default:n.X=1.5*t,n.Y=1.5*t}return n}Object.defineProperty(n,"__esModule",{value:!0}),n.containedInPath=o,n.getTipNeckPos=i,n.drawEndTips=a;var l=5,c=Math.sqrt(3),f=2},{}],27:[function(e,t,n){"use strict";function r(e,t){var n=t.strokeStyle,r=t.lineDash,o=t.lineWidth,i=t.lineCap,a=t.lineJoin,u=t.alpha;if(n&&0!=o){if(i&&(e.lineCap=i),r){var s="round"==i;switch(r){case"solid":r=[0,0];break;case"round-dot":r=s?[0,2*o]:[o,o];break;case"square-dot":r=s?[o,2*o]:[2*o,o];break;case"dash":r=s?[3*o,2.5*o]:[4*o,1.5*o];break;case"dash-dot":r=s?[3*o,3*o,0,3*o]:[4*o,2*o,o,2*o];break;case"long-dash":r=s?[5*o,4*o]:[6*o,3*o];break;case"long-dash-dot":r=s?[5*o,3*o,0,3*o]:[6*o,2*o,o,2*o];break;case"long-dash-dot-dot":r=s?[5*o,2*o,0,2*o,0,2*o]:[6*o,o,o,o,o,o]}e.setLineDash(r)}e.globalAlpha*=u,e.strokeStyle=n,e.lineWidth=o,e.lineJoin=a,e.stroke()}}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r},{}],28:[function(e,t,n){"use strict";function r(e,t,n){if(t.length<2)return t;for(var r=2;r<t.length;r++){var o=t.substring(0,r);if(!(e.measureText(o).width<n))break}return t.substring(0,r-1)}function o(e,t,n){var o,i,a=t.split(" "),u=[],s=[];for(o=0,i=1;i<=a.length;i++)if(s=a.slice(o,i),e.measureText(s.join(" ")).width>n){if(i-o==1){var l=r(e,s[0],n);u.push([l]),a.splice(o,1,l,s[0].substring(l.length))}else{for(;""==a[i-1];)i++;u.push(a.slice(o,--i))}o=i}return i-o>1&&u.push(s),0==u.length&&u.push([""]),u}function i(e,t,n,r){var i=String(t).split("\n");return r?[].concat.apply([],i.map(function(t){return o(e,t,n)})):i.map(function(e){return e.split(" ")})}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=i},{}],29:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){if(!r)return[];e.save(),e.font=n;var i=l["default"](e,r,t,!!o);return e.restore(),i}function i(e){var t=e.fontFamily,n=void 0===t?u.DEFAULT.FONT_FAMILY:t,r=e.bold,o=void 0===r?u.DEFAULT.BOLD:r,i=e.italic,a=void 0===i?u.DEFAULT.ITALIC:i,s=e.fontSize,l=void 0===s?u.DEFAULT.FONT_SIZE:s,c=[];return o&&c.push("bold"),a&&c.push("italic"),c.push(l+"px"),c.push(n),c.join(" ")}function a(e,t,n,r){var o=r.alpha,a=void 0===o?u.DEFAULT.FONT_COLOR:o,s=r.fontColor,l=void 0===s?u.DEFAULT.FONT_COLOR:s,c=r.textAlign,f=void 0===c?u.DEFAULT.TEXT_ALIGN:c,h=r.textBaseline,d=void 0===h?u.DEFAULT.TEXT_BASELINE:h,p=r.fontSize,y=void 0===p?u.DEFAULT.FONT_SIZE:p,v=r.lineHeight,m=void 0===v?1.2*y:v;e.save(),e.beginPath();var g=t.left,_=t.top,b=t.width,w=t.height;e.font=i(r);var k,x=n.length*m;switch(d){case"top":k=_,e.textBaseline="top";break;case"bottom":k=_+w-x+m,e.textBaseline="bottom";break;case"middle":default:k=_+w/2-x/2+m/2,e.textBaseline="middle"}var O;switch(f){case"left":O=g,e.textAlign="left";break;case"right":O=g+b,e.textAlign="right";break;case"justify":O=g,e.textAlign="left";break;case"center":default:O=g+b/2,e.textAlign="center"}e.globalAlpha*=a,e.fillStyle=l,n.forEach("justify"!=f?function(t,n){e.fillText(t.join(" "),O,k+n*m)}:function(t,n){var r=k+n*m;if(1==t.length)e.fillText(t[0],O,r);else{var o=t.map(function(t){return e.measureText(t).width}),i=o.reduce(function(e,t){return e+t},0),a=(b-i)/(t.length-1),u=O;t.forEach(function(t,n){e.fillText(t,u,r),u+=o[n]+a})}}),e.restore()}Object.defineProperty(n,"__esModule",{value:!0}),n.textLines=o,n.font=i,n.drawText=a;var u=e("../../const"),s=e("./text-wrapper"),l=r(s)},{"../../const":56,"./text-wrapper":28}],30:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./component"),l=r(s),c=e("./shape"),f=r(c),h=e("./outline/ellipse-outline"),d=r(h),p=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"_draw",value:function(e){var t=this.model,n=t.cx,r=t.cy,o=t.rx,i=t.ry,a=t.startAngle,u=t.endAngle,s=t.anticlockwise;e.beginPath(),e.ellipse(n,r,Math.abs(o),Math.abs(i),0,a||0,u||2*Math.PI,s)}},{key:"contains",value:function(e,t){var n=this.model,r=n.cx,o=n.cy,i=n.rx,a=n.ry,u=(e-r)/(2*i-.5),s=(t-o)/(2*a-.5);return.25>u*u+s*s}},{key:"outline",value:function(e){return d["default"](this,e)}},{key:"path",get:function(){var e=this.model,t=e.cx,n=e.cy,r=e.rx,o=e.ry;return[{x:t-r,y:n-o},{x:t+r,y:n-o},{x:t+r,y:n+o},{x:t-r,y:n+o}]},set:function(e){var t=e[0],n=e[2];this.set({cx:t.x+(n.x-t.x)/2,cy:t.y+(n.y-t.y)/2,rx:(n.x-t.x)/2,ry:(n.y-t.y)/2})}}]),t}(f["default"]);n["default"]=p,l["default"].memoize(p.prototype,"path",!1),l["default"].register("ellipse",p)},{"./component":17,"./outline/ellipse-outline":43,"./shape":51}],31:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:1,y:1};return e-=n.x,t-=n.y,{x:(e*Math.cos(-r)-t*Math.sin(-r)+n.x)/o.x,y:(e*Math.sin(-r)+t*Math.cos(-r)+n.y)/o.y}}function i(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:1,y:1};return e-=n.x,t-=n.y,{x:(e*Math.cos(r)-t*Math.sin(r)+n.x)*o.x,y:(e*Math.sin(r)+t*Math.cos(r)+n.y)*o.y}}function a(e,t,n){if(!this.parent)return{x:e,y:t};var r=this.model,i=r.rotation,a=void 0===i?0:i,u=r.scale,s=void 0===u?{x:1,y:1}:u;if(this.isLayer()){var l=this.model.translate,c=o(e,t,l,a,s);return l&&(c.x-=l.x/(s?s.x:1),c.y-=l.y/(s?s.y:1)),c}n=n||this.rotatePoint;var f=o(e,t,n,a,s);return{x:f.x+(n.x-n.x/s.x),y:f.y+(n.y-n.y/s.y)}}function u(e,t,n){if(!this.parent)return{x:e,y:t};var r=this.model,o=r.rotation,a=void 0===o?0:o,u=r.scale,s=void 0===u?{x:1,y:1}:u;if(this.isLayer()){
var l=this.model.translate,c=i(e,t,void 0,a,s);return l&&(c.x+=l.x,c.y+=l.y),c}n=n||this.rotatePoint;var f=i(e,t,n,a,s);return{x:f.x-(n.x-n.x/s.x),y:f.y-(n.y-n.y/s.y)}}function s(e,t,n){var n=n||this.rootModel,r=this.transcoordS2T(e,t,n);return i(r.x,r.y,void 0,n.get("rotation")||0)}function l(e,t,n){for(var n=n||this.rootModel,r=[],o=this.parent;o&&o!==n;o=o.parent)r.push(o);var i=this.transcoordS2P(e,t);return r.forEach(function(e){var t=e.model.scale,n=e.bounds;if(t){var r=e.rotatePoint;i.x+=(r.x-n.left)*t.x,i.y+=(r.y-n.top)*t.y}else i.x+=n.left,i.y+=n.top;i=e.transcoordS2P(i.x,i.y)}),i}function c(e,t,n){for(var n=n||this.rootModel,r=[],o=this.parent;o&&o!==n;o=o.parent)r.splice(0,0,o);var i={x:e,y:t};return r.forEach(function(e){var t=e.model.scale;i=e.transcoordP2S(i.x,i.y);var n=e.bounds;if(t){var r=e.rotatePoint;i.x-=(r.x-n.left)/t.x,i.y-=(r.y-n.top)/t.y}else i.x-=n.left,i.y-=n.top}),this.transcoordP2S(i.x,i.y)}function f(e,t,n){var r=this.rootModel,o=this.transcoordS2T(e,t,r);return n.transcoordT2S(o.x,o.y,r)}function h(e,t,n){if(!n)for(n=this;n&&!n.isLayer();)n=n.parent;var r=n.model,i=r.translate,a=r.scale,u=r.rotation,s=o(e,t,i,u,a);return i&&(s.x-=i.x/(a?a.x:1),s.y-=i.y/(a?a.y:1)),n===this?s:this.transcoordT2S(s.x,s.y,n)}function d(e,t,n){if(!n)for(n=this;n&&!n.isLayer();)n=n.parent;if(n!==this)var r=this.transcoordS2T(e,t,n);else var r={x:e,y:t};var o=n.model,a=o.translate,u=o.rotation,s=o.scale;return r=i(r.x,r.y,void 0,u,s),a&&(r.x+=a.x,r.y+=a.y),r}Object.defineProperty(n,"__esModule",{value:!0}),n.transcoordR=o,n.transcoordRR=i,n.transcoordP2S=a,n.transcoordS2P=u,n.transcoordS2TR=s,n.transcoordS2T=l,n.transcoordT2S=c,n.transcoordS2O=f,n.transcoordC2S=h,n.transcoordS2C=d;{var p=e("../../const");r(p)}},{"../../const":56}],32:[function(e,t,n){"use strict";function r(e){var t,n,r,o;return e.forEach(function(e){void 0===t?(t=e.left,n=e.top,r=e.left+e.width,o=e.top+e.height):(t=Math.min(e.left,t),n=Math.min(e.top,n),r=Math.max(e.left+e.width,r),o=Math.max(e.top+e.height,o))}),{left:t,top:n,width:r-t,height:o-n}}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r},{}],33:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function m(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:m(o,t,n)}if("value"in r)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},l=e("./component"),c=r(l),f=e("./shape"),h=r(f),d=e("./mixins/rect-path"),p=r(d),y={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"SCENE-Number",name:"ref",property:"ref"},{type:"select",label:"fit",name:"fit",property:{options:["both","ratio"]}}]},v=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"dispose",value:function(){this._releaseRef(),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispose",this).call(this)}},{key:"draw",value:function(e){this._drawing||(this._drawing=!0,s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"draw",this).call(this,e),this._drawing=!1)}},{key:"_pre_draw",value:function(e){if(s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_pre_draw",this).call(this,e),this.ref){var n=this.ref.root,r=n.center,o=this.center,i=this.refScale;e.translate(o.x,o.y),i&&e.scale(i.x,i.y),e.translate(-r.x,-r.y)}}},{key:"_post_draw",value:function(e){if(this.ref){var n=this.ref.root;return n._post_draw(e)}s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_post_draw",this).call(this,e)}},{key:"_draw",value:function(e){if(this.ref)return this.ref.root._draw(e);var t=(this.model.round,this.bounds),n=t.left,r=t.top,o=t.width,i=t.height;e.beginPath(),e.rect(n,r,o,i)}},{key:"_releaseRef",value:function(){this.__ref&&this.__ref.release&&(this.__ref._container.off("redraw",this.onredraw_ref,this),this.__ref.release()),delete this.__ref}},{key:"onredraw_ref",value:function(){this.invalidate()}},{key:"onchange",value:function(e,t){(t.ref||e.ref)&&this._releaseRef()}},{key:"nature",get:function(){return y}},{key:"hasTextProperty",get:function(){return!1}},{key:"ref",get:function(){if(this.hasOwnProperty("__ref"))return this.__ref;var e=this.app.refProvider;return e&&this.model.ref?(this.__ref=e.get(this.model.ref,!0),this.__ref._container.on("redraw",this.onredraw_ref,this)):this.__ref=null,this.__ref}},{key:"refScale",get:function(){if(this.ref){{var e=this.ref.root,t=e.bounds,n=(e.center,this.bounds);this.center}if(t.width&&t.height){var r=n.width/t.width,o=n.height/t.height;switch(this.model.fit){case"both":return{x:r,y:o};case"ratio":default:return{x:Math.min(r,o),y:Math.min(r,o)}}}}}}]),t}(p["default"](h["default"]));n["default"]=v,c["default"].memoize(v.prototype,"ref",!1),c["default"].memoize(v.prototype,"refScale",!1),c["default"].register("global-ref",v)},{"./component":17,"./mixins/rect-path":39,"./shape":51}],34:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function v(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:v(o,t,n)}if("value"in r)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},c=e("../components/container"),f=r(c),h=e("./component"),d=r(h),p=["left","top","width","height","rotation","animation"],y=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u(t,e),s(t,[{key:"isGroup",value:function(){return!0}},{key:"get",value:function(e){return this._model[e]}},{key:"set",value:function(e,n){if("string"==typeof e)return this.set(o({},e,n));var r=p.reduce(function(t,n){return e.hasOwnProperty(n)&&(t[n]=e[n]),t},{});return l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"set",this).call(this,r)}},{key:"capture",value:function(e,n){var r=l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"capture",this).call(this,e,n);if(this.parent.isGroup())return r&&r!==this&&r;for(var o=0;o<this.root.selected.length;o++){for(var i=this.root.selected[o];i!==this&&(i.isGroup()||i.parent.isGroup());)i=i.parent;if(i===this)return r&&r!==this&&r}return r&&r!==this&&this}},{key:"calculateBounds",value:function(){var e=d["default"].union(this.components.map(function(e){return e.bounds}));if(void 0!==e.left){var t=this.bounds;(0!==e.left||0!==e.right||e.width!==t.width||e.height!==t.height)&&(this.components.forEach(function(t){var n=t.bounds;t.bounds={left:n.left-e.left,top:n.top-e.top,width:n.width,height:n.height}}),this._model.left=t.left+e.left,this._model.top=t.top+e.top,this._model.width=e.width,this._model.height=e.height,delete this.__cache__.path,delete this.__cache__.bounds,this.parent.isGroup()&&this.parent.calculateBounds())}}},{key:"_draw",value:function(){}},{key:"_post_draw",value:function(e){{var t=this.model,n=t.top,r=t.left;t.scale}e.translate(r,n),this.layout.drawables(this).forEach(function(t){t.draw(e)}),e.translate(-r,-n)}},{key:"bounds",set:function(e){var t=this.bounds,n={x:e.width/t.width,y:e.height/t.height};this.path=this.path.map(function(r){return{x:e.left+(r.x-t.left)*n.x,y:e.top+(r.y-t.top)*n.y}}),this.components&&this.components.forEach(function(e){if(e.mutable)e.mutatePath(null,function(e){return e.map(function(e){return{x:e.x*n.x,y:e.y*n.y}})});else{var t=e.bounds,r=e.center,o={x:r.x*(1-n.x),y:r.y*(1-n.y)},i=t.width*(1-n.x),a=t.height*(1-n.y),u=-(o.x-i/2),s=-(o.y-a/2);e.bounds={left:t.left+u,top:t.top+s,width:t.width*n.x,height:t.height*n.y}}})},get:function(){return l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"bounds",this)}},{key:"focusible",get:function(){return!1}}]),t}(f["default"]);n["default"]=y,d["default"].register("group",y)},{"../components/container":18,"./component":17}],35:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t,n){try{var r=e.getImageData(0,0,t,n)}catch(o){return v.error("Get Image Data Error: "+o.message),null}for(var i=r.data,a=0;t*n*4>a;a+=4){var u=i[a],s=i[a+1],l=i[a+2],c=parseInt((u+s+l)/3);r.data[a]=c,r.data[a+1]=c,r.data[a+2]=c}return r}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function b(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:b(o,t,n)}if("value"in r)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},c=e("./component"),f=r(c),h=e("./shape"),d=r(h),p=e("./mixins/rect-path"),y=r(p),v=e("../core/logger"),m={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"image-selector",label:"Image src",name:"src",property:{displayField:"id",displayFullUrl:!0,baseUrlAlias:"$base_url",defaultStorage:"scene-image",storageFilters:{type:Array,value:[{name:"category",value:"image"}]},useUpload:!0}}]},g=new Image;g.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABICAYAAAAJZ/BjAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyppVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTMyIDc5LjE1OTI4NCwgMjAxNi8wNC8xOS0xMzoxMzo0MCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUuNSAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpEMkI4QjU2MDYzQUExMUU2OEI2MUQ2REJCODlDNzQ4QyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpEMkI4QjU2MTYzQUExMUU2OEI2MUQ2REJCODlDNzQ4QyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkQyQjhCNTVFNjNBQTExRTY4QjYxRDZEQkI4OUM3NDhDIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkQyQjhCNTVGNjNBQTExRTY4QjYxRDZEQkI4OUM3NDhDIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+uiDtiwAAA9hJREFUeNrsnG1r2lAYhpP4/lqjjbabqKUwy6x2jLJPo/9gv3b/YB/HPu3jYCBsFeqgUt9qtdHdT7FsuC5qmpOTxOcGaWtOEnOuc+7z3IlUVRTlg8KSJpUBMAAGwN3AABgAiwEwAJY3AXzkbnqWLPtX4/6RKwbAABgAiwEwABYD2E2FRR24WCyGer1ezTTN8mKxyDyEDlUdhEKhn7qut7vdrsndLyiIpdPp5Hg8fjefzzNPTjtNGySTyc/D4XDMQUzAyLfqfBJtozbUltcAh0W2Y9X5f0OgtgzAYZHni2jLADbU44LrdFsGwPIHACo1RbRlABuK6nwRbe0oFosd0munAFDIojp/7YnRhtqKujAcOzKdTk/plc/nw14FQHV4fU2bb9sccDQaLVKpVPf+/t7AIhuzCmIoQ6eiLgznP0Wpu09pfzabhfF7V1If110FQMKomxmG8YN+khPgFYXfP3R8OBz+XigUvors/EQikaeRv0z6lDlyeI8GxcRrAAL3TLhcLmudTudiNQwCfr9SqXxqt9uLQN+KkK2rq6vjp5I43steXl4ecQ4QKKw9Kfj9K4t1oZ5OpxMMQJAmk0nT6ppQFIRvb2+bDOA/isfjhUgkcmxn32g0WjZN01jXDm1KXsoGngFAtfrd3d0bWMhrBLRzVEob1+57e3tR7NfYokrzTDYQUobaETqQ6nZjaRUZwDhAVviF92cb1Pwt7KtvcTo3s0Hd8zMA1rOPTqysVC300OYCdnGwbl87t7VxvhqyQW7nLUjXdbKes8fQtLpoYts51oWTRqPxz/ZSqaTBTlo2T63SeavVqrrTFrS8ZWC1eKrYXri+vs7B67uodOaPG9CBdYz+A7vnplslmGUzHL+3kxYEezEAoLpJW3R08ebm5gK2kaW/sT5ksO+xAwNAajbQZFoP7ONsyxGbRB3/HuBeYia0nPj8srOBNACDwaCBi7cz8kKwnrewjbxTn0VmNtAkWU9xteqRLcoGNCsDDyCXy0W2tR43hNkYx6w8CTyA4XB4ShereFAysoGrAGA9JVykl78L5Ho2cA0AavjIM0KTa6LnBp1O5yhwAEajkWetR2Y2cAUA3c/xuPVIywbCAdCtYj9Yj6xsIBzAsuqJKT6UG88NhAKgEYSR9FLxqWjN6vf7J74EkM1myXqais8lOhsIA4Cqp+VX63kqG9RqNdU3AGA9L2A9h0pAJPI7RY4DgPXEgmA9bmUDxwHAepqwnmjQAIjKBo6XWLCeL0pAhWvz760IFgNgACwGwABYDIABsP6I/3ErA2AADIABMAAWA2AALAawe/otwAASpe1VNrxeJQAAAABJRU5ErkJggg==";var _=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),s(t,[{key:"dispose",value:function(){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispose",this).call(this),this._offcanvas=null,this._image=null}},{key:"_draw",value:function(e){var t=this.model,n=t.left,r=t.top,o=t.width,i=t.height,a=t.isGray,u=void 0===a?!1:a,s=t.alpha,l=void 0===s?1:s,c=t.src;if(this.prepareIf(!this._image&&c),e.beginPath(),e.globalAlpha*=l,this._image&&this._image.complete)if(u&&this._offcanvas)e.drawImage(this._offcanvas,n,r,o,i);else try{e.drawImage(this._image,n,r,o,i)}catch(f){e.drawImage(g,n,r,o,i)}else e.drawImage(g,n,r,o,i)}},{key:"prepare",value:function(e,t){var n=this,r=this.model.src;if(!r)return void e(this);this._image=new Image;try{this._image.crossOrigin="data"!==String(r).substring(0,4)?"use-credentials":null,this._image.src="string"==typeof r?this.app.url(r):r}catch(o){return void t(o)}this._image.onload=function(){if(n.get("isGray")){var t=n._image.width,r=n._image.height;n._offcanvas=f["default"].createCanvas(t,r);var o=n._offcanvas.getContext("2d");o.drawImage(n._image,0,0);var i=u(o,t,r);o.putImageData(i,0,0)}e(n)},this._image.onerror=function(e){t(e)}}},{key:"onchange",value:function(e){(e.hasOwnProperty("src")||e.hasOwnProperty("isGray"))&&(this._offcanvas=null,this._image=null,this.prepareIf(e.src))}},{key:"nature",get:function(){return m}},{key:"hasTextProperty",get:function(){return!1}}]),t}(y["default"](d["default"]));n["default"]=_,f["default"].register("image-view",_)},{"../core/logger":62,"./component":17,"./mixins/rect-path":39,"./shape":51}],36:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./component");Object.defineProperty(n,"Component",{enumerable:!0,get:function(){return r(o)["default"]}});var i=e("./container");Object.defineProperty(n,"Container",{enumerable:!0,get:function(){return r(i)["default"]}});var a=e("./root-container");Object.defineProperty(n,"RootContainer",{enumerable:!0,get:function(){return r(a)["default"]}});var u=e("./shape");Object.defineProperty(n,"Shape",{enumerable:!0,get:function(){return r(u)["default"]}});var s=e("./line");Object.defineProperty(n,"Line",{enumerable:!0,get:function(){return r(s)["default"]}});var l=e("./ellipse");Object.defineProperty(n,"Ellipse",{enumerable:!0,get:function(){return r(l)["default"]}});var c=e("./rect");Object.defineProperty(n,"Rect",{enumerable:!0,get:function(){return r(c)["default"]}});var f=e("./polygon");Object.defineProperty(n,"Polygon",{enumerable:!0,get:function(){return r(f)["default"]}});var h=e("./polyline");Object.defineProperty(n,"Polyline",{enumerable:!0,get:function(){return r(h)["default"]}});var d=e("./ruler");Object.defineProperty(n,"Ruler",{enumerable:!0,get:function(){return r(d)["default"]}});var p=e("./image-view");Object.defineProperty(n,"ImageView",{enumerable:!0,get:function(){return r(p)["default"]}});var y=e("./text");Object.defineProperty(n,"Text",{enumerable:!0,get:function(){return r(y)["default"]}});var v=e("./group");Object.defineProperty(n,"Group",{enumerable:!0,get:function(){return r(v)["default"]}});var m=e("./local-ref");Object.defineProperty(n,"LocalRef",{enumerable:!0,get:function(){return r(m)["default"]}});var g=e("./global-ref");Object.defineProperty(n,"GlobalRef",{enumerable:!0,get:function(){return r(g)["default"]}});var _=e("./path");Object.defineProperty(n,"Path",{enumerable:!0,get:function(){return r(_)["default"]}});var b=e("./triangle");Object.defineProperty(n,"Triangle",{enumerable:!0,get:function(){return r(b)["default"]}});var w=e("./donut");Object.defineProperty(n,"Donut",{enumerable:!0,get:function(){return r(w)["default"]}});var k=e("./star");Object.defineProperty(n,"Star",{enumerable:!0,get:function(){return r(k)["default"]}});var x=e("./variable");Object.defineProperty(n,"Variable",{enumerable:!0,get:function(){return r(x)["default"]}});var O=e("./mixins/rect-path");Object.defineProperty(n,"RectPath",{enumerable:!0,get:function(){return r(O)["default"]}});var P=e("./mixins/value-holder");Object.defineProperty(n,"ValueHolder",{enumerable:!0,get:function(){return r(P)["default"]}})},{"./component":17,"./container":18,"./donut":22,"./ellipse":30,"./global-ref":33,"./group":34,"./image-view":35,"./line":37,"./local-ref":38,"./mixins/rect-path":39,"./mixins/value-holder":40,"./path":45,"./polygon":46,"./polyline":47,"./rect":48,"./root-container":49,"./ruler":50,"./shape":51,"./star":52,"./text":53,"./triangle":54,"./variable":55}],37:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./component"),l=r(s),c=e("./drawer/line"),f=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"isLine",value:function(){return!0}},{key:"_draw",value:function(e){var t=this.model,n=t.begin,r=void 0===n?"none":n,o=t.end,i=void 0===o?"none":o,a=t.lineWidth,u=this.drawPath;c.drawEndTips(e,u,this.model),e.beginPath();var s=c.getTipNeckPos(r,a,u[0],u[1]),l=c.getTipNeckPos(i,a,u[u.length-1],u[u.length-2]);e.moveTo(s.x,s.y);for(var f=1;f<u.length-1;f++)e.lineTo(u[f].x,u[f].y);e.lineTo(l.x,l.y),this.drawStroke(e)}},{key:"contains",value:function(e,t){var n=this.model.lineWidth;return c.containedInPath(e,t,this.drawPath,n)}},{key:"drawPath",get:function(){return this.path}},{key:"resizable",get:function(){return!1}},{key:"mutable",get:function(){return!0}},{key:"rotatable",get:function(){return!1}},{key:"path",get:function(){var e=this.model,t=e.x1,n=e.y1,r=e.x2,o=e.y2;return[{x:t,y:n},{x:r,y:o}]},set:function(e){var t=e[0],n=e[1];this.set({x1:t.x,y1:t.y,x2:n.x,y2:n.y})}}]),t}(l["default"]);n["default"]=f,f.getTipNeckPos=c.getTipNeckPos,f.containedInPath=c.containedInPath,f.drawEndTips=c.drawEndTips,l["default"].memoize(f.prototype,"path",!1),l["default"].register("line",f)},{"./component":17,"./drawer/line":26}],38:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function m(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:m(o,t,n)}if("value"in r)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},l=e("./component"),c=r(l),f=e("./shape"),h=r(f),d=e("./mixins/rect-path"),p=r(d),y={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"ref",name:"ref",property:"ref"},{type:"select",label:"fit",name:"fit",property:{options:["both","ratio"]}}]},v=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"draw",value:function(e){this._drawing||(this._drawing=!0,s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"draw",this).call(this,e),this._drawing=!1)}},{key:"_pre_draw",value:function(e){if(s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_pre_draw",this).call(this,e),this.ref){var n=this.ref.center,r=this.center,o=this.refScale;e.translate(r.x,r.y),e.scale(o.x,o.y),e.translate(-n.x,-n.y)}}},{key:"_post_draw",value:function(e){return this.ref?this.ref._post_draw(e):void s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_post_draw",this).call(this,e)}},{key:"_draw",value:function(e){if(this.ref)return this.ref._draw(e);var t=(this.model.round,this.bounds),n=t.left,r=t.top,o=t.width,i=t.height;e.beginPath(),e.rect(n,r,o,i)}},{key:"ref",get:function(){var e=this.model.ref;return e&&"string"==typeof e?this.root.findById(e):null}},{key:"refScale",get:function(){var e=this.ref.bounds,t=(this.ref.center,this.bounds),n=(this.center,t.width/e.width),r=t.height/e.height;switch(this.model.fit){case"both":return{x:n,y:r};case"ratio":default:return{x:Math.min(n,r),y:Math.min(n,r)}}}},{key:"nature",get:function(){return y}},{key:"hasTextProperty",get:function(){return!1}}]),t}(p["default"](h["default"]));n["default"]=v,c["default"].memoize(v.prototype,"ref",!1),c["default"].memoize(v.prototype,"refScale",!1),c["default"].register("local-ref",v)},{"./component":17,"./mixins/rect-path":39,"./shape":51}],39:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../../core/memoize"),l=r(s);n["default"]=function(e){var t=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"contains",value:function(e,t){var n=this.model,r=n.left,o=n.top,i=n.width,a=n.height;return e<Math.max(r+i,r)&&e>Math.min(r+i,r)&&t<Math.max(o+a,o)&&t>Math.min(o+a,o)}},{key:"path",set:function(e){{var t=e[0],n=e[2],r=this.model;r.width,r.height}this.set({left:t.x,top:t.y,width:n.x-t.x,height:n.y-t.y})},get:function(){var e=this.model,t=e.left,n=void 0===t?0:t,r=e.top,o=void 0===r?0:r,i=e.width,a=void 0===i?0:i,u=e.height,s=void 0===u?0:u;return[{x:n,y:o},{x:n+a,y:o},{x:n+a,y:o+s},{x:n,y:o+s}]}}]),t}(e);return l.intercept(t.prototype,"path",!1),t}},{"../../core/memoize":63}],40:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n["default"]=function(e){var t=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),a(t,[{key:"animOnValueChange",value:function(e){var t=this;if(e!=this._lastValue){var n=e-(this._lastValue||0);this._lastValue=e,this._anim_alpha=-n,this.animate({step:function(e){t._anim_alpha=n*(e-1),t.invalidate()},duration:1e3,delta:"circ",options:{x:1},ease:"out"}).start()}}},{key:"animAlpha",get:function(){return this._anim_alpha||0}},{key:"animValue",get:function(){return(this._lastValue||0)+(this._anim_alpha||0)}}]),t}(e);return t}},{}],41:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=this.bounds,r=this.rotatePoint,o=this.get("rotation"),i=this.get("scale");if(e){var u=e.call(t,n);u&&(n=u)}var s=n,l=s.left,c=s.top,f=s.width,h=s.height,d=[{x:l,y:c},{x:l+f,y:c+h}];d=d.map(function(e){return a["default"].transcoordRR(e.x,e.y,r,o,i)});var p=d[0],y=d[1];r={x:(p.x+y.x)/2,y:(p.y+y.y)/2},d=d.map(function(e){return a["default"].transcoordR(e.x,e.y,r,o,i)}),p=d[0],y=d[1],this.bounds={left:p.x,top:p.y,width:y.x-p.x,height:y.y-p.y}}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o;var i=e("../component"),a=r(i)},{"../component":17}],42:[function(e,t,n){"use strict";function r(e,t,n){{var r=this,o=this.path,i=this.rotatePoint;this.get("rotation"),this.get("scale")}e&&(o=e.call(n,o));var a=o.map(function(e){return r.transcoordS2P(e.x,e.y)});if(t){var o=t.call(n,a);o&&(a=o)}var u,s,l,c,f={x:0,y:0},o=a.map(function(e){return r.transcoordP2S(e.x,e.y,f)});u=s=o[0].x,l=c=o[0].y;for(var h=1;h<o.length;h++){var d=o[h];d.x<u?u=d.x:d.x>s&&(s=d.x),d.y<l?l=d.y:d.y>c&&(c=d.y)}i={x:(u+s)/2,y:(l+c)/2},i=this.transcoordS2P(i.x,i.y,f),this.path=a.map(function(e){return r.transcoordP2S(e.x,e.y,i)})}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r},{}],43:[function(e,t,n){"use strict";function r(e,t){var n=e.model,r=n.cx,o=n.cy,i=n.rx,a=n.ry,u=2*Math.PI*t,s=r+i*Math.cos(u),l=o+a*Math.sin(u);return e.transcoordS2T(s,l)}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r},{}],44:[function(e,t,n){"use strict";function r(e,t){var n=e.path;if(!n||!n.length)return void o.error("path should not be empty");var r=1,i=[];if(e.isLine()||n.push(n[0]),0>=t)return e.transcoordS2T(n[0].x,n[0].y);if(t>=1)return e.transcoordS2T(n[n.length-1].x,n[n.length-1].y);for(;n[r];){var a=n[r-1],u=n[r],s=u.x-a.x,l=u.y-a.y;i.push(Math.sqrt(s*s+l*l)),r++}var c=i.reduce(function(e,t){return e+t},0);r=0;var f=0;do f+=i[r++];while(t>f/c);f-=i[--r];var h=f/c;t=(t-h)*(c/i[r]);var d=n[r%n.length],p=n[(r+1)%n.length],y=d.x+Math.round((p.x-d.x)*t),v=d.y+Math.round((p.y-d.y)*t);return e.transcoordS2T(y,v)}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r;var o=e("../../core/logger")},{"../../core/logger":62}],45:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./component"),l=r(s),c=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"_draw",value:function(e){var t=this.model.path,n=void 0===t?[]:t;if(!(n.length<=1)){e.beginPath(),e.moveTo(n[0].x,n[0].y);for(var r=1;r<n.length;r++)e.lineTo(n[r].x,n[r].y);e.closePath(),this.drawStroke(e)}}},{key:"contains",value:function(e,t){var n=this.model.path,r=!1;return n.forEach(function(o,i){var a=(i+n.length+1)%n.length,u=o.x,s=o.y,l=n[a].x,c=n[a].y;s>t!=c>t&&(l-u)*(t-s)/(c-s)+u>e&&(r=!r)}),r}},{key:"path",get:function(){return this.model.path},set:function(e){this.set("path",e)}}]),t}(l["default"]);n["default"]=c,l["default"].register("path",c)},{"./component":17}],46:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,
configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./component"),l=r(s),c=e("./shape"),f=r(c),h={ondragstart:function(e,t,n){n.mutatePath(null,function(n){n.splice(t+1,0,e)})},ondragmove:function(e,t,n){n.mutatePath(null,function(n){n[t+1]=e})},ondragend:function(){}},d=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"_draw",value:function(e){var t=this.model.path,n=void 0===t?[]:t;if(!(n.length<=1)){e.beginPath(),e.moveTo(n[0].x,n[0].y);for(var r=1;r<n.length;r++)e.lineTo(n[r].x,n[r].y);e.closePath()}}},{key:"contains",value:function(e,t){var n=this.model.path,r=!1;return n.forEach(function(o,i){var a=(i+n.length+1)%n.length,u=o.x,s=o.y,l=n[a].x,c=n[a].y;s>t!=c>t&&(l-u)*(t-s)/(c-s)+u>e&&(r=!r)}),r}},{key:"mutable",get:function(){return!0}},{key:"pathExtendable",get:function(){return!0}},{key:"path",get:function(){return this.model.path},set:function(e){this.set("path",e)}},{key:"controls",get:function(){var e=this.path;return e.map(function(t,n){var r=e[n+1>=e.length?0:n+1];return{x:(t.x+r.x)/2,y:(t.y+r.y)/2,handler:h}})}}]),t}(f["default"]);n["default"]=d,l["default"].memoize(d.prototype,"controls",!1),l["default"].register("polygon",d)},{"./component":17,"./shape":51}],47:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./component"),l=r(s),c=e("./line"),f=r(c),h={ondragstart:function(e,t,n){n.mutatePath(null,function(n){n.splice(t,0,e)})},ondragmove:function(e,t,n){n.mutatePath(null,function(n){n[t]=e})},ondragend:function(){}},d=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"pathExtendable",get:function(){return!0}},{key:"path",get:function(){return this.model.path},set:function(e){this.set("path",e)}},{key:"controls",get:function(){for(var e=this.path,t=[],n=0;n<e.length-1;n++){var r=e[n],o=e[n+1];0==n&&t.push({x:r.x,y:r.y,handler:h}),t.push({x:(r.x+o.x)/2,y:(r.y+o.y)/2,handler:h}),n==e.length-2&&t.push({x:o.x,y:o.y,handler:h})}return t}}]),t}(f["default"]);n["default"]=d,l["default"].memoize(d.prototype,"controls",!1),l["default"].register("polyline",d)},{"./component":17,"./line":37}],48:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t,n){var r=t>n?n/t*100:100;return e>=r?e=r:0>=e&&(e=0),e}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("./component"),c=r(l),f=e("./shape"),h=r(f),d=e("./mixins/rect-path"),p=r(d),y={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"round",name:"round",property:"round"}]},v={ondragmove:function(e,t,n){var r=n.model,o=r.left,i=(r.top,r.width),a=r.height,s=n.transcoordP2S(e.x,e.y),l=(s.x-o)/(i/2)*100;l=u(l,i,a),n.set({round:l})}},m=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),s(t,[{key:"is3dish",value:function(){return!0}},{key:"_draw",value:function(e){var t=this.model.round,n=void 0===t?0:t,r=this.bounds,o=r.left,i=r.top,a=r.width,s=r.height;if(e.beginPath(),n=u(n,a,s),n>0){var l=n/100*(a/2);e.moveTo(o+l,i),e.lineTo(o+a-l,i),e.quadraticCurveTo(o+a,i,o+a,i+l),e.lineTo(o+a,i+s-l),e.quadraticCurveTo(o+a,i+s,o+a-l,i+s),e.lineTo(o+l,i+s),e.quadraticCurveTo(o,i+s,o,i+s-l),e.lineTo(o,i+l),e.quadraticCurveTo(o,i,o+l,i)}else e.rect(o,i,a,s)}},{key:"controls",get:function(){var e=this.model,t=e.left,n=e.top,r=e.width,o=e.round,i=e.height;return o=void 0==o?0:u(o,r,i),[{x:t+r/2*(o/100),y:n,handler:v}]}},{key:"nature",get:function(){return y}}]),t}(p["default"](h["default"]));n["default"]=m,c["default"].register("rect",m)},{"./component":17,"./mixins/rect-path":39,"./shape":51}],49:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function M(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:M(o,t,n)}if("value"in r)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},c=e("./component"),f=o(c),h=e("./container"),d=o(h),p=e("../model"),y=r(p),v=e("../style"),m=r(v),g=e("../event"),_=r(g),b=e("../event-map"),w=r(b),k=e("../core/utils"),x=r(k),O=e("../core/logger"),P=[];"undefined"!=typeof window&&window.addEventListener("resize",function(){P.forEach(function(e){e.resize()})});var j=function(e){function t(e,n){i(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Object.assign({type:"root",scale:{x:1,y:1}},e||{}),n));e=e||{},r._app=n,r.eventEngine=new _.Engine(r),r.indexMap={},r.templateMap={},r.target_element=e.target_element,r._selected=[],r._focused=null,r.style=e.style,r.rebuildContentModel(r.model.model),P.push(r);var o=r;return r._onevent=function(e){o.onevent(e)},r}return u(t,e),s(t,[{key:"dispose",value:function(){this._ua_event_handler&&this._ua_event_handler.dispose(),this.components.forEach(function(e){return e.dispose()}),this._app.dispose();var e=P.indexOf(this);e>=0&&P.splice(e,1),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispose",this).call(this),delete this.indexMap,delete this.templateMap}},{key:"isRoot",value:function(){return!0}},{key:"debounce_apply_mappings",value:function(){var e=this;this._debounce_apply_mappings||(this._debounce_apply_mappings=x.debounce(function(){e._applyMappings(e)},120)),this._debounce_apply_mappings()}},{key:"variable",value:function(e,t){var n=this.findById(e);if(!n){var r=this.findTemplateFor(e);if(!r)return;var o=Object.assign(x.clone(r.hierarchy),{id:e,templatePrefix:""});n=y.compile(o,this.app),this.model_layer.addComponent(n)}return"undefined"==typeof t?n.data:(n.set("data",t),void n.touch())}},{key:"buildVariables",value:function(e){var t=this,n=-120,r=0;!e||e instanceof Array||(e=Object.keys(e).map(function(t){var n=e[t];return n.key=t,n})),e&&e.forEach(function(e,o){var i=t.indexMap[e.key];if(i)i.set({data:e.value,mappings:e.mappings&&e.mappings.slice(),dataType:e.dataType});else{var a=y.compile({type:"variable",id:e.key,left:n,top:r+20*o,strokeStyle:"black",width:100,height:20,dataType:e.type,data:e.value,mappings:e.mappings&&e.mappings.slice()},t.app);t.model_layer.addComponent(a)}})}},{key:"addTemplate",value:function(e,t){var n=this.templateMap[e];n&&O.error("Template replaced (duplicated)",e,t,n),this.templateMap[e]=t,delete this.templatePrefixes}},{key:"removeTemplate",value:function(e,t){var n=this.templateMap[e];n!==t?O.warn("Removing template failed (different)",e,t,n):delete this.templateMap[e],delete this.templatePrefixes}},{key:"findTemplateFor",value:function(e){this.templatePrefixes||(this.templatePrefixes=Object.keys(this.templateMap).sort().reverse());var t=this.templatePrefixes.find(function(t){return e.startsWith(t)});return t?this.templateMap[t]:void 0}},{key:"addIndex",value:function(e,t){var n=this.indexMap[e];n&&O.error("Index replaced (duplicated)",e,t,n),this.indexMap[e]=t}},{key:"removeIndex",value:function(e,t){var n=this.indexMap[e];n!==t?O.warn("Removing alias index failed (different)",e,t,n):delete this.indexMap[e]}},{key:"findById",value:function(e){return this.indexMap[e]}},{key:"resize",value:function(){this.components.forEach(function(e){e.resize&&e.resize()}),this.invalidate()}},{key:"rebuildContentModel",value:function(e){var t=this;this.eventEngine&&this.eventEngine.dispose(),this.eventEngine=new _.Engine(this),this.assist_handlers&&this.assist_handlers.forEach(function(e){t.eventEngine.remove(e)}),this.assist_layers&&this.assist_layers.map(function(e){e.dispose()}),e=e||{},this.model_layer&&this.model_layer.dispose(),this.indexMap={},this.templateMap={},e.type="model-layer";var n=e.variables;delete e.variables,this.model_layer=y.compile(e,this.app),this.model_layer.target=this.target_element,this.addComponent(this.model_layer),n&&this.buildVariables(n),this.assist_layers=(this.model.layers||[]).map(function(e){var n=y.compile(e,t.app);return n.target=t.target_element,t.addComponent(n),n}),this.assist_handlers=(this.model.handlers||[]).map(function(e){var n={};return t.eventEngine.add(n,w.EventMap.get(e)),n})}},{key:"draw",value:function(){this.components.forEach(function(e){return e.draw()})}},{key:"contains",value:function(){return!0}},{key:"capturePath",value:function(e,t){return this.model_layer.capturePath(e,t)}},{key:"invalidate",value:function(){this.components.forEach(function(e){return e.invalidate()})}},{key:"_applyMappings",value:function(e){var t=this;e.components&&e.components.forEach(function(e){return t._applyMappings(e)}),e.executeMappings()}},{key:"_addTraverse",value:function(e){var t=this;e.components&&e.components.forEach(function(e){return t._addTraverse(e)});var n=e.model,r=n.id,o=n.alias,i=n.templatePrefix;r&&this.addIndex(r,e),o&&o instanceof Array&&o.forEach(function(n){t.addIndex(n,e)}),i&&this.addTemplate(i,e);var a=x.merge({},e.eventMap,e.model.eventMap);this.eventEngine.add(e,a)}},{key:"_removeTraverse",value:function(e){var t=this;e.components&&e.components.forEach(function(e){return t._removeTraverse(e)});var n=e.model,r=n.id,o=n.alias,i=n.templatePrefix;r&&this.removeIndex(r,e),o&&o instanceof Array&&o.forEach(function(n){t.removeIndex(n,e)}),i&&this.removeTemplate(i,e),this.eventEngine.remove(e)}},{key:"onadded",value:function(e,t){this._addTraverse(t),this.debounce_apply_mappings(),this.invalidate()}},{key:"onremoved",value:function(e,t){this._removeTraverse(t),this.invalidate()}},{key:"onchanged",value:function(e,t,n){var r=this;t.templatePrefix&&this.removeTemplate(t.templatePrefix,n.origin),e.templatePrefix&&this.addTemplate(e.templatePrefix,n.origin),t.id&&this.removeIndex(t.id,n.origin),t.alias&&t.alias instanceof Array&&t.alias.forEach(function(e){r.removeIndex(e,n.origin)}),e.id&&this.addIndex(e.id,n.origin),e.alias&&e.alias instanceof Array&&e.alias.forEach(function(e){r.addIndex(e,n.origin)}),(t.id!=e.id||t["class"]!=e["class"])&&this.debounce_apply_mappings()}},{key:"app",get:function(){return this._app}},{key:"appClass",set:function(e){this._app=new e}},{key:"target_element",get:function(){return this._target_element},set:function(e){this._ua_event_handler&&(this._ua_event_handler.dispose(),delete this._ua_event_handler),e&&(this._ua_event_handler=new _.UAEventHandler(this,e)),this.forEach(function(t){return t.target=e}),this._target_element=e}},{key:"unitScale",get:function(){switch(this.model_layer.get("unit")){case"mm":case"cm":case"in":return this.app.PPM/10;case"px":default:return 1}}},{key:"root",get:function(){return this}},{key:"rootModel",get:function(){return this.model_layer}},{key:"stuck",get:function(){return!0}},{key:"selected",get:function(){return(this._selected||[]).filter(function(e){return e.parent})},set:function(e){var t=this._selected;this._selected=e,this.trigger("selected",e,t)}},{key:"focused",get:function(){return this._focused},set:function(e){this._focused!==e&&(this._focused=e,this.invalidate())}},{key:"style",get:function(){return this._style},set:function(e){this._style=e,this._compiled_style=m.compile(e)}},{key:"hasTextProperty",get:function(){return!1}},{key:"components",get:function(){var e=[];return this.model_layer&&e.push(this.model_layer),this.assist_layers?e.concat(this.assist_layers):e}},{key:"eventMap",get:function(){return{"(root)":{"(descendant)":{added:this.onadded,removed:this.onremoved,change:this.onchanged}}}}}]),t}(d["default"]);n["default"]=j,f["default"].memoize(j.prototype,"unitScale",!1)},{"../core/logger":62,"../core/utils":69,"../event":80,"../event-map":74,"../model":105,"../style":108,"./component":17,"./container":18}],50:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("./component"),c=o(l),f=e("./shape"),h=o(f),d=e("./mixins/rect-path"),p=o(d),y=e("../const"),v=(r(y),[1,2,10,20,50,50,50,50,50,50]),m=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u(t,e),s(t,[{key:"_draw",value:function(e){var t=this.model,n=t.lineWidth,r=void 0===n?1:n,o=t.fillStyle,i=void 0===o?"lightgray":o,a=t.font,u=void 0===a?"15px Arial":a,s=t.left,l=t.top,c=(t.rotation,t.origin),f=(t.margin,t.width),h=t.height,d=t.side,p=void 0===d?"bottom":d,y=t.strokeStyle,m=void 0===y?"#000000":y,g=t.scale,_=void 0===g?1:g;e.translate(s,l),e.beginPath();var b=Math.round(r/2);e.rect(-b,-b,f+2*b,h+2*b),e.clip(),e.beginPath(),e.rect(0,0,f,h),i&&(e.fillStyle=i,e.fill()),e.lineWidth=r,e.strokeStyle=m,e.stroke(),e.beginPath(),e.font=u;var w="bottom"!==p,k=w?0:h,x=4*h/5,O=2*h/3,P=1*h/2,j=3*h/5;w&&(x=h-x,O=h-O,P=h-P,j=h-1.5*h/5);var M=_*this.app.PPM/this.root.unitScale,E=Math.ceil(c/M),T=this.app.PPM/M,S=1.1>=T?1:v[Math.round(T)]||100;1!=S&&(E+=(S-E%S)%S);var C=Math.ceil(E*M),A=c+f;for(e.fillStyle=m;A>C;){if(E%10==0){e.moveTo(C-c,P),e.lineTo(C-c,k);var R=(E/10).toString(),I=e.measureText(R);e.fillText(R,C-c-I.width-6,j)}else E%5==0?(e.moveTo(C-c,O),e.lineTo(C-c,k)):(e.moveTo(C-c,x),e.lineTo(C-c,k));E+=S,C=Math.ceil(E*M)}}}]),t}(p["default"](h["default"]));n["default"]=m,c["default"].register("ruler",m)},{"../const":56,"./component":17,"./mixins/rect-path":39,"./shape":51}],51:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function h(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:h(o,t,n)}if("value"in r)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},l=e("./component"),c=r(l),f=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"_post_draw",value:function(e){this.drawFill(e),this.drawStroke(e),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_post_draw",this).call(this,e)}}]),t}(c["default"]);n["default"]=f},{"./component":17}],52:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./component"),l=r(s),c=e("./ellipse"),f=r(c),h={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"ratio",name:"ratio",property:"ratio"},{type:"number",label:"wing",name:"wing",property:"wing"}]},d={ondragmove:function(e,t,n){var r=(n.controls,n.model),o=r.cy,i=r.ry,a=n.transcoordP2S(e.x,e.y),u=(a.y-o)/i*100+100;u>=100?u=100:0>=u&&(u=0),n.set({ratio:u})}},p=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"_draw",value:function(e){{var t=this.model,n=t.ratio,r=void 0===n?30:n,o=t.wing,i=void 0===o?5:o,a=t.cx,u=t.cy,s=t.rx,l=t.ry;t.startAngle,t.endAngle,t.anticlockwise}if(!(3>i)){var c=1.5707963267948966,f=2*Math.PI/i,h=s-r/100*s,d=l-r/100*l;e.save(),e.beginPath(),e.translate(a,u),e.moveTo(s*Math.cos(-c),l*Math.sin(-c)),e.lineTo((s-h)*(Math.cos(f-c)+Math.cos(0-c))/2,(l-d)*(Math.sin(f-c)+Math.sin(0-c))/2);for(var p=1;i>p;p++)e.lineTo(s*Math.cos(f*p-c),l*Math.sin(f*p-c)),e.lineTo((s-h)*(Math.cos(f*(p+1)-c)+Math.cos(f*p-c))/2,(l-d)*(Math.sin(f*(p+1)-c)+Math.sin(f*p-c))/2);e.closePath(),e.restore()}}},{key:"controls",get:function(){var e=this.model,t=e.cx,n=e.cy,r=e.ry,o=e.ratio;return[{x:t,y:n-r+r*(o/100),handler:d}]}},{key:"nature",get:function(){return h}}]),t}(f["default"]);n["default"]=p,l["default"].memoize(p.prototype,"controls",!1),l["default"].register("star",p)},{"./component":17,"./ellipse":30}],53:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=e("./component"),s=r(u),l=e("./mixins/rect-path"),c=r(l),f=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),t}(c["default"](s["default"]));n["default"]=f,s["default"].register("text",f)},{"./component":17,"./mixins/rect-path":39}],54:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./component"),l=r(s),c=e("./shape"),f=r(c),h=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"_draw",value:function(e){var t=this.model,n=t.x1,r=t.y1,o=t.x2,i=t.y2,a=t.x3,u=t.y3;e.beginPath(),e.moveTo(n,r),e.lineTo(o,i),e.lineTo(a,u),e.closePath()}},{key:"contains",value:function(e,t){for(var n=this.model,r=n.x1,o=n.y1,i=n.x2,a=n.y2,u=n.x3,s=n.y3,l=[r,o,i,a,u,s],c=!1,f=0;f<l.length;f+=2){var h=(f+2)%l.length,d=l[f],p=l[f+1],y=l[h],v=l[h+1];p>t!=v>t&&(y-d)*(t-p)/(v-p)+d>e&&(c=!c)}return c}},{key:"mutable",get:function(){return!0}},{key:"path",get:function(){var e=this.model,t=e.x1,n=e.y1,r=e.x2,o=e.y2,i=e.x3,a=e.y3;return[{x:t,y:n},{x:r,y:o},{x:i,y:a}]},set:function(e){this.set({x1:e[0].x,y1:e[0].y,x2:e[1].x,y2:e[1].y,x3:e[2].x,y3:e[2].y})}}]),t}(f["default"]);n["default"]=h,l["default"].memoize(h.prototype,"path",!1),l["default"].register("triangle",h)},{"./component":17,"./shape":51}],55:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./component"),l=r(s),c=e("./shape"),f=r(c),h=e("./mixins/rect-path"),d=r(h),p={mutable:!1,resizable:!0,rotatable:!1,properties:[]},y=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"_draw",value:function(e){var t=this.bounds,n=t.left,r=t.top,o=t.width,i=t.height;e.beginPath(),e.rect(n,r,o,i)}},{key:"text",get:function(){return this.get("id")}},{key:"rotatable",get:function(){return!1}},{key:"nature",get:function(){return p}}]),t}(d["default"](f["default"]));n["default"]=y,l["default"].register("variable",y)},{"./component":17,"./mixins/rect-path":39,"./shape":51}],56:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.NOTHING={},n.MODE_VIEW=0,n.MODE_EDIT=1,n.MODE_SHIFT=2,n.MAX_UNDO_SIZE=30,n.DPPX="undefined"==typeof window?1:window.devicePixelRatio||(window.matchMedia&&window.matchMedia("(min-resolution: 2dppx), (-webkit-min-device-pixel-ratio: 1.5),(-moz-min-device-pixel-ratio: 1.5),(min-device-pixel-ratio: 1.5)").matches?2:1)||1,n.GESTURES=["mousemove","mouseup","mousedown","mouseout","wheel","click","touchstart","touchmove","touchend","dblclick"],n.KEYEVENTS=["keydown","keyup"],n.DEFAULT={ALPHA:1,FONT_SIZE:15,FONT_FAMILY:"serif",FONT_COLOR:"black",TEXT_ALIGN:"center",TEXT_BASELINE:"middle",TEXT_WRAP:!1,BOLD:!1,ITALIC:!1}},{}],57:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(){for(var e in s)this[e]=s[e]}function a(){for(var e in s)this[e]=s[e]}Object.defineProperty(n,"__esModule",{value:!0}),n.Stack=n.List=void 0,n.withList=i,n.withStack=a;var u=e("./list"),s=r(u),l=e("./stack"),c=r(l),f=n.List=function d(){o(this,d)},h=n.Stack=function p(){o(this,p)};f.prototype=s,h.prototype=c},{"./list":61,"./stack":67}],58:[function(e,t,n){"use strict";function r(e,t,n){return e===t?!0:(n||(n={}),e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=("undefined"==typeof e?"undefined":u(e))&&"object"!=("undefined"==typeof t?"undefined":u(t))?n.strict?e===t:e==t:a(e,t,n))}function o(e){return null===e||void 0===e}function i(e){return e&&"object"===("undefined"==typeof e?"undefined":u(e))&&"number"==typeof e.length?"function"!=typeof e.copy||"function"!=typeof e.slice?!1:e.length>0&&"number"!=typeof e[0]?!1:!0:!1}function a(e,t,n){var a,c;if(o(e)||o(t))return!1;if(e.prototype!==t.prototype)return!1;if(l(e))return l(t)?(e=s.call(e),t=s.call(t),r(e,t,n)):!1;if(i(e)){if(!i(t))return!1;if(e.length!==t.length)return!1;for(a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0}try{var f=Object.keys(e),h=Object.keys(t)}catch(d){return!1}if(f.length!=h.length)return!1;for(f.sort(),h.sort(),a=f.length-1;a>=0;a--)if(f[a]!=h[a])return!1;for(a=f.length-1;a>=0;a--)if(c=f[a],!r(e[c],t[c],n))return!1;return("undefined"==typeof e?"undefined":u(e))===("undefined"==typeof t?"undefined":u(t))}Object.defineProperty(n,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n["default"]=r;var s=Array.prototype.slice,l=function(e){return"[object Arguments]"==Object.prototype.toString.call(e)},c="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();c&&(l=function(e){return e&&"object"==("undefined"==typeof e?"undefined":u(e))&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1})},{}],59:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e,t,n,r){if(!n)return!0;if("object"==("undefined"==typeof n?"undefined":u(n))){for(var o in n){var i=n[o];e[t].apply(e,[o,i])}return!1}if(f.test(n)){var a=n.split(f);return a.forEach(function(n){return e[t].apply(e,[n].concat(r))}),!1}return!0}function i(e,t){e.forEach(function(e){return e.callback.apply(e.ctx,t)})}function a(e,t){e.forEach(function(e){return d.delegate.apply(e,t)})}Object.defineProperty(n,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=e("./utils"),l=r(s),c=e("./collection"),f=/\s+/,h=["on","off","once","delegate_on","delegate_off","trigger","listenTo"],d={withEvent:function(){var e=this;h.forEach(function(t){return e[t]=d[t]})},on:function(e,t,n){if(!o(this,"on",e,[t,n])||!t)return this;this._listeners||(this._listeners={});var r=this._listeners[e]||(this._listeners[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function m(e,t,n){if(!o(this,"once",e,[t,n])||!t)return this;var r=this,m=l.once(function(){r.off(e,m),t.apply(r,arguments)});m._callback=t,this.on(e,m,n)},off:function(e,t,n){if(!this._listeners||!o(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._listeners=void 0,this;var r;r=e?[e]:Object.keys(this._listeners);for(var i=0;i<r.length;i++){var a=r[i],u=this._listeners[a];if(u){var s=[];if(this._listeners[a]=s,t||n)for(var l=0;l<u.length;l++){var c=u[l];(t&&t!==c.callback&&t!==c.callback._callback||n&&n!==c.context)&&s.push(c)}s.length||delete this._listeners[a]}}return this},delegate_on:function(e){return this._delegators||(this._delegators=new c.List),this._delegators.append(e),this},delegate_off:function(e){return this._delegators?(this._delegators.remove(e),this):this},delegate:function(){if(this._delegators&&this._delegators.size()>0&&a(this._delegators,arguments),!this._listeners)return this;var e=arguments.length-1,t=arguments[e];arguments[e]={origin:t.origin,name:t.name,deliverer:this};var n=this._listeners[t.name],r=this._listeners["(all)"];return n&&i(n,arguments),r&&i(r,arguments),this},trigger:function(e){var t=[].slice.call(arguments,1);if(t.push({origin:this,name:e,deliverer:this}),this._delegators&&this._delegators.size()>0&&a(this._delegators,t),!this._listeners)return this;if(!o(this,"trigger",e,t))return this;var n=this._listeners[e],r=this._listeners["(all)"];return n&&i(n,t),r&&i(r,t),this},stopListening:function(e,t,n){var r=this._listeningTo;if(!r)return this;var o=!t&&!n;n||"object"!=("undefined"==typeof t?"undefined":u(t))||(n=this),e&&(r={},r[e._listenId]=e);for(var i in r){var a=r[i];a.off(t,n,this),(o||l.isEmpty(a._events))&&delete this._listeningTo[i]}return this}},p={listenTo:"on",listenToOnce:"once"};for(var y in p){var v=p[y];d[y]=function(e,t,n){this._listeningTo||(this._listeningTo={});

var r=this._listeningTo;e._listenId||(e._listenId=l.uniqueId("l"));var o=e._listenId;return r[o]=e,n||"object"!=("undefined"==typeof t?"undefined":u(t))||(n=this),e[v](t,n,this),this}}n["default"]=d},{"./collection":57,"./utils":69}],60:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./logger");Object.defineProperty(n,"logger",{enumerable:!0,get:function(){return r(o)["default"]}});var i=e("./event");Object.defineProperty(n,"event",{enumerable:!0,get:function(){return r(i)["default"]}});var a=e("./mixin");Object.defineProperty(n,"mixin",{enumerable:!0,get:function(){return r(a)["default"]}})},{"./event":59,"./logger":62,"./mixin":64}],61:[function(e,t,n){"use strict";function r(e,t){if(!this.__collection__)return this;var e=this.__collection__.indexOf(t);return-1==e&&this.__collection__.splice(e,0,t),this}function o(e){return this.__collection__||(this.__collection__=[]),-1==this.__collection__.indexOf(e)&&this.__collection__.push(e),this}function i(e){return this.__collection__||(this.__collection__=[]),-1==this.__collection__.indexOf(e)&&this.__collection__.unshift(e),this}function a(e){if(!this.__collection__)return this;var t=this.__collection__.indexOf(e);return t>=0&&this.__collection__.splice(t,1),this}function u(e){return this.__collection__?this.__collection__[e]:void 0}function s(e,t){this.__collection__&&this.__collection__.forEach(e,t)}function l(e){return this.__collection__?this.__collection__.indexOf(e):void 0}function c(){return this.__collection__?this.__collection__.length:0}function f(){this.__collection__=[]}function h(e){var t=this.indexOf(e);-1!=t&&0!=t&&(this.__collection__[t]=this.__collection__[t-1],this.__collection__[t-1]=e)}function d(e){var t=this.indexOf(e);-1!=t&&t!=this.size()-1&&(this.__collection__[t]=this.__collection__[t+1],this.__collection__[t+1]=e)}function p(e){var t=this.indexOf(e);if(-1!=t&&0!=t){var n=this.__collection__.splice(0,t),r=this.__collection__.splice(1);this.__collection__=this.__collection__.concat(n,r)}}function y(e){var t=this.indexOf(e);if(-1!=t&&t!=this.size()-1){var n=this.__collection__.splice(0,t),r=this.__collection__.splice(1);this.__collection__=n.concat(r,this.__collection__)}}Object.defineProperty(n,"__esModule",{value:!0}),n.insertAt=r,n.append=o,n.prepend=i,n.remove=a,n.getAt=u,n.forEach=s,n.indexOf=l,n.size=c,n.clear=f,n.moveForward=h,n.moveBackward=d,n.moveToHead=p,n.moveToTail=y},{}],62:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});{var r=("undefined"==typeof window?{}:window,"[ERROR]"),o="[WARN]",i="[DEBUG]";n.error=function(){for(var e,t=arguments.length,n=Array(t),o=0;t>o;o++)n[o]=arguments[o];var i=[];n.forEach(function(e){return e&&e.stack&&i.push(e.stack)}),(e=console).error.apply(e,[r].concat(n,[i.join(" ")]))},n.warn=function(){for(var e,t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];var i=[];n.forEach(function(e){return e&&e.stack&&i.push(e.stack)}),(e=console).warn.apply(e,[o].concat(n,[i.join(" ")]))},n.debug=function(){for(var e,t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];return(e=console).log.apply(e,[i].concat(n))}}},{}],63:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e,t,n){var r=e.__lookupGetter__(t);return r?void(n?e.__defineGetter__(t,function(){return void 0===this.__cache__[t]&&(this.__cache__[t]=r.call(this)),u.clone(this.__cache__[t])}):e.__defineGetter__(t,function(){return void 0===this.__cache__[t]&&(this.__cache__[t]=r.call(this)),this.__cache__[t]})):void s.error(t+" is not defined in "+e.constructor.name)}function i(e){e.__cache__={}}Object.defineProperty(n,"__esModule",{value:!0}),n.intercept=o,n.reset=i;var a=e("./utils"),u=r(a),s=e("./logger")},{"./logger":62,"./utils":69}],64:[function(e,t,n){"use strict";function r(e,t){if(t instanceof Array)t.forEach(function(t){return r(e,t)});else{if(e.mixedIn=e.hasOwnProperty("mixedIn")?e.mixedIn:[],e.mixingIn=e.hasOwnProperty("mixingIn")?e.mixingIn:[],e.mixedIn.indexOf(t)>=0)return e;if(e.mixingIn.indexOf(t)>=0)throw new Error("found cyclic dependencies between "+e.mixingIn);e.mixingIn.push(t),t.call(e),e.mixingIn.pop(),e.mixedIn.push(t)}return e}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r},{}],65:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("./logger"),u=e("./mixin"),s=r(u),l=function(){function e(t,n){o(this,e),this.counters={},this.references={},this.creator=t,this.disposer=n}return i(e,[{key:"dispose",value:function(){if(this.disposer)for(var e in this.references)this.disposer.call(null,e,this.references[e]);delete this.references,delete this.counters}},{key:"add",value:function(e,t){var n=this.references[e];if(n)return void a.error(n==t?"Reference ID and target duplicate":"Reference ID duplicate");if(!t){if(!this.creator)return void a.error("Reference target("+t+") is not allowed. Reference creator should be defined.");if(t=this.creator.call(null,e),!t)return void a.error("Reference creator built "+t+".")}var r=this,t=s["default"](t,function(){var e=this;this.release=function(){return r.release(e)}});return this.references[e]=t,this.counters[e]=1,t}},{key:"get",value:function(e,t){var n=this.references[e];if(n){if(!this.counters.hasOwnProperty(e))return void a.error("No Referenced Count");this.counters[e]++}else t&&(n=this.add(e));return n}},{key:"_id",value:function(e){for(var t in this.references){var n=this.references[t];if(n===e)return t}return-1}},{key:"release",value:function(e){var t=this._id(e),n=this.references[t];return n?(this.counters[t]--,void(0==this.counters[t]&&(this.disposer&&this.disposer.call(null,t,n),delete this.references[t],delete this.counters[t],a.debug("RELEASED",t)))):void a.error("No Referenced ID")}},{key:"ids",get:function(){return Object.keys(this.references)}}]),e}();n["default"]=l},{"./logger":62,"./mixin":64}],66:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){!e.brake&&e.dirty&&u(e)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("./utils"),u=a.debounce(function(e){e.brake||e.take()},1e3,!0),s=function(){function e(t,n){r(this,e),this.brake=!1,this.dirty=!1,this.state_holder=t,this.timecapsule=n,this.timecapsule.snapshot_taker=this}return i(e,[{key:"dispose",value:function(){delete this.state_holder,delete this.timecapsule}},{key:"touch",value:function(){this.dirty=!0,o(this)}},{key:"take",value:function(e){(this.dirty||e)&&(this.timecapsule.snapshot(this.state_holder.state),this.dirty=!1)}},{key:"brake",get:function(){return this._brake},set:function(e){this._brake=!!e,o(this)}}]),e}();n["default"]=s},{"./utils":69}],67:[function(e,t,n){"use strict";function r(){throw new Error("Not Implemented Yet")}function o(){throw new Error("Not Implemented Yet")}Object.defineProperty(n,"__esModule",{value:!0}),n.push=r,n.pop=o},{}],68:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./logger"),a=function(){function e(t,n){r(this,e),t=Number(t),!t||0>=t?(i.error("TimeCapsule maxsize should be greater than 0.",t),this.maxsize=10):this.maxsize=t,this.reset(),n&&this.snapshot(n)}return o(e,[{key:"dispose",value:function(){this.reset()}},{key:"snapshot",value:function(e){this.q.splice(this.pos+1,this.q.length-this.pos+1,e),this.q.length>this.maxsize&&this.q.splice(0,this.q.length-this.maxsize),this.pos=this.q.length-1}},{key:"forward",value:function(){return this.snapshot_taker&&this.snapshot_taker.take(),this.forwadable?this.q[++this.pos]:void i.warn("Not forwadable.")}},{key:"backward",value:function(){return this.snapshot_taker&&this.snapshot_taker.take(),this.backwardable?this.q[--this.pos]:void i.warn("Not backwardable.")}},{key:"reset",value:function(){this.q=[],this.pos=-1}},{key:"current",get:function(){return-1!==this.pos?this.q[this.pos]:void i.warn("Non state has been recorded.")}},{key:"length",get:function(){return this.q.length}},{key:"forwadable",get:function(){return this.pos<this.q.length-1}},{key:"backwardable",get:function(){return this.pos>0}},{key:"snapshot_taker",get:function(){return this._snapshot_taker},set:function(e){this._snapshot_taker=e}}]),e}();n["default"]=a},{"./logger":62}],69:[function(e,t,n){"use strict";function r(e){return JSON.parse(JSON.stringify(e))}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"!=("undefined"==typeof e?"undefined":h(e))&&(e={});for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];return n.forEach(function(t){var n=function(n){e[n]="object"!=h(t[n])?t[n]:t[n].length>0?t[n].map(function(e){var r=void 0;return r="object"!=h(t[n])?e:o({},e)}):o(e[n],t[n])};for(var r in t)n(r)}),e}function i(e,t,n){if(!e||!t)return e;for(var r in t){if(e[r]&&n)throw new Error('utils.push attempted to overwrite "'+r+'" while running in protected mode');"object"==h(e[r])&&"object"==h(t[r])?i(e[r],t[r]):e[r]=t[r]}return e}function a(e,t,n){"number"!=typeof t&&(t=d);var r=0,o=null;return function(){function i(){r=null,n||(o=e.apply(a,u))}var a=this,u=arguments,s=n&&!r;return clearTimeout(r),r=setTimeout(i,t),s&&(o=e.apply(a,u)),o}}function u(e,t){"number"!=typeof t&&(t=d);var n=null,r=null,o=null,i=null,u=null,s=0,l=a(function(){i=o=!1},t);return function(){n=this,r=arguments;var a=function(){return s=null,i&&(u=e.apply(n,r)),l};return s||(s=setTimeout(a,t)),o?i=!0:(o=!0,u=e.apply(n,r)),l(),u}}function s(e){var t=!1,n=null;return function(){return t?n:(n=e.apply(void 0,arguments),t=!0,n)}}function l(e){return""+(e||"")+ ++p}function c(e){if(void 0===e)return!0;if("function"==typeof e||"number"==typeof e||"boolean"==typeof e||"[object Date]"===Object.prototype.toString.call(e))return!1;if(null==e||0===e.length)return!0;if("object"==("undefined"==typeof e?"undefined":h(e))){var t=!0;for(var n in e)t=!1;return t}return!1}function f(e){for(;e&&"object"===("undefined"==typeof e?"undefined":h(e));){var t=e;for(var n in e){e=e[n];break}if(e===t){e=void 0;break}}return e}Object.defineProperty(n,"__esModule",{value:!0});var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.clone=r,n.merge=o,n.push=i,n.debounce=a,n.throttle=u,n.once=s,n.uniqueId=l,n.isEmpty=c,n.objToVal=f;var d=100,p=0},{}],70:[function(e,t,n){"use strict";function r(e,t,n){var r=(n.type,n.subType),o=n.from,i=n.to,a=n.colors;switch(r){case"linear":var u=t.createLinearGradient(o.x,o.y,i.x,i.y);break;case"radial":var u=t.createRadialGradient(o.x,o.y,o.r,i.x,i.y,i.r);break;default:var u=t.createLinearGradient(o.x,o.y,i.x,i.y)}a&&(a.forEach(function(e){u.addColorStop(e.endPoint,e.color)}),t.fillStyle=u,t.fill())}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r},{}],71:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n){var r=l[n.type];r&&r(e,t,n)}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o;var i=e("./gradation"),a=r(i),u=e("./shadow"),s=r(u),l={gradation:a["default"],shadow:s["default"]}},{"./gradation":70,"./shadow":72}],72:[function(e,t,n){"use strict";function r(e,t,n){var r=t.left,o=void 0===r?0:r,a=t.top,u=void 0===a?0:a,s=t.blurSize,l=void 0===s?0:s,c=t.color,f=void 0===c?"transparent":c,h=n.rootModel.get("scale")||i;e.shadowOffsetX=o*h.x,e.shadowOffsetY=u*h.y,e.shadowBlur=l*h.x,e.shadowColor=f}function o(e){e.shadowColor="transparent"}Object.defineProperty(n,"__esModule",{value:!0}),n.setShadow=r,n.resetShadow=o;var i={x:1,y:1}},{}],73:[function(e,t,n){"use strict";function r(e,t){a[e]=t}function o(e){delete a[e]}function i(e){return a[e]}Object.defineProperty(n,"__esModule",{value:!0});var a={};n["default"]={register:r,unregister:o,get:i}},{}],74:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0}),n.EventMap=void 0;var o=e("./event-map");Object.defineProperty(n,"EventMap",{enumerable:!0,get:function(){return r(o)["default"]}});{var i=e("./text-editor-lite"),a=(r(i),e("./move-handler")),u=(r(a),e("./info-window"));r(u)}},{"./event-map":73,"./info-window":75,"./move-handler":76,"./text-editor-lite":77}],75:[function(e){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e){for(var t=0,n=1,r=e;r;){t+=r.get("rotation")||0;var o=r.get("scale")||{x:1,y:1},i=o.x,a=o.y;n*=Math.max(i,a)||1,r=r.parent}return{rotation:t,scale:n}}function r(e){var t=e.bounds,r=t.left,o=t.top,u=t.width,s=(t.height,document.createElement("div"));a.GESTURES.forEach(function(e){s.addEventListener(e,function(e){e.stopPropagation()})}),a.KEYEVENTS.forEach(function(e){s.addEventListener(e,function(e){e.stopPropagation()})});var l=30,c=20,f=e.transcoordS2C(r+u/2-l/2,o-c),h=n(e),d=h.rotation,p=h.scale;r*=p,o*=p,l*=p,c*=p;var y=l,v=y,m=c,g=document.createElement("span");g.style.position="absolute",g.style.width=v+"px",g.style.marginLeft=f.x+"px",g.style.marginTop=f.y+"px",g.style.height=m+"px",s.style.position="relative",s.style.overflow="hidden",s.style.resize="none",s.style.outline="none",s.style.border=0,s.style.backgroundColor="#999222",s.style.display="inline-block",s.style.width=y+"px",s.style.height=c+"px";var _="rotate("+d+"rad)";["-webkit-","-moz-","-ms-","-o-",""].forEach(function(e){g.style[e+"transform"]=_,g.style[e+"transform-origin"]="0 0"});var b=e.root.target_element;g.appendChild(s),b.appendChild(g),i=g}function o(e,t){r(t.origin)}var i,a=e("../const"),u=e("./event-map"),s=t(u);s["default"].register("info-window",{"model-layer":{"(descendant)":{click:o}}})},{"../const":56,"./event-map":73}],76:[function(e){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function r(e,t){var n=t.origin,r=t.deliverer;if(!n.stuck){var o=r.selected,i=r.selected.filter(function(e){return!e.stuck});if(o.length!==i.length&&(o=r.selected=i),0!=o.length){var a=o[0].transcoordC2S(e.offsetX,e.offsetY);a=o[0].transcoordS2P(a.x,a.y),this.last_pos=a,this.direction=b,r.focused=o[0].parent,e.altKey?(r.selected=o.map(function(e){var t=f["default"](e);return e.parent.addComponent(t),t}),this.duplicates=r.selected.map(function(e){return{component:e}})):this.changes=v["default"].before(o)}}}function o(e,t){var n=t.origin,r=t.deliverer;if(!n.stuck){var o=r.selected;if(0!=o.length){var i=o[0].transcoordC2S(e.offsetX,e.offsetY),a=i.x,u=i.y,s=o[0].transcoordS2P(a,u);e.shiftKey?this.direction==w&&(this.direction=b):this.direction=w;var l=s.x-this.last_pos.x,c=s.y-this.last_pos.y;if(this.direction==b){if(25>l*l+c*c)return;this.direction=Math.abs(l)>Math.abs(c)?k:x}this.direction==k?c=0:this.direction==x&&(l=0),o.forEach(function(e){e.move({x:l,y:c})}),o.forEach(function(e){e.parent&&e.parent.calculateBounds&&e.parent.calculateBounds()}),this.last_pos=s,P(r,o)}}}function i(e,t){var n=t.origin,r=t.deliverer;if(!n.stuck){var o=r.selected;if(0!=o.length){var i=n.parent,a=r.focused||t.deliverer;if(this.changes)if(a&&a!==i){var u=this.changes.map(function(e){{var t=e.component;e.before}return{component:t,to_container:a}});r.app.commander.execute(new g["default"]({changes:u}))}else v["default"].after(this.changes,r.app.commander);else if(this.duplicates){this.duplicates=this.duplicates.map(function(e){return e.to_container=a,e});var s=new g["default"]({changes:this.duplicates});r.app.commander.execute(s)}this.last_pos=null,this.changes=null,P(r,o,!0)}}}function a(e,t){var n=t.origin,r=t.deliverer,o={},i=e.shiftKey?n.rootModel.MPP:1;switch(e.which){case 37:o.x=-i,o.y=0;break;case 38:o.x=0,o.y=-i;break;case 39:o.x=i,o.y=0;break;case 40:o.x=0,o.y=i;break;default:return}var a=r.selected;v["default"].around(a,r.app.commander,function(){a.forEach(function(e){!e.stuck&&e.move(o)})})}var u=e("../const"),s=(n(u),e("./event-map")),l=t(s),c=e("../model/duplicate"),f=t(c),h=e("../components/component"),d=(t(h),e("../components/container")),p=(t(d),e("../components/group")),y=(t(p),e("../command/command-change")),v=t(y),m=e("../command/command-migrate"),g=t(m),_=e("../core/utils"),b=0,w=2,k=3,x=4,O=300,P=_.debounce(function(e,t,n){if(n)return void(e.focused=null);var r=[];t[0].parent.isGroup()?e.focused=t[0].parent:(t.forEach(function(e){e.path.forEach(function(t){r.push(e.transcoordS2T(t.x,t.y))})}),e.focused=e.capturePath(r,t))},O);l["default"].register("move-handler",{"model-layer":{"(descendant)":{dragstart:r,dragmove:o,dragend:i}},"(root)":{"(self)":{keydown:a}}})},{"../command/command-change":12,"../command/command-migrate":13,"../components/component":17,"../components/container":18,"../components/group":34,"../const":56,"../core/utils":69,"../model/duplicate":104,"./event-map":73}],77:[function(e){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e){for(var t=0,n=1,r=e;r;){t+=r.get("rotation")||0;var o=r.get("scale")||{x:1,y:1},i=o.x,a=o.y;n*=Math.max(i,a)||1,r=r.parent}return{rotation:t,scale:n}}function r(e,t){var n=(t.origin,t.deliverer),r=n.selected;return 1===r.length&&r[0].hasTextProperty&&("Enter"==e.code||"NumpadEnter"==e.code)?(i(r[0]),e.preventDefault(),!0):!1}function o(e,t){i(t.origin)}function i(e){function t(t){var n=F*a(e,t,$,H);switch(B.style.height=n+"px",P){case"top":case"hanging":break;case"bottom":case"alphabetic":B.style.marginTop=Z-n+"px";break;case"middle":default:B.style.marginTop=Z/2-n/2+"px"}if(!m){var r=u(e,t,$,H);switch(B.style.width=r+"px",x){case"right":case"end":B.style.marginLeft=H-r+"px";break;case"left":case"start":break;case"center":case"justify":default:B.style.marginLeft=(H-r)/2+"px"}}}if(e.hasTextProperty){var r=e.model,o=r.text,i=void 0===o?"":o,l=r.rotation,c=void 0===l?0:l,f=r.bold,d=void 0===f?s.DEFAULT.BOLD:f,p=r.italic,y=void 0===p?s.DEFAULT.ITALIC:p,v=r.textWrap,m=void 0===v?s.DEFAULT.TEXT_WRAP:v,g=r.fontFamily,_=void 0===g?s.DEFAULT.FONT_FAMILY:g,b=r.fontColor,w=void 0===b?s.DEFAULT.FONT_COLOR:b,k=r.textAlign,x=void 0===k?s.DEFAULT.TEXT_ALIGN:k,O=r.textBaseline,P=void 0===O?s.DEFAULT.TEXT_BASELINE:O,j=r.paddingTop,M=void 0===j?0:j,E=r.paddingBottom,T=void 0===E?0:E,S=r.paddingLeft,C=void 0===S?0:S,A=r.paddingRight,R=void 0===A?0:A,I=r.fontSize,D=void 0===I?s.DEFAULT.FONT_SIZE:I,L=r.lineHeight,F=void 0===L?1.2*D:L,z=e.bounds,N=z.left,G=z.top,q=z.width,X=z.height,Y=e.textHidden;e.textHidden=!0;var B=document.createElement("textarea");s.GESTURES.forEach(function(e){B.addEventListener(e,function(e){e.stopPropagation()})}),s.KEYEVENTS.forEach(function(e){B.addEventListener(e,function(e){e.stopPropagation()})});var U=e.transcoordS2C(N,G),W=n(e),c=W.rotation,V=W.scale;D*=V,N*=V,G*=V,q*=V,X*=V,M*=V,T*=V,C*=V,R*=V,F*=V;var H=q-C-R,K=H,Z=X-M-T,J=document.createElement("span");switch(J.style.position="absolute",J.style.width=K+"px",J.style.marginLeft=U.x+Math.min(C,0)+"px",J.style.marginTop=U.y+Math.min(M,0)+"px",J.style.height=Z+"px",J.style.paddingLeft=Math.max(C,0)+"px",J.style.paddingRight=R+"px",J.style.paddingTop=Math.max(M,0)+"px",J.style.paddingBottom=T+"px",B.value=i,B.style.fontFamily=_,B.style.fontSize=D+"px",B.style.position="relative",B.style.lineHeight=F+"px",B.style.overflow="hidden",B.style.resize="none",B.style.outline="none",B.style.border=0,B.style.backgroundColor="transparent",B.style.display="inline-block",B.style.color=w,B.style.width=H+"px",d&&(B.style.fontWeight="bold"),y&&(B.style.fontStyle="italic"),x){case"right":case"end":B.style.textAlign="right";break;case"justify":case"left":case"start":B.style.textAlign="left";break;case"center":default:B.style.textAlign="center"}var Q="rotate("+c+"rad)";["-webkit-","-moz-","-ms-","-o-",""].forEach(function(e){J.style[e+"transform"]=Q,J.style[e+"transform-origin"]="0 0"});var $=[d,y,D+"px",_].filter(function(e){return!!e}).join(" ");t(i);var ee=e.root.target_element;J.appendChild(B),ee.appendChild(J),B.select(),B.onkeydown=function(e){"Escape"!=e.code&&(e.shiftKey||"Enter"!=e.code&&"NumpadEnter"!=e.code)?setTimeout(function(){t(B.value)},1):(te.skipUpdate="Escape"==e.code,document.createEvent?B.dispatchEvent(te):B.fireEvent(te.eventType,te))};var te;document.createEvent?(te=document.createEvent("HTMLEvents"),te.initEvent("blur",!0,!1)):(te=document.createEventObject(),te.eventType="blur");var ne=e.root.selected,re=function oe(t){e.root.selected=ne,e.textHidden=Y,B.removeEventListener("blur",oe,!1),ee.removeChild(J),ee.focus(),t.skipUpdate||e.app.commander.execute(new h["default"]({changes:[{component:e,before:{text:i},after:{text:B.value}}]}))};B.addEventListener("blur",re,!1)}}function a(e,t,n,r){var o,i=e.getContext();return i.save(),i.font=n,o=p["default"](i,t,r,e.get("textWrap")).length,i.restore(),o}function u(e,t,n,r){var o=t.split("\n"),i=r,a=e.getContext();return a.save(),a.font=n,o.forEach(function(e){var t=a.measureText(e).width;t>i&&(i=t)}),a.restore(),i}var s=e("../const"),l=e("./event-map"),c=t(l),f=e("../command/command-change"),h=t(f),d=e("../components/drawer/text-wrapper"),p=t(d);c["default"].register("text-editor",{"(root)":{"(self)":{keydown:r}},"model-layer":{"(descendant)":{dblclick:o}}})},{"../command/command-change":12,"../components/drawer/text-wrapper":28,"../const":56,"./event-map":73}],78:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("./event-pump"),s=o(u),l=e("../model/selector"),c=r(l),f=function(){function e(t){i(this,e),this.eventMaps=[],this.root=t,t.eventMap&&this.add(t,t.eventMap)}return a(e,[{key:"stop",value:function(){this.eventMaps.forEach(function(e){return e.eventPump.stop()})}},{key:"add",value:function(e,t){var n=this;if(this.root){var r=function(r){var o=t[r];if("(self)"===r&&"undefined"==typeof e.on)throw new Error("(self) selector not available when deliverer is not a event handlable object.");var i=c.select(r,n.root,e);i.forEach(function(r){var i=new s["default"](r);i.on(e,o),i.start(),n.eventMaps.push({eventPump:i,listener:e,handlerMap:t,deliverer:r})})};for(var o in t)r(o)}}},{key:"remove",value:function(e,t){for(var n=this.eventMaps.slice(0),r=0;r<n.length;r++){var o=n[r];o.listener!==e||t&&o.handlerMap!==t||(this.eventMaps.splice(r,1),o.eventPump.dispose())}}},{key:"clear",value:function(){var e=this.eventMaps.slice(0);e.forEach(function(e){return e.eventPump.dispose()}),this.eventMaps=[]}},{key:"dispose",value:function(){this.stop(),this.clear()}},{key:"root",set:function(e){this._root=e},get:function(){return this._root}}]),e}();n["default"]=f},{"../model/selector":106,"./event-pump":79}],79:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n,r,o){for(var i in n){var a=n[i];if(l.match(i,r.origin,t,e))for(var u in a){var s=a[u];u==r.name&&(r.listener=t,s.apply(t,o))}}}function a(){var e=arguments,t=e[e.length-1],n=this.event_pump;n.listeners.forEach(function(r){i(n.deliverer,r.listener,r.cloned_handlers,t,e)})}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../model/selector"),l=r(s),c=e("../core/logger"),f=function(){function e(t){if(o(this,e),"undefined"==typeof t.on)throw new Error("Deliverer should be a event handlable object.");this.deliverer=t,this.listeners=[]}return u(e,[{key:"start",value:function(){this.deliverer.on("(all)",a,{event_pump:this})}},{key:"stop",value:function(){this.deliverer.off("(all)",a)}},{key:"on",value:function(e,t){var n=Object.assign({},t),r=Object.keys(n);r.forEach(function(t){if(0==t.indexOf("?")){var r=n[t],o=t.substr(1),i=e.get(o);delete n[t],i?n[i]=r:c.warn("EventPump#on","variable #{selector} is not evaluated on listener")}}),this.listeners.push({listener:e,handlers:t,cloned_handlers:n})}},{key:"off",value:function(e,t){for(var n=0;n<this.listeners.length;n++){var r=this.listeners[n];r.listener!==e||t&&r.handlers!==t||this.listeners.splice(n,1)}}},{key:"clear",value:function(){this.listeners=[]}},{key:"dispose",value:function(){this.stop(),this.clear()}}]),e}();n["default"]=f},{"../core/logger":62,"../model/selector":106}],80:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./event-engine");Object.defineProperty(n,"Engine",{enumerable:!0,get:function(){return r(o)["default"]}});var i=e("./ua-event-handler");Object.defineProperty(n,"UAEventHandler",{enumerable:!0,get:function(){return r(i)["default"]}})},{"./event-engine":78,"./ua-event-handler":81}],81:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){if(e.touches){var t=e.touches[0];return t?v={x:t.pageX-t.target.offsetLeft,y:t.pageY-t.target.offsetTop}:v}return{x:e.offsetX,y:e.offsetY}}function u(e,t){return e.capture(t.offsetX,t.offsetY)}function s(e,t,n){if(e){n.type=t;var r="on"+t;e[r]&&e[r](n),n.isPropagationStopped()||e.trigger(t,n)}}Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=e("../components/component"),f=(o(c),e("../components/container")),h=(o(f),e("../const")),d=r(h),p=e("../core/utils"),y={NORMAL:0,DRAGGABLE:1,DRAGGING:2},v={},m=function(){function e(t){i(this,e),this._type=t.type,this._ctrlKey=t.ctrlKey,this._altKey=t.altKey,this._shiftKey=t.shiftKey,this._metaKey=t.metaKey;var n=a(t);this._offsetX=n.x,this._offsetY=n.y,"wheel"==t.type&&(this.deltaX=t.deltaX,this.deltaY=t.deltaY,this.deltaZ=t.deltaZ)}return l(e,[{key:"stopPropagation",value:function(){this._stop_=!0}},{key:"isPropagationStopped",value:function(){return this._stop_}},{key:"type",get:function(){return this._type},set:function(e){this._type=e}},{key:"offsetX",get:function(){return this._offsetX}},{key:"offsetY",get:function(){return this._offsetY}},{key:"altKey",get:function(){return this._altKey}},{key:"ctrlKey",get:function(){return this._ctrlKey}},{key:"shiftKey",get:function(){return this._shiftKey}},{key:"metaKey",get:function(){return this._metaKey}}]),e}(),g=p.throttle(function(e){return e.status!==y.DRAGGING?void delete e.__dragmove_e:void s(e.last_target,"dragmove",e.__dragmove_e)},30),_=function(){function e(t,n){var r=this;i(this,e),this.container=t,this.html_element=n,this.status=y.NORMAL,this.last_target=null,this._gestureHandler=this.ongesture.bind(this),this._keydownHander=this.onkeydown.bind(this),this._keyupHander=this.onkeyup.bind(this),d.GESTURES.map(function(e){return n.addEventListener(e,r._gestureHandler)}),n.addEventListener("keydown",this._keydownHander),n.addEventListener("keyup",this._keyupHander),n.tabIndex=1}return l(e,[{key:"dispose",value:function(){var e=this;d.GESTURES.forEach(function(t){return e.html_element.removeEventListener(t,e._gestureHandler)}),this.html_element.removeEventListener("keydown",this._keydownHander),this.html_element.removeEventListener("keyup",this._keyupHander)}},{key:"ongesture",value:function(e){var t=this["on"+e.type](new m(e));return t&&e.preventDefault(),!1}},{key:"onclick",value:function(e){var t=u(this.container,e);return s(t,e.type,e),this.last_target=null,!1}},{key:"ondblclick",value:function(e){var t=u(this.container,e);return s(t,e.type,e),this.last_target=null,!1}},{key:"onkeydown",value:function(e){return this.container.trigger(e.type,e),!1}},{key:"onkeyup",value:function(e){return this.container.trigger(e.type,e),!1}},{key:"onmousemove",value:function(e){switch(this.status){case y.DRAGGABLE:this.status=y.DRAGGING,s(this.last_target,"dragstart",this.__dragstart_e),this.__dragmove_e=e,g(this);break;case y.DRAGGING:this.__dragmove_e=e,g(this);break;default:var t=u(this.container,e);this.last_target!=t&&(this.last_target&&s(this.last_target,"mouseleave",e),t&&s(t,"mouseenter",e)),s(t,e.type,e),this.last_target=t}return!1}},{key:"onmousedown",value:function(e){var t=u(this.container,e);return this.last_target=t,this.status=y.DRAGGABLE,this.__dragstart_e=e,s(t,e.type,e),!1}},{key:"onmouseup",value:function(e){switch(this.status){case y.DRAGGING:s(this.last_target,"dragend",e);break;default:var t=u(this.container,e);s(t,e.type,e)}return this.last_target=null,this.status=y.NORMAL,!1}},{key:"onmouseout",value:function(e){switch(this.status){case y.DRAGGING:s(this.last_target,"dragend",e);break;default:this.last_target&&s(this.last_target,e.type,e)}return this.last_target=null,this.status=y.NORMAL,!1}},{key:"ontouchstart",value:function(e){var t=u(this.container,e);return this.last_target=t,this.status=y.DRAGGABLE,s(t,"mousedown",e),!1}},{key:"ontouchmove",value:function(e){switch(this.status){case y.DRAGGABLE:this.status=y.DRAGGING,s(this.last_target,"dragstart",e),s(this.last_target,"dragmove",e);break;case y.DRAGGING:s(this.last_target,"dragmove",e);break;default:var t=u(this.container,e);this.last_target!=t&&(this.last_target&&s(this.last_target,"mouseleave",e),t&&s(t,"mouseenter",e)),s(t,e.type,e),this.last_target=t}return!1}},{key:"ontouchend",value:function(e){switch(this.status){case y.DRAGGING:s(this.last_target,"dragend",e);break;default:var t=u(this.container,e);s(t,"mouseup",e),s(t,"click",e)}return this.last_target=null,this.status=y.NORMAL,!1}},{key:"onwheel",value:function(e){var t=u(this.container,e);return s(t,e.type,e),!0}}]),e}();n["default"]=_},{"../components/component":17,"../components/container":18,"../const":56,"../core/utils":69}],82:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);

return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){return{left:-e.x,top:-e.y,width:O,height:I}}function l(e,t){return{left:O-e.x,top:P-e.y,origin:j-e.x,width:t-O,height:I}}function c(e,t,n){var r={x:-e.x+M+I/2,y:-e.y+E+(n-E)/2},o=y["default"].transcoordRR(-e.x+M,-e.y+E,r,S);return{left:o.x-(n-E),top:o.y,origin:T-e.y,width:n-E,height:I}}function f(e){var t=e.get("translate");return{left:-t.x,top:-t.y,width:e.canvas.width/x.DPPX,height:e.canvas.height/x.DPPX}}Object.defineProperty(n,"__esModule",{value:!0});var h=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=function z(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:z(o,t,n)}if("value"in r)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},p=e("../components/component"),y=o(p),v=e("./layer"),m=o(v),g=e("../components/ruler"),_=o(g),b=e("../components/rect"),w=o(b),k=e("../const"),x=r(k),O=20,P=0,j=20,M=0,E=20,T=20,S=90*Math.PI/180,C="m",A=0,R="9px Verdana",I=20,D="#f4f4f4",L="#999",F=function(e){function t(e,n){i(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r.appScale={x:1,y:1},"disabled"!==e.ruler&&(r.hruler=new _["default"]({left:O,top:P,origin:j,margin:A,height:I,unit:C,rotation:0,font:R,fillStyle:D,strokeStyle:L,capturable:!1}),r.vruler=new _["default"]({left:0,top:0,origin:T,margin:A,height:I,unit:C,rotation:S,font:R,side:"top",fillStyle:D,strokeStyle:L,capturable:!1}),r.origin_rect=new w["default"]({left:-j,top:-T,width:j,height:T,fillStyle:D,strokeStyle:L,lineWidth:1}),r.addComponent(r.hruler),r.addComponent(r.vruler),r.addComponent(r.origin_rect)),r.invalidate(),r}return u(t,e),h(t,[{key:"added",value:function(){if(!this.hruler)return void(this.screen_coord=f(this));var e=this.rootModel,t=Object.assign({},e.get("translate"));t.x<O&&(t.x+=O),t.y<E&&(t.y+=E);var n=e.get("scale")||{x:1,y:1};this.appScale=n,this.hruler.set("scale",n.x),this.vruler.set("scale",n.y),e.set("translate",t),this.set("translate",t),this.screen_coord=f(this);var r=this.screen_coord,o=r.width,i=r.height;this.hruler.set(l(t,o,i,this.hruler)),this.vruler.set(c(t,o,i,this.vruler)),this.origin_rect.set(s(t,o,i))}},{key:"resize",value:function(){d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"resize",this).call(this),this.screen_coord=f(this);var e=this.screen_coord,n=e.width,r=e.height;this.hruler&&(this.hruler.set(l(this.model.translate,n,r,this.hruler)),this.vruler.set(c(this.model.translate,n,r,this.vruler)),this.origin_rect.set(s(this.model.translate,n,r)))}},{key:"_draw",value:function(e){if(this.guide){e.save();var t=this.guide,n=t.x,r=t.y,o=this.screen_coord,i=o.top,a=o.left,u=o.width,s=o.height;e.beginPath(),e.moveTo(n,i),e.lineTo(n,i+s),e.moveTo(a,r),e.lineTo(a+u,r),e.lineWidth=1,e.strokeStyle="tomato",e.setLineDash([2,3]),e.font="10px tahoma",e.fillStyle="#333";var l=this.transcoordS2C(n,r,this.rootModel);e.textBaseline=l.y>200?"bottom":"top",e.textAlign=l.x>200?"right":"left";var c=l.y>200?-5:5,f=l.x>200?-5:5,h=Math.round(n/this.appScale.x),d=Math.round(r/this.appScale.y);e.fillText(" "+h+", "+d+" ",n+f,r+c),e.stroke(),e.restore()}}},{key:"contains",value:function(){return!0}},{key:"onmousedown_origin",value:function(){this.rootModel.set("translate",{x:j,y:T})}},{key:"onchange_root_model",value:function(e){if(e.scale&&(this.appScale=e.scale,this.hruler&&(this.hruler.set("scale",e.scale.x),this.vruler.set("scale",e.scale.y))),e.translate&&this.set({translate:{x:e.translate.x,y:e.translate.y}}),e.scale||e.translate){if(this.screen_coord=f(this),this.hruler){var t=this.model.translate,n=this.screen_coord,r=n.width,o=n.height;this.hruler.set(l(t,r,o,this.hruler)),this.vruler.set(c(t,r,o,this.vruler)),this.origin_rect.set(s(t,r,o))}this._guide=null}this.invalidate()}},{key:"onmouseout_child",value:function(){this._guide=null,this.invalidate()}},{key:"onmousemove_child",value:function(e){this.guide=e.target&&"CANVAS"!==e.target.tagName?null:this.transcoordC2S(e.offsetX,e.offsetY)}},{key:"capturable",get:function(){return!1}},{key:"guide",get:function(){return this._guide},set:function(e){this._guide=e,this.invalidate()}},{key:"eventMap",get:function(){return{"(root)":{"(descendant)":{mousemove:this.onmousemove_child,mouseout:this.onmouseout_child,dragmove:this.onmousemove_child},"model-layer":{change:this.onchange_root_model}},"(self)":{"(descendant)":{mousedown:this.onmousedown_origin}}}}}]),t}(m["default"]);n["default"]=F,y["default"].register("guide-layer",F)},{"../components/component":17,"../components/rect":48,"../components/ruler":50,"../const":56,"./layer":84}],83:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./model-layer");Object.defineProperty(n,"ModelLayer",{enumerable:!0,get:function(){return r(o)["default"]}});var i=e("./guide-layer");Object.defineProperty(n,"GuideLayer",{enumerable:!0,get:function(){return r(i)["default"]}});var a=e("./shift-layer");Object.defineProperty(n,"ShiftLayer",{enumerable:!0,get:function(){return r(a)["default"]}});var u=e("./selection-layer");Object.defineProperty(n,"SelectionLayer",{enumerable:!0,get:function(){return r(u)["default"]}});var s=e("./modeling-layer");Object.defineProperty(n,"ModelingLayer",{enumerable:!0,get:function(){return r(s)["default"]}});var l=e("./tag-layer");Object.defineProperty(n,"TagLayer",{enumerable:!0,get:function(){return r(l)["default"]}})},{"./guide-layer":82,"./model-layer":85,"./modeling-layer":93,"./selection-layer":94,"./shift-layer":95,"./tag-layer":96}],84:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){var n=getComputedStyle&&getComputedStyle(e),r=n?parseFloat(n.getPropertyValue("width")):e.offsetWidth,o=n?parseFloat(n.getPropertyValue("height")):e.offsetHeight;t.setAttribute("width",r*m.DPPX),t.setAttribute("height",o*m.DPPX),t.style.width=r+"px",t.style.height=o+"px"}Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function _(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:_(o,t,n)}if("value"in r)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},f=e("../components/component"),h=o(f),d=e("../components/container"),p=o(d),y=e("../core/utils"),v=e("../const"),m=r(v),g=function(e){function t(e,n){i(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return e.translate=e.translate||{x:0,y:0},r.throttle_draw="undefined"!=typeof window?y.throttle(function(){requestAnimationFrame(function(){r.reflow(),r.draw(),r.trigger("redraw")})},30):function(){},r}return u(t,e),l(t,[{key:"resize",value:function(){this.canvas&&this.canvas.parentNode&&s(this.canvas.parentNode,this.canvas)}},{key:"isLayer",value:function(){return!0}},{key:"dispose",value:function(){c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispose",this).call(this),window.removeEventListener("resize",this._onresize),this.canvas&&this.canvas.remove(),this.canvas=null}},{key:"getContext",value:function(){return this._context2D||(this._context2D=this.canvas&&this.canvas.getContext("2d")),this._context2D}},{key:"draw",value:function(e){e=e||this.getContext(),e&&c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"draw",this).call(this,e)}},{key:"_pre_draw",value:function(e){var t=this.model,n=t.translate,r=t.scale,o=void 0===r?{x:1,y:1}:r,i=t.rotation;e.clearRect(0,0,e.canvas.width,e.canvas.height),n&&e.translate(n.x*m.DPPX,n.y*m.DPPX),e.scale(o.x*m.DPPX,o.y*m.DPPX),i&&e.rotate(i)}},{key:"contains",value:function(){return!1}},{key:"invalidate",value:function(){this.throttle_draw()}},{key:"move",value:function(e){var t=this.get("translate")||{x:0,y:0};this.set({translate:{x:t.x+e.x,y:t.y+e.y}})}},{key:"target",get:function(){return this._target},set:function(e){this._target&&this.canvas&&this._target.removeChild(this.canvas),this._target=e,e&&(this.canvas||(this.canvas=h["default"].createCanvas(screen.width,screen.height)),e&&(s(e,this.canvas),this.canvas.style.position="absolute",e.appendChild(this.canvas)))}},{key:"selected",get:function(){return this.root.selected},set:function(e){this.root.selected=e}},{key:"focused",get:function(){return this.root.focused},set:function(e){this.root.focused=e}},{key:"rotatePoint",get:function(){return{x:0,y:0}}}]),t}(p["default"]);n["default"]=g},{"../components/component":17,"../components/container":18,"../const":56,"../core/utils":69}],85:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../components/component"),c=o(l),f=e("../components/container"),h=(o(f),e("./layer")),d=o(h),p=e("../core"),y=(r(p),function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u(t,e),s(t,[{key:"contains",value:function(){return!0}},{key:"isRootModel",value:function(){return!0}},{key:"capturePath",value:function(e,t){for(var n=this.layout.capturables(this),r=n.length-1;r>=0;r--){var o=n[r];if(o.isContainer()){var i=o.capturePath(e,t);if(i)return i}}return!1}},{key:"onchange",value:function(e){e.hasOwnProperty("text")&&this.set("text",null),e.hasOwnProperty("id")&&this.set("id",null),e.hasOwnProperty("class")&&this.set("class",null)}},{key:"onchanged",value:function(e,t,n){n.origin.animOnChange&&n.origin.animOnChange.start(),this.invalidate()}},{key:"onmouseenter",value:function(e,n){if(!this.app.isEditMode&&n){var r=n.origin;if(r.model.event&&r.model.event.hover){var o=r.model.event.hover;if(o.emphasize&&!(r instanceof t)){if(r.hasOwnProperty("_backupStrokeStyle"))return;if(r._backupStrokeStyle=r.model.strokeStyle,r.set("strokeStyle","#f26522"),r.hasOwnProperty("_backupLineWidth"))return;r._backupLineWidth=r.model.lineWidth,r.set("lineWidth",r.model.lineWidth+5)}o.hasOwnProperty("target")&&o.hasOwnProperty("value")&&(r._lastValue=this.root.variable(o.target),this.root.variable(o.target,o.value))}}}},{key:"onmouseleave",value:function(e,t){if(!this.app.isEditMode&&t){var n=t.origin;if(n.model.event&&n.model.event.hover){var r=n.model.event.hover;if(r){if(r.emphasize){if(!n.hasOwnProperty("_backupStrokeStyle"))return;if(n.set("strokeStyle",n._backupStrokeStyle),delete n._backupStrokeStyle,!n.hasOwnProperty("_backupLineWidth"))return;n.set("lineWidth",n._backupLineWidth),delete n._backupLineWidth}r.hasOwnProperty("target")&&r.hasOwnProperty("value")&&(this.root.variable(r.target,n._lastValue),delete n._lastValue)}}}}},{key:"onclick",value:function(e,t){if(!this.app.isEditMode&&t){var n=t.origin;if(n.model.event&&n.model.event.tap){var r=n.model.event.tap;r&&r.target&&(/^\$/.test(r.target)?this.root.variable(r.target.substring(1),r.value):this.trigger(r.target,r.value))}}}},{key:"stuck",get:function(){return!0}},{key:"MPP",get:function(){var e=this.model,t=e.scale,n=void 0===t?{x:1,y:1}:t,r=e.unit;switch(r){case"mm":case"cm":return 1/this.app.PPM/n.x;case"in":return 1/this.app.PPI/n.x;case"px":default:return 1/n.x}}},{key:"eventMap",get:function(){return{"(self)":{"(all)":{change:this.onchanged,mouseenter:this.onmouseenter,mouseleave:this.onmouseleave,click:this.onclick}}}}}]),t}(d["default"]));n["default"]=y,c["default"].register("model-layer",y)},{"../components/component":17,"../components/container":18,"../core":60,"./layer":84}],86:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("../../command/command-change"),u=r(a),s=4,l=function(){function e(t){o(this,e),this.layer=t}return i(e,[{key:"reset",value:function(){this.active=null}},{key:"contains",value:function(e,t,n,r){var o=this,i=n.controls;return i?(i.every(function(i,a){return Math.abs(e-i.x)<=s/r.x&&Math.abs(t-i.y)<=s/r.y&&(o.active={component:n,index:a,handler:i.handler}),!o.active}),!!this.active):!1}},{key:"draw",value:function(e,t,n){var r=t.controls;r&&r.forEach(function(t){e.beginPath(),e.lineWidth=1/n.x,e.ellipse(t.x,t.y,s/n.x,s/n.y,0,0,2*Math.PI,!0),e.fillStyle="#ff5d72",e.fill(),e.strokeStyle="#fff",e.stroke()})}},{key:"onevent",value:function(e,t){var n=this.active,r=n.handler,o=n.component,i=n.index,a=o.transcoordC2S(t.offsetX,t.offsetY);a=o.transcoordS2P(a.x,a.y),r&&"function"==typeof r[e]&&r[e](a,i,o)}},{key:"onmousedown",value:function(e){this.onevent("onmousedown",e)}},{key:"ondragstart",value:function(e){var t=this.active;t.changes=u["default"].before([t.component]),this.onevent("ondragstart",e)}},{key:"ondragmove",value:function(e){this.onevent("ondragmove",e)}},{key:"ondragend",value:function(e){this.onevent("ondragend",e);var t=this.active,n=t.component,r=t.changes;u["default"].after(r,n.app.commander),n.parent&&n.parent.calculateBounds&&n.parent.calculateBounds()}},{key:"selected",get:function(){return this.layer.selected}}]),e}();n["default"]=l},{"../../command/command-change":12}],87:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t){r(this,e),this.layer=t}return o(e,[{key:"draw",value:function(e,t){var n=t.bounds;0!=n.width&&0!=n.height&&(e.beginPath(),e.rect(n.left,n.top,n.width,n.height),e.clip(),e.beginPath(),e.strokeStyle="#f26522",e.lineWidth=4,e.shadowBlur=10,e.shadowColor="black",e.shadowOffsetX=0,e.shadowOffsetY=0,e.rect(n.left,n.top,n.width,n.height),e.stroke(),e.closePath())}}]),e}();n["default"]=i},{}],88:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t){r(this,e),this.layer=t}return o(e,[{key:"draw",value:function(e,t,n){var r=t.bounds;e.beginPath(),e.rect(r.left,r.top,r.width,r.height),e.setLineDash([3/n.x,4/n.y]),e.lineWidth=1/n.x,e.strokeStyle="black",e.stroke(),e.setLineDash([]),e.closePath()}}]),e}();n["default"]=i},{}],89:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./focus-outline");Object.defineProperty(n,"FocusOutline",{enumerable:!0,get:function(){return r(o)["default"]}});var i=e("./group-outline");Object.defineProperty(n,"GroupOutline",{enumerable:!0,get:function(){return r(i)["default"]}});var a=e("./control-handler");Object.defineProperty(n,"ControlHandler",{enumerable:!0,get:function(){return r(a)["default"]}});var u=e("./path-handler");Object.defineProperty(n,"PathHandler",{enumerable:!0,get:function(){return r(u)["default"]}});var s=e("./resizer");Object.defineProperty(n,"Resizer",{enumerable:!0,get:function(){return r(s)["default"]}});var l=e("./rotator");Object.defineProperty(n,"Rotator",{enumerable:!0,get:function(){return r(l)["default"]}})},{"./control-handler":86,"./focus-outline":87,"./group-outline":88,"./path-handler":90,"./resizer":91,"./rotator":92}],90:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}function a(e,t){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}function u(e,t,n){return{x:Math.cos(t)*n+e.x,y:Math.sin(t)*n+e.y}}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../../command/command-change"),c=r(l),f=15*Math.PI/180,h=4,d=function(){function e(t){o(this,e),this.layer=t}return s(e,[{key:"reset",value:function(){this.active=null}},{key:"contains",value:function(e,t,n,r){var o=this;return n.mutable?(n.path.every(function(i,a){return Math.abs(e-i.x)<=h/r.x&&Math.abs(t-i.y)<=h/r.y&&(o.active={component:n,index:a}),!o.active}),!!this.active):!1}},{key:"draw",value:function(e,t,n){if(t.mutable&&!t.stuck){var r=t.path,o=this.active;r.forEach(function(r,i){e.beginPath(),e.ellipse(r.x,r.y,h/n.x,h/n.y,0,0,2*Math.PI,!0),e.lineWidth=1/n.x,e.strokeStyle="#656565",e.fillStyle="#fff",o&&o.component===t&&o.index===i&&(e.strokeStyle="#fa7703",o.toFill&&(e.fillStyle="#ffb80c")),e.fill(),e.stroke()})}}},{key:"ondblclick",value:function(){var e=this.active.component;if(e.pathExtendable){var t=e.path.slice();t.length<4||(t.splice(this.active.index,1),e.path=t)}}},{key:"onmousedown",value:function(){this.active.toFill=!0}},{key:"ondragstart",value:function(){var e=this.active;e.changes=c["default"].before([e.component])}},{key:"ondragmove",value:function(e){var t=this.active,n=t.component,r=t.index,o=n.transcoordC2S(e.offsetX,e.offsetY);if(o=n.transcoordS2P(o.x,o.y),e.shiftKey){var s=n.path,l=s.length,c=n.isLine()&&0==r?n.path[1]:n.path[(r-1+l)%l];c=n.transcoordS2P(c.x,c.y);var h=0;if(l>2){var d;n.isLine()?0==r?d=n.path[2]:1!=r&&(d=n.path[r-2]):d=n.path[(r-2+l)%l],d&&(d=n.transcoordS2P(d.x,d.y),h=i(d,c))}var p=Math.round((i(c,o)-h)/f)*f+h;o=u(c,p,a(c,o))}n.mutatePath(null,function(e){e[r]=o})}},{key:"ondragend",value:function(){var e=this.active,t=e.component,n=e.changes;c["default"].after(n,t.app.commander),t.parent&&t.parent.calculateBounds&&t.parent.calculateBounds()}},{key:"selected",get:function(){return this.layer.selected}}]),e}();n["default"]=d},{"../../command/command-change":12}],91:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t,n){var r,o,i=e.bounds,a=i.left,u=i.top,s=i.width,l=i.height;switch(t){case c:r=a,o=u;break;case f:r=a+s/2,o=u;break;case h:r=a+s,o=u;break;case d:r=a+s,o=u+l/2;break;case p:r=a+s,o=u+l;break;case y:r=a+s/2,o=u+l;break;case v:r=a,o=u+l;break;case m:r=a,o=u+l/2}var g={x:r,y:o},_=e.transcoordT2S(n.x,n.y);return{dx:_.x-g.x,dy:_.y-g.y}}function i(e,t,n,r,o,i){var a=e.bounds,u=a.left,s=a.top,l=a.width,g=a.height,_={left:u,top:s,width:l,height:g};switch(t){case c:u+=r,s+=o,l-=r,g-=o;break;case f:s+=o,g-=o;break;case h:s+=o,l+=r,g-=o;break;case d:l+=r;break;case p:l+=r,g+=o;break;case y:g+=o;break;case v:u+=r,l-=r,g+=o;break;case m:u+=r,l-=r}e.mutateBounds(function(){return Math.abs(l)<=.001&&(l=.001),Math.abs(g)<=.001&&(g=.001),e.adjustResize({left:u,top:s,width:l,height:g},_,n)},this),!i&&e.parent&&e.parent.calculateBounds&&e.parent.calculateBounds()}function a(e){var t=e.left,n=e.top,r=e.width,o=e.height,i=t+r/2,a=n+o/2,u=t+r,s=n+o;return[{x:t,y:n},{x:i,y:n},{x:u,y:n},{x:u,y:a},{x:u,y:s},{x:i,y:s},{x:t,y:s},{x:t,y:a}]}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=4,l=8,c=0,f=1,h=2,d=3,p=4,y=5,v=6,m=7,g=function(){function e(t){r(this,e),this.layer=t}return u(e,[{key:"reset",value:function(){this.active=null}},{key:"contains",value:function(e,t,n,r){var o=this;return n.resizable?(a(n.bounds).every(function(i,a){return Math.abs(e-i.x)<=s/r.x&&Math.abs(t-i.y)<=s/r.y&&(o.active={component:n,index:a}),!o.active}),!!this.active):!1}},{key:"draw",value:function(e,t,n){if(!t.isLine()){var r=t.bounds;if(e.beginPath(),e.rect(r.left,r.top,r.width,r.height),e.setLineDash([3/n.x,4/n.y]),e.lineWidth=1/n.x,e.strokeStyle="black",e.stroke(),e.setLineDash([]),t.resizable){var o=this.active;a(r).forEach(function(r,i){e.beginPath(),e.rect(r.x-s/n.x,r.y-s/n.y,l/n.x,l/n.y),e.setLineDash([0,0]),e.strokeStyle="#656565",e.stroke(),e.fillStyle="#fff",o&&o.component===t&&o.index===i&&(e.strokeStyle="#fa7703",o.focus&&(e.fillStyle="#ffb80c")),e.fill(),e.stroke()})}}}},{key:"onmousedown",value:function(){this.active.focus=!0}},{key:"ondragstart",value:function(){var e=this.active.component;this.active.bounds=e.bounds,this.active.boundsList=this.layer.selected.filter(function(e){return e.resizable}).map(function(e){return e.bounds})}},{key:"ondragmove",value:function(e){var t=this.active,n=t.component,r=t.index,a=t.boundsList,u=this.layer.transcoordC2S(e.offsetX,e.offsetY);n.bounds=this.active.bounds;var s=o(n,r,u);this.layer.selected.filter(function(e){return e.resizable}).forEach(function(t,n){t.bounds=a[n],i(t,r,e.shiftKey,s.dx,s.dy,!0)})}},{key:"ondragend",value:function(){var e=this.active.component;e.app.commander.execute(null,!1)}},{key:"selected",get:function(){return this.layer.selected}}]),e}();n["default"]=g},{}],92:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){var n=e.bounds;return{x:n.left+n.width/2,y:n.top-c/t.y}}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("../../components/component"),s=(r(u),e("../../command/command-change")),l=(r(s),4),c=20,f=2*Math.PI,h=Math.PI/2,d=function(){function e(t){o(this,e),this.layer=t}return a(e,[{key:"reset",value:function(){this.active=null}},{key:"contains",value:function(e,t,n,r){if(!n.rotatable)return!1;var o=i(n,r);return Math.abs(e-o.x)<=l/r.x&&Math.abs(t-o.y)<=l/r.y?(this.active={component:n},!0):!1}},{key:"draw",value:function(e,t,n){if(t.rotatable){e.beginPath();var r=i(t,n);e.lineWidth=1.5/n.x,e.moveTo(r.x,r.y+c/n.y),e.lineTo(r.x,r.y),e.strokeStyle="#656565",e.stroke(),e.beginPath(),e.ellipse(r.x,r.y,l/n.x,l/n.y,0,0,f,!0),e.stroke(),e.fillStyle="#fff",e.fill();var o=this.active;o&&o.component===t&&(e.strokeStyle="#fa7703",e.stroke(),o.toFill&&(e.fillStyle="#ffb80c",e.fill()))}}},{key:"onmousedown",value:function(){this.active.toFill=!0}},{key:"ondragstart",value:function(){{var e=this.active;e.component}e.start_rotation=e.component.get("rotation"),e.rotations=this.layer.selected.filter(function(e){return e.rotatable}).map(function(e){return e.get("rotation")})}},{key:"ondragmove",value:function(e){var t=this.active.component,n=t.transcoordC2S(e.offsetX,e.offsetY);n=t.transcoordS2P(n.x,n.y);var r=t.rotatePoint,o=t.get("rotation")||0,i=Math.atan((r.y-n.y)/(r.x-n.x));i=r.x>=n.x?i-h:h+i;var a=i-o;this.layer.selected.filter(function(e){return e.rotatable}).forEach(function(t){var n=((t.get("rotation")||0)+a)%f;t.set("rotation",t.adjustRotation(n,e.shiftKey))})}},{key:"ondragend",value:function(){{var e=this.active,t=e.component;e.rotations}t.app.commander.execute(null,!1)}},{key:"selected",get:function(){return this.layer.selected}}]),e}();n["default"]=d},{"../../command/command-change":12,"../../components/component":17}],93:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../components/component"),c=o(l),f=e("../components/group"),h=(o(f),e("./layer")),d=o(h),p=e("./modeler"),y=r(p),v=e("../command/command-change"),m=o(v),g=e("../const"),_=r(g),b=function(e){function t(e,n){i(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=new y.PathHandler(r),u=new y.ControlHandler(r),s=new y.Resizer(r),l=new y.Rotator(r);return r._modelers=[o,u,s,l],r._control_mode_modelers=[u,o,s,l],r.focusOutline=new y.FocusOutline(r),r.groupOutline=new y.GroupOutline(r),r._reversed_modelers=r._modelers.slice().reverse(),r._control_mode_reverse_modelers=r._control_mode_modelers.slice().reverse(),r}return u(t,e),s(t,[{key:"added",value:function(){var e=this.rootModel,t=e.get("translate"),n=e.get("scale");this.set("translate",t),this.set("scale",n)}},{key:"contains",value:function(e,t){this.modelers.forEach(function(e){return e.reset()});for(var n=this.selected.filter(function(e){return!!e.parent}),r=this.get("scale")||{x:1,y:1},o=0;o<n.length;o++)for(var i=n[o],a=i.transcoordT2S(e,t),u=0;u<this.modelers.length;u++){var s=this.modelers[u];if(s.contains(a.x,a.y,i,r))return this.currentModeler=s,!0}return!1}},{key:"_componentDrawer",value:function(e,t,n,r){var o=[],i=t.parent;if(t.isRootModel())return e.save(),r(e,t,n),void e.restore();for(;i&&!i.isRootModel();)o.push(i),i=i.parent;e.save(),o.reverse().forEach(function(t){var n=t.rotatePoint;e.translate(n.x,n.y);var r=t.get("scale");r&&e.scale(r.x,r.y),e.rotate(t.get("rotation")),e.translate(-n.x,-n.y);var o=t.bounds;e.translate(o.left,o.top)});var a=t.rotatePoint;e.translate(a.x,a.y);var u=t.get("scale");u&&e.scale(u.x,u.y),e.rotate(t.get("rotation")),e.translate(-a.x,-a.y),r(e,t,n),e.restore()}},{key:"_pre_draw",value:function(e){var t=this.model,n=t.translate,r=t.scale,o=void 0===r?{x:1,y:1}:r,i=t.rotation;e.save(),e.beginPath(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.rect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="black",e.globalAlpha=.5,e.fill(),e.restore(),n&&e.translate(n.x*_.DPPX,n.y*_.DPPX),e.scale(o.x*_.DPPX,o.y*_.DPPX),i&&e.rotate(i),e.clearRect(0,0,this.rootModel.get("width"),this.rootModel.get("height"))}},{key:"_draw",value:function(e){var t=this;e.beginPath();var n=this.get("scale")||{x:1,y:1},r=this.selected.filter(function(e){return!!e.parent});if(this.focused&&this._componentDrawer(e,this.focused,n,function(e,n,r){t.focusOutline.draw(e,n,r)}),r.length>0&&r[0].parent.isGroup()){for(var o=r[0].parent;o.parent.isGroup();)o=o.parent;this._componentDrawer(e,o,n,function(e,n,r){t.groupOutline.draw(e,n,r)})}r.forEach(function(r){t._componentDrawer(e,r,n,function(e,n,r){t.reversedModelers.forEach(function(t){return t.draw(e,n,r)})})})}},{key:"onkeydown",value:function(e){"Alt"==e.key&&(this._control_mode=!0,this.invalidate())}},{key:"onkeyup",value:function(e){"Alt"==e.key&&(this._control_mode=!1,this.invalidate())}},{key:"onselected",value:function(){this.invalidate()}},{key:"onchange_model",value:function(e,t,n){var r=n.origin,o=n.deliverer;r===o&&(e.translate&&this.set("translate",e.translate),void 0!==e.rotation&&this.set("rotation",e.rotation),e.scale&&this.set("scale",e.scale)),this.invalidate()}},{key:"ondblclick",value:function(e){"function"==typeof this.currentModeler.ondblclick&&this.currentModeler.ondblclick(e),this.invalidate()}},{key:"onmousedown",value:function(e){this.currentModeler.onmousedown(e),this.invalidate()}},{key:"onmouseup",value:function(e){"function"==typeof this.currentModeler.onmouseup&&this.currentModeler.onmouseup(e),this.invalidate()}},{key:"onmouseenter",value:function(){this.invalidate()}},{key:"onmouseleave",value:function(){this.invalidate()}},{key:"ondragstart",value:function(e){this.currentModeler.ondragstart(e)}},{key:"ondragmove",value:function(e){this.currentModeler.ondragmove(e),this.invalidate()}},{key:"ondragend",value:function(e){this.currentModeler.ondragend(e),this.invalidate()}},{key:"onwheel_scale",value:function(e,t){if(0!=e.deltaY||0!=e.deltaX){var n=t.deliverer;if(e.shiftKey){if(-1!=navigator.userAgent.indexOf("Win"))var r=e.deltaY<0?1:-1;else var r=e.deltaX<0?1:-1;m["default"].around(n.selected,this.app.commander,function(){n.selected.forEach(function(e){var t=e.get("fontSize")||_.DEFAULT.FONT_SIZE;1>t&&(t=1),t+=r,e.set("fontSize",t)})})}else{var r=e.deltaY<0?1:-1,o=n.get("scale")||{
x:1,y:1},i=n.get("translate"),a=e.offsetX,u=e.offsetY,s=n.transcoordC2S(a,u),l=.2*r,c={x:o.x+l,y:o.y+l};if(0>r&&o.x<.3||r>0&&o.x>10)return;n.set("scale",c);var f=n.transcoordC2S(a,u);n.set("translate",{x:i.x+(f.x-s.x)*c.x,y:i.y+(f.y-s.y)*c.y})}}}},{key:"modelers",get:function(){return this._control_mode?this._control_mode_modelers:this._modelers}},{key:"reversedModelers",get:function(){return this._control_mode?this._control_mode_reverse_modelers:this._reversed_modelers}},{key:"eventMap",get:function(){return{"model-layer":{"(all)":{change:this.onchange_model,wheel:this.onwheel_scale}},"(root)":{"(self)":{selected:this.onselected,keydown:this.onkeydown,keyup:this.onkeyup}}}}}]),t}(d["default"]);n["default"]=b,c["default"].register("modeling-layer",b)},{"../command/command-change":12,"../components/component":17,"../components/group":34,"../const":56,"./layer":84,"./modeler":89}],94:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t,n){var r,o,i,a,u=t.sx,s=t.sy,l=t.ex,c=t.ey;if(u>l?(r=l,o=u):(r=u,o=l),s>c?(i=c,a=s):(i=s,a=c),n){var f=e.bounds,h=e.transcoordS2TR(f.left,f.top),d=e.transcoordS2TR(f.left+f.width,f.top+f.height),p=h.x,y=d.x,v=h.y,g=d.y,_=Math.min(r,p,o,y),b=Math.max(r,p,o,y),w=Math.min(i,v,a,g),k=Math.max(i,v,a,g);return b-_>Math.abs(o-r)+Math.abs(y-p)?!1:k-w>Math.abs(a-i)+Math.abs(g-v)?!1:!0}var x=e.path;if(!x)return m.error("컴포넌트에 get path가 잘못 구현되어있음.",e),!1;for(var O=0;O<x.length;O++){var P=e.transcoordS2TR(x[O].x,x[O].y);if(r>P.x||o<P.x||i>P.y||a<P.y)return!1}return!0}function s(e,t,n,r){var o=e.selected,i=r?o.slice(0):[];r&&i.length>0?t=i[0].parent:t.isContainer()||(t=t.parent);var a=t.layout.capturables(t),s=!!t.layout.joinType;if(r&&n.selected.forEach(function(e){i.splice(i.indexOf(e),1)}),n.selected=[],a.forEach(function(e){e.capturable&&u(e,n,s)&&-1==i.indexOf(e)&&n.selected.push(e)}),i=i.concat(n.selected),o.length!==i.length)e.selected=i;else for(var l=0;l<i.length;l++)if(o[l]!=i[l]){e.selected=i;break}}function l(e,t,n,r,o){o||s(e,t,n,r)}Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=e("../components/component"),h=r(f),d=e("../components/container"),p=(r(d),e("../components/group")),y=(r(p),e("./layer")),v=r(y),m=e("../core/logger"),g=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),c(t,[{key:"added",value:function(){var e=this.rootModel,t=e.get("translate"),n=e.get("scale");this.set("translate",t),this.set("scale",n)}},{key:"contains",value:function(){return!1}},{key:"_draw",value:function(e){var t=this.selbox;if(t){var n=t.sx,r=t.sy,o=t.ex,i=t.ey,a=this.get("scale")||{x:1,y:1};e.beginPath(),e.rect(n,r,o-n,i-r),e.setLineDash([2/a.x,4/a.y]),e.lineWidth=1/a.x,e.strokeStyle="black",e.stroke()}}},{key:"onkeydown",value:function(e,t){var n=(t.origin,t.deliverer),r=n.selected;if(1!=r.length)return!1;var o=r[0],i=o.parent;if(!i||i===n)return!1;if("Tab"==e.code){if("Tab"!=e.code)return!1;var a=i.layout.capturables(i),u=a.indexOf(o);if(-1==u){if(!i.indexOf(o))return m.warn("Container not contains [",o,"] as a component"),!1;u=0}var s=a.length;e.shiftKey?u--:u++,o=a[(u+s)%s]}else{if(!i.layout.keyNavigate)return!1;o=i.layout.keyNavigate(i,o,e)||o}n.selected=[o],e.preventDefault()}},{key:"onchange_root_model",value:function(e){e.translate&&this.set("translate",e.translate),e.scale&&this.set("scale",e.scale)}},{key:"_pendingDecision",value:function(e){this.downpoint={x:e.offsetX,y:e.offsetY}}},{key:"_selectGroupItem",value:function(e,t){for(var n=this.selected.indexOf(e),r=e.parent;r.parent.isGroup();)r=r.parent;var o=[],i=!1,a=!1;if(this.selected.forEach(function(e){var t=e.parent;if(e===r)return void(a=!0);for(;t.parent.isGroup();)t=t.parent;t===r&&(o.push(e),i=!0)}),i)if(t.shiftKey){if(-1!=n)return void this._pendingDecision(t);o.push(e)}else{if(-1!=n)return void this._pendingDecision(t);o=[e]}else if(a)return void this._pendingDecision(t);this.selected=o}},{key:"onmousedown_comp",value:function(e,t){var n=t.origin;if(this.downpoint=null,e.shiftKey){if(-1!=this.selected.indexOf(n))return void this._pendingDecision(e);var r=this.selected.filter(function(e){return!e.isRootModel()&&!!e.parent}),o=r.length>0&&r[0].parent;if(o&&o!==n.parent)return void(n.parent.isGroup()&&this._pendingDecision(e));r.push(n),this.selected=r}else{if(n.parent.isGroup())return void this._selectGroupItem(n,e);if(-1!=this.selected.indexOf(n))return;this.selected=[n]}}},{key:"onmouseup_comp",value:function(e,t){if(this.downpoint&&this.downpoint.x===e.offsetX&&this.downpoint.y===e.offsetY){var n=t.origin,r=this.selected.indexOf(n);if(-1==r&&n.parent.isGroup()&&(r=this.selected.indexOf(n.parent)),-1!==r&&e.shiftKey){var o=this.selected.slice();return r>-1&&o.splice(r,1),void(this.selected=o)}return n.parent.isGroup()?void(this.selected=[n]):void 0}}},{key:"ondragstart_selbox",value:function(e,t){var n=t.origin;if(n.stuck){var r=this.transcoordC2S(e.offsetX,e.offsetY),o=r.x,i=r.y;this.selbox={sx:o,sy:i,selected:[]}}}},{key:"ondragmove_selbox",value:function(e,t){var n=t.origin;if(n.stuck){{var r=this.transcoordC2S(e.offsetX,e.offsetY),o=r.x,i=r.y;t.deliverer}if(this.selbox){this.selbox.ex=o,this.selbox.ey=i;l(this,n,this.selbox,e.shiftKey),this.invalidate()}}}},{key:"ondragend_selbox",value:function(e,t){var n=t.origin;n.stuck&&(this.last_pos=null,this.selbox=null,l(this,null,null,!1,!0),this.invalidate())}},{key:"eventMap",get:function(){return{"(root)":{"(self)":{keydown:this.onkeydown}},"model-layer":{"(self)":{change:this.onchange_root_model},"(all)":{dragstart:this.ondragstart_selbox,dragmove:this.ondragmove_selbox,dragend:this.ondragend_selbox,mousedown:this.onmousedown_comp,mouseup:this.onmouseup_comp}}}}}]),t}(v["default"]);n["default"]=g,h["default"].register("selection-layer",g)},{"../components/component":17,"../components/container":18,"../components/group":34,"../core/logger":62,"./layer":84}],95:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../components/component"),c=o(l),f=e("./layer"),h=o(f),d=e("../const"),p=r(d),y=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u(t,e),s(t,[{key:"added",value:function(){var e=this.rootModel.get("translate");this.set("translate",e)}},{key:"_draw",value:function(){}},{key:"contains",value:function(){return!(this.app.mode!=p.MODE_SHIFT)}},{key:"onkeydown",value:function(e){32==e.keyCode&&void 0===this.before_mode&&(this.before_mode=this.app.mode,this.app.mode=p.MODE_SHIFT)}},{key:"onkeyup",value:function(e){32==e.keyCode&&(void 0!=this.before_mode&&(this.app.mode=this.before_mode),delete this.before_mode)}},{key:"ondragstart",value:function(e){this.last_position=this.transcoordC2S(e.offsetX,e.offsetY)}},{key:"ondragmove",value:function(e){var t=this.transcoordC2S(e.offsetX,e.offsetY),n=t.x,r=t.y;this.rootModel.move({x:n-this.last_position.x,y:r-this.last_position.y}),this.last_position=this.transcoordC2S(e.offsetX,e.offsetY)}},{key:"eventMap",get:function(){return{"(root)":{"(self)":{keydown:this.onkeydown,keyup:this.onkeyup}}}}}]),t}(h["default"]);n["default"]=y,c["default"].register("shift-layer",y)},{"../components/component":17,"../const":56,"./layer":84}],96:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../components/component"),c=o(l),f=e("./layer"),h=o(f),d=e("../const"),p=(r(d),225*Math.PI/180),y=135*Math.PI/180,v=function(e){function t(e,n){i(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r._anim_alpha=1,r}return u(t,e),s(t,[{key:"_drawArrow",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,o=n.x-t.x,i=n.y-t.y,a=Math.atan2(i,o),u=n.x+r*Math.cos(a+p),s=n.y+r*Math.sin(a+p),l=n.x+r*Math.cos(a+y),c=n.y+r*Math.sin(a+y);e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(n.x,n.y),e.moveTo(n.x,n.y),e.lineTo(u,s),e.moveTo(n.x,n.y),e.lineTo(l,c),e.stroke()}},{key:"animOnTargetChange",value:function(e){var t=this;e!=this._lastTargets&&(this._lastTargets=e,this._anim_alpha=1,this.animate({step:function(e){t._anim_alpha=1-e,t.invalidate()},duration:3e3,delta:"circ",options:{x:1},ease:"out"}).start())}},{key:"_draw",value:function(e){var t=this;this.animOnTargetChange(this.targets),this.targets&&this.targets.filter(function(e){return e.rootModel}).forEach(function(n){var r=[],o=n.get("id"),i=n.get("class"),a=(n.get("type"),n.get("hidden"));if(e.globalAlpha*=t._anim_alpha,o||i){o&&r.push("#"+o),i&&r.push("."+i),a&&r.push(" hidden");var u=r.join(""),s=n.bounds,l=s.left,c=s.top,f=n.transcoordS2C(l,c,n.rootModel),h=f.x,d=f.y;h=Math.max(h,0),d=Math.max(d-18,0),e.font="12px Arial";var p=e.measureText(u);e.fillStyle="#FF0000",e.fillRect(h,d,p.width+6,16),e.fillStyle="white",e.fillText(u,h+3,d+13)}e.lineWidth=2,e.strokeStyle="orange",n.mappings&&n.mappings.forEach(function(r){var o=t.root.findAll(r.target,n);o&&o.forEach(function(r){var o=n.center,i=r.center;o=n.transcoordS2C(o.x,o.y,n.rootModel),i=r.transcoordS2C(i.x,i.y,r.rootModel),t._drawArrow(e,o,i)})})})}},{key:"_ontag",value:function(e){this.targets&&-1!==this.targets.lastIndexOf(e)||(this.targets=(this.targets||[]).concat(e))}},{key:"_offtag",value:function(e){if(this.targets){var t=this.targets.slice();t.splice(this.targets.lastIndexOf(e),1),this.targets=t}}},{key:"_resettag",value:function(){this.targets=[]}},{key:"ontagreset",value:function(){this._resettag()}},{key:"ontag",value:function(e,t){this._ontag(t.origin)}},{key:"offtag",value:function(e,t){this._offtag(t.origin)}},{key:"onmouseenter",value:function(e,t){this._resettag(),this._ontag(t.origin)}},{key:"onmouseleave",value:function(){this._resettag()}},{key:"onchange",value:function(){this.targets=this.root.selected}},{key:"targets",get:function(){return this._targets},set:function(e){this._targets=e&&e.filter(function(e){return!e.isLayer()}),this.invalidate()}},{key:"eventMap",get:function(){return{"model-layer":{"(all)":{change:this.onchange},"(descendant)":{tag:this.ontag,tagreset:this.ontagreset,mouseenter:this.onmouseenter,mouseleave:this.onmouseleave}},"(root)":{"(self)":{}}}}}]),t}(h["default"]);n["default"]=v,c["default"].register("tag-layer",v)},{"../components/component":17,"../const":56,"./layer":84}],97:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./layout"),i=r(o),a={reflow:function(){},capturables:function(e){return e.components},drawables:function(e){return e.components.filter(function(e){return!e.hidden})},isStuck:function(){return!1}};i["default"].register("absolute",a),n["default"]=a},{"./layout":100}],98:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){var t=e.components.filter(function(e){return!e.hidden}),n=e.get("layoutConfig"),r=t[n&&n.activeIndex||0];return r&&[r]||[]}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./layout"),a=r(i),u={reflow:function(e){var t=e.bounds,n={left:0,top:0,width:t.width,height:t.height};e.forEach(function(e){e.bounds=n,e.set("rotation",0)})},capturables:function(e){return o(e)},drawables:function(e){return o(e)},isStuck:function(){return!0}};a["default"].register("card",u),n["default"]=u},{"./layout":100}],99:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./layout");Object.defineProperty(n,"Layout",{enumerable:!0,get:function(){return r(o)["default"]}});var i=e("./absolute");Object.defineProperty(n,"AbsoluteLayout",{enumerable:!0,get:function(){return r(i)["default"]}});var a=e("./card");Object.defineProperty(n,"CardLayout",{enumerable:!0,get:function(){return r(a)["default"]}});var u=e("./linear-horizontal");Object.defineProperty(n,"LinearHorizontalLayout",{enumerable:!0,get:function(){return r(u)["default"]}});var s=e("./linear-vertical");Object.defineProperty(n,"LinearVerticalLayout",{enumerable:!0,get:function(){return r(s)["default"]}})},{"./absolute":97,"./card":98,"./layout":100,"./linear-horizontal":101,"./linear-vertical":102}],100:[function(e,t,n){"use strict";function r(e,t){u[e]=t}function o(e){delete u[e]}function i(e){if(e){var t=u[e];return t||a.error("Layout Not Found - ",e),t}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../core/logger"),u={};n["default"]={register:r,unregister:o,get:i}},{"../core/logger":62}],101:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){var t=e.get("layoutConfig");return t?t.weight||1:1}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./layout"),a=r(i),u={reflow:function(e){var t=this.drawables(e),n=e.get("padding")||{},r=t.reduce(function(e,t){return e+o(t)},0),i=e.bounds,a=r>0?(i.width-((n.left||0)+(n.right||0)))/r:i.width,u=i.height-((n.top||0)+(n.bottom||0)),s=0;t.forEach(function(e){var t=o(e),r=e.get("margin")||{};e.bounds={left:a*s+(n.left||0)+(r.left||0),top:0+(n.top||0)+(r.top||0),width:t*a-((r.left||0)+(r.right||0)),height:u-((r.top||0)+(r.bottom||0))},e.set("rotation",0),s+=t})},capturables:function(e){return e.components},drawables:function(e){return e.components.filter(function(e){return!e.hidden})},isStuck:function(){return!0}};a["default"].register("linear-horizontal",u),n["default"]=u},{"./layout":100}],102:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){var t=e.get("layoutConfig");return t?t.weight||1:1}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./layout"),a=r(i),u={reflow:function(e){var t=this.drawables(e),n=e.get("padding")||{},r=t.reduce(function(e,t){return e+o(t)},0),i=e.bounds,a=r>0?(i.height-((n.top||0)+(n.bottom||0)))/r:i.height,u=i.width-((n.left||0)+(n.right||0)),s=0;t.forEach(function(e){var t=o(e),r=e.get("margin")||{};e.bounds={left:0+(n.left||0)+(r.left||0),top:a*s+(n.top||0)+(r.top||0),width:u-((r.left||0)+(r.right||0)),height:t*a-((r.top||0)+(r.bottom||0))},e.set("rotation",0),s+=t})},capturables:function(e){return e.components},drawables:function(e){return e.components.filter(function(e){return!e.hidden})},isStuck:function(){return!0}};a["default"].register("linear-vertical",u),n["default"]=u},{"./layout":100}],103:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e,t){var n=a.Component.register(e.type);if(!n)return s.warn("Class not found",e.type),null;var r=new n(e,t);return e.components&&r.isContainer()&&(e.components.forEach(function(e){var n=o(e,t);n&&r.addComponent(n)}),delete e.components),r.created(),r}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o;var i=e("../components"),a=r(i),u=e("../layer"),s=(r(u),e("../core/logger"))},{"../components":36,"../core/logger":62,"../layer":83}],104:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){var t=u.clone(e.hierarchy);return"undefined"!=typeof t.id&&delete t.id,a["default"](t,e.app)}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o;var i=e("./compile"),a=r(i),u=e("../core/utils")},{"../core/utils":69,"./compile":103}],105:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./compile");Object.defineProperty(n,"compile",{enumerable:!0,get:function(){return r(o)["default"]}});var i=e("./duplicate");Object.defineProperty(n,"duplicate",{enumerable:!0,get:function(){return r(i)["default"]}});var a=e("./selector");Object.defineProperty(n,"select",{enumerable:!0,get:function(){return a.select}}),Object.defineProperty(n,"match",{enumerable:!0,get:function(){return a.match}})},{"./compile":103,"./duplicate":104,"./selector":106}],106:[function(e,t,n){"use strict";function r(e,t){return e.substr(1)==t.get("id")}function o(e,t){var n=t.get("class");if(!n)return!1;var r=n.split(" ")||[];return r.indexOf(e.substr(1))>=0}function i(e,t,n,r){switch(e){case"(all)":return!0;case"(self)":return r===t;case"(root)":return!r.parent&&r===t;case"(descendant)":return r!==t;case"(child)":return r===t.parent;default:return!1}}function a(e,t){return e==t.get("type")}function u(e,t,n,u){if("(all)"==e)return!0;switch(e.charAt(0)){case"#":return r(e,t,n,u);case".":return o(e,t,n,u);case"(":return i(e,t,n,u);default:return a(e,t,n,u)}}function s(e,t,n,r,o,i){return e(t,n,r,o)&&i.push(n),n.components&&n.components.forEach(function(n){s(e,t,n,r,o,i)}),i}function l(e,t,n){switch(e){case"(all)":return!0;case"(parent)":return n&&n.parent===t;case"(child)":case"(children)":return n&&n===t.parent;case"(sibling)":case"(siblings)":return n&&n.parent===t.parent&&n!==t;default:return!1}}function c(e,t,n){if("(root)"==e)return[t];if("(self)"==e)return n?[n]:[];var r;switch(e.charAt(0)){case"#":var i=t.root.findById(e.substr(1));return i?[i]:[];case".":r=o;break;case"(":r=l;break;default:r=a}return s(r,e,t,n,t,[])}Object.defineProperty(n,"__esModule",{value:!0}),n.match=u,n.select=c},{}],107:[function(e,t,n){"use strict";function r(e){return e}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r},{}],108:[function(e,t,n){arguments[4][11][0].apply(n,arguments)},{"./compile":107,dup:11}],109:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t,n){e instanceof Array||(e=[e]),n||(n=this.model_layer);var r=[];this.selected=e.map(function(e){var o=t.left,i=t.top,a=t.width,s=t.height,l=t.x,c=t.y,f=t.cx,h=t.cy,d=u.compile(e,n.app);return isNaN(o)||isNaN(i)||isNaN(a)||isNaN(s)||(d.bounds={left:o,top:i,width:a,height:s}),isNaN(l)||isNaN(c)||d.move({x:l,y:c}),isNaN(f)||isNaN(h)||(d.center={x:f,y:h}),r.push({component:d,to_container:n}),d}),this.app.commander.execute(new l["default"]({changes:r}))}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=i;var a=e("../../model"),u=o(a),s=e("../../command/command-migrate"),l=r(s)},{"../../command/command-migrate":13,"../../model":105}],110:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){for(var n=JSON.parse(JSON.stringify(t[0].bounds)),r=n.left+n.width,o=n.top+n.height,i=0;i<t.length;i++){var a=t[i].bounds;n.left=a.left>n.left?n.left:a.left,n.top=a.top>n.top?n.top:a.top,r=a.left+a.width>r?a.left+a.width:r,o=a.top+a.height>o?a.top+a.height:o}switch(n.width=r-n.left,n.height=o-n.top,e){case s:for(var u=0;u<t.length;u++){var p=t[u].bounds;t[u].bounds={left:n.left,top:p.top,width:p.width,height:p.height}}break;case c:for(var y=0;y<t.length;y++){var v=t[y].bounds;t[y].bounds={left:n.left+n.width/2-v.width/2,top:v.top,width:v.width,height:v.height}}break;case l:for(var m=0;m<t.length;m++){var g=t[m].bounds;t[m].bounds={left:r-g.width,top:g.top,width:g.width,height:g.height}}break;case f:for(var _=0;_<t.length;_++){var b=t[_].bounds;t[_].bounds={left:b.left,top:n.top,width:b.width,height:b.height}}break;case d:for(var w=0;w<t.length;w++){var k=t[w].bounds;t[w].bounds={left:k.left,top:n.top+n.height/2-k.height/2,width:k.width,height:k.height}}break;case h:for(var x=0;x<t.length;x++){var O=t[x].bounds;t[x].bounds={left:O.left,top:o-O.height,width:O.width,height:O.height}}break;default:return}}function i(e){if(-1!=p.indexOf(e)){var t=this.selected.filter(function(e){return!e.stuck});if(!(t.length<=1)){var n=this.app.commander;u["default"].around(t,n,function(){o(e,t)})}}}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=i;var a=e("../../command/command-change"),u=r(a),s="left",l="right",c="center",f="top",h="bottom",d="middle",p=[s,l,c,f,d,h]},{"../../command/command-change":12}],111:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n){var r=this.findAll(e,n);return r.forEach(function(e){e.set(t)}),r}function i(e){u["default"].around(null,this.app.commander,e)}Object.defineProperty(n,"__esModule",{value:!0}),n.change=o,n.undoableChange=i;var a=e("../../command/command-change"),u=r(a)},{"../../command/command-change":12}],112:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(){var e=this.selected;if(0!=e.length){var t=e.filter(function(e){return!e.isRootModel()}).map(function(e){return e.hierarchy});0!=t.length&&(d=0,s["default"].put(t))}}function i(){d=0,o.call(this),c["default"].call(this)}function a(){var e=s["default"].get();e&&(d++,h["default"].call(this,e,{x:15*d,y:15*d}))}Object.defineProperty(n,"__esModule",{value:!0}),n.copy=o,n.cut=i,n.paste=a;var u=e("../clipboard"),s=r(u),l=e("./remove"),c=r(l),f=e("./add"),h=r(f),d=0},{"../clipboard":126,"./add":109,"./remove":120}],113:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=t.filter(function(e){return!e.stuck}).slice(0);n.sort(function(t,n){var r=t.center,o=n.center;return e===s?r.y-o.y:r.x-o.x});for(var r=n.reduce(function(t,n){return t+(e===s?n.bounds.height:n.bounds.width)},0),o=n[0].bounds,i=n[n.length-1].bounds,a=e===s?i.top+i.height-o.top:i.left+i.width-o.left,u=(a-r)/(n.length-1),l=e===s?o.top+o.height:o.left+o.width,c=1;c<n.length-1;c++){var f=n[c],h=f.bounds;l+=u,e===s?(h.top=l,l+=h.height):(h.left=l,l+=h.width),f.bounds=h}}function i(e){if(-1!=c.indexOf(e)){var t=this.selected;if(!(t.length<=1)){var n=this.app.commander;u["default"].around(t,n,function(){o(e,t)})}}}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=i;var a=e("../../command/command-change"),u=r(a),s="VERTICAL",l="HORIZONTAL",c=[s,l]},{"../../command/command-change":12}],114:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(){var e=[];if(this.selected=this.selected.filter(function(e){return!e.isRootModel()}).map(function(t){var n=u.duplicate(t);return n.move({x:20,y:20}),e.push({component:n,to_container:t.parent}),n}),0!=e.length){var t=new l["default"]({changes:e});this.app.commander.execute(t)}}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=i;var a=e("../../model"),u=o(a),s=e("../../command/command-migrate"),l=r(s)},{"../../command/command-migrate":13,"../../model":105}],115:[function(e,t,n){"use strict";function r(e,t){var n=e.unitScale;t.set("scale",{x:n,y:n}),t.set("translate",{x:0,y:0})}function o(e,t,n){var r=t.model,o=r.width,i=r.height,a=n.offsetWidth,u=n.offsetHeight;t.set("scale",{x:a/o,y:u/i}),t.set("translate",{x:0,y:0})}function i(e,t,n){var r=e.unitScale,o=t.model,i=o.width,a=o.height;t.set("scale",{x:r,y:r}),t.set("translate",{x:Math.max((n.offsetWidth-i*r)/2,0),y:Math.max((n.offsetHeight-a*r)/2,0)})}function a(e,t,n){var r=n.offsetWidth/t.get("width");t.set("scale",{x:r,y:r}),t.set("translate",{x:0,y:0})}function u(e,t,n){var r=n.offsetHeight/t.get("height");t.set("scale",{x:r,y:r}),t.set("translate",{x:0,y:0})}function s(e,t,n){var r=t.model,o=r.width,i=r.height,a=n.offsetWidth,u=n.offsetHeight,s=a/o,l=u/i,c=Math.min(s,l);t.set("scale",{x:c,y:c}),t.set("translate",{x:(a-o*c)/2,y:(u-i*c)/2})}function l(e){var t=this.model_layer.model,n=t.width,l=t.height,c=this.target_element,f=this.model_layer;if(!n||!l||!c)return void r(this,f,c);switch(e){case"center":i(this,f,c);break;case"both":o(this,f,c);break;case"width":a(this,f,c);break;case"height":u(this,f,c);break;case"ratio":s(this,f,c);break;case"none":default:r(this,f,c)}}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=l},{}],116:[function(e,t,n){"use strict";function r(e){var e=this.target_element;e.requestFullScreen?e.requestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen&&e.mozRequestFullScreen()}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r},{}],117:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(){var e=this.selected.filter(function(e){return!!e.parent&&!e.stuck});if(!(e.length<2)){var t=e[0].parent,n=[],r=e.sort(function(e,n){return t.components.indexOf(e)-t.components.indexOf(n)});r.forEach(function(e){n.push(e.bounds)});var o=s["default"].union(n),i=e[0].transcoordP2S(o.left,o.top);i=e[0].transcoordS2T(i.x,i.y);var a=c.compile({type:"group",left:i.x,top:i.y,width:o.width,height:o.height}),u=[{component:a,to_container:t}];r.forEach(function(e){u.push({component:e,to_container:a})}),this.app.commander.execute(new h["default"]({changes:u})),this.selected=[a]}}function a(){var e=this.selected;if(0!==e.length){var t=[],n=[];this.selected.forEach(function(e){if(e.isGroup()){var r=e.parent;e.components.forEach(function(e){t.push(e),n.push({component:e,to_container:r})}),n.push({component:e,to_container:null})}}),this.app.commander.execute(new h["default"]({changes:n})),this.selected=t}}Object.defineProperty(n,"__esModule",{value:!0}),n.group=i,n.ungroup=a;var u=e("../../components/component"),s=o(u),l=e("../../model"),c=r(l),f=e("../../command/command-migrate"),h=o(f)},{"../../command/command-migrate":13,"../../components/component":17,"../../model":105}],118:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./align");Object.defineProperty(n,"align",{enumerable:!0,get:function(){return r(o)["default"]}});var i=e("./distribute");Object.defineProperty(n,"distribute",{enumerable:!0,get:function(){return r(i)["default"]}});var a=e("./zorder");Object.defineProperty(n,"zorder",{enumerable:!0,get:function(){return r(a)["default"]}});var u=e("./add");Object.defineProperty(n,"add",{enumerable:!0,get:function(){return r(u)["default"]}});var s=e("./duplicate");Object.defineProperty(n,"duplicate",{enumerable:!0,get:function(){return r(s)["default"]}});var l=e("./remove");Object.defineProperty(n,"remove",{enumerable:!0,get:function(){return r(l)["default"]}});var c=e("./listener");Object.defineProperty(n,"on",{enumerable:!0,get:function(){return c.on}}),Object.defineProperty(n,"once",{enumerable:!0,get:function(){return c.once}}),Object.defineProperty(n,"off",{enumerable:!0,get:function(){return c.off}});var f=e("./fullscreen");Object.defineProperty(n,"fullscreen",{enumerable:!0,get:function(){return r(f)["default"]}});var h=e("./clipboard");Object.defineProperty(n,"cut",{enumerable:!0,get:function(){return h.cut}}),Object.defineProperty(n,"copy",{enumerable:!0,get:function(){return h.copy}}),Object.defineProperty(n,"paste",{enumerable:!0,get:function(){return h.paste}});var d=e("./to-data-url");Object.defineProperty(n,"toDataURL",{enumerable:!0,get:function(){return r(d)["default"]}});var p=e("./group");Object.defineProperty(n,"group",{enumerable:!0,get:function(){return p.group}}),Object.defineProperty(n,"ungroup",{enumerable:!0,get:function(){return p.ungroup}});var y=e("./fit");Object.defineProperty(n,"fit",{enumerable:!0,get:function(){return r(y)["default"]}});var v=e("./symmetry");Object.defineProperty(n,"symmetryX",{enumerable:!0,get:function(){return v.symmetryX}}),Object.defineProperty(n,"symmetryY",{enumerable:!0,get:function(){return v.symmetryY}});var m=e("./change");Object.defineProperty(n,"change",{enumerable:!0,get:function(){return m.change}}),Object.defineProperty(n,"undoableChange",{enumerable:!0,get:function(){return m.undoableChange}}),Object.defineProperty(n,"undoableChangeBefore",{enumerable:!0,get:function(){return m.undoableChangeBefore}}),Object.defineProperty(n,"undoableChangeAfter",{enumerable:!0,get:function(){return m.undoableChangeAfter}}),Object.defineProperty(n,"undoableChangeReset",{enumerable:!0,get:function(){return m.undoableChangeReset}});var g=e("./variables");Object.defineProperty(n,"getIds",{enumerable:!0,get:function(){return g.getIds}}),Object.defineProperty(n,"getVariables",{enumerable:!0,get:function(){return g.getVariables}}),Object.defineProperty(n,"setVariables",{enumerable:!0,get:function(){return g.setVariables}})},{"./add":109,"./align":110,"./change":111,"./clipboard":112,"./distribute":113,"./duplicate":114,"./fit":115,"./fullscreen":116,"./group":117,"./listener":119,"./remove":120,"./symmetry":121,"./to-data-url":122,"./variables":123,"./zorder":124}],119:[function(e,t,n){"use strict";function r(e,t,n){switch(e){case"execute":case"redo":case"undo":case"command-reset":this.app.commander.on(e,t,n);break;case"selected":this.on(e,t,n);break;case"mode":this.app.on(e,t,n);break;default:this.on(e,t,n)}}function o(e,t,n){switch(e){case"execute":case"redo":case"undo":case"command-reset":this.app.commander.once(e,t,n);break;case"selected":this.once(e,t,n);break;case"mode":this.app.once(e,t,n);break;default:this.once(e,t,n)}}function i(e,t,n){switch(e){case"execute":case"redo":case"undo":case"command-reset":this.app.commander.off(e,t,n);

break;case"selected":this.off(e,t,n);break;case"mode":this.app.off(e,t,n);break;default:this.off(e,t,n)}}Object.defineProperty(n,"__esModule",{value:!0}),n.on=r,n.once=o,n.off=i},{}],120:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(){var e=this.selected;this.selected=[];var t=e.filter(function(e){return!e.isRootModel()&&e.parent.focusible}).map(function(e){return{component:e,to_container:null}});t.length>0&&this.app.commander.execute(new a["default"]({changes:t}))}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o;var i=e("../../command/command-migrate"),a=r(i)},{"../../command/command-migrate":13}],121:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(){var e=this.selected;if(0!=e.length){var t=e.map(function(e){return e.bounds}),n=l["default"].union(t),r=n.left+n.width/2;e.map(function(e){e.symmetryX(r)})}}function i(){var e=this.selected;if(0!=e.length){var t=e.map(function(e){return e.bounds}),n=l["default"].union(t),r=n.top+n.height/2;e.map(function(e){e.symmetryY(r)})}}function a(){f["default"].around(this.selected,this.app.commander,o,this)}function u(){f["default"].around(this.selected,this.app.commander,i,this)}Object.defineProperty(n,"__esModule",{value:!0}),n.symmetryX=a,n.symmetryY=u;var s=e("../../components/component"),l=r(s),c=e("../../command/command-change"),f=r(c)},{"../../command/command-change":12,"../../components/component":17}],122:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,n,r){if(this.model_layer){var o=this.model_layer.get("width"),i=this.model_layer.get("height");n=n||o,r=r||i;var a=u["default"].createCanvas(n*c.DPPX,r*c.DPPX),s=this.model_layer.get("translate"),l=this.model_layer.get("scale");this.model_layer.set("translate",{x:0,y:0}),this.model_layer.set("scale",{x:n/o,y:r/i}),this.model_layer.draw(a.getContext("2d"));var f=a.toDataURL(e,t);return this.model_layer.set("translate",s),this.model_layer.set("scale",l),a=null,f}}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=i;var a=e("../../components/component"),u=o(a),s=e("../../model"),l=(r(s),e("../../const")),c=r(l)},{"../../components/component":17,"../../const":56,"../../model":105}],123:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(){return Object.values(this.indexMap).map(function(e){var t=e.model,n=t.id,r=t.data;return{key:n,value:r}}).sort(function(e,t){return e.key>t.key?1:-1})}function i(){return Object.values(this.indexMap).filter(function(e){return"variable"===e.get("type")}).map(function(e){{var t=e.model,n=t.id,r=t.data;t.dataType}return{key:n,value:r}}).sort(function(e,t){return e.key>t.key?1:-1})}function a(e){var t=Object.values(this.indexMap).filter(function(e){return"variable"===e.get("type")}).reduce(function(e,t){return e[t.get("id")]=t,e},{}),n=[];e.forEach(function(e){var r=t[e.key];r?(r.set("data",e.value),delete t[e.key]):n.push({type:"variable",id:e.key,left:0,top:0,width:100,height:20,data:e.value})}),s["default"].call(this,n,{x:-100,y:0}),this.selected=Object.values(t),c["default"].call(this)}Object.defineProperty(n,"__esModule",{value:!0}),n.getIds=o,n.getVariables=i,n.setVariables=a;var u=e("./add"),s=r(u),l=e("./remove"),c=r(l)},{"./add":109,"./remove":120}],124:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){var t=this.selected.filter(function(e){return!e.stuck});if(!(0==t.length||t[0].isRootModel()||t.length>1&&("forward"==e||"backward"==e))){var n,r=t[0].parent;if("forward"==e){var o=r.indexOf(t[0]);n=[{component:t[0],from_container:r,to_container:r,from_index:o,to_index:o+1}]}else if("backward"==e){var i=r.indexOf(t[0]);n=[{component:t[0],from_container:r,to_container:r,from_index:i,to_index:i-1}]}else n=t.filter(function(e){return e.parent===r}).sort(function(t,n){var o=r.indexOf(t)<r.indexOf(n);return"front"==e?o:!o}).map(function(t,n){r.indexOf(t);return{component:t,to_container:r,to_index:"front"==e?r.components.length-n-1:n}});var u=new a["default"]({changes:n});this.app.commander.execute(u)}}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o;var i=e("../../command/command-migrate"),a=r(i)},{"../../command/command-migrate":13}],125:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t,n,r){e>0||(e=1),t>0||(t=1),r||(r="d");var o=("d"==r?Math.sqrt(e*e+t*t):"w"==r?e:t)/n;return o>0?Math.round(o):0}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../core"),l=o(s),c=e("./config"),f=r(c),h=e("../const"),d=o(h),p="$base_url",y=Math.PI/12,v=function(){function e(t,n){i(this,e),this._mode=t,this.screen=f["default"].screen(),this._baseUrl="undefined"!=typeof window?window.location.origin:null,this._refProvider=n,this.isEditMode&&(this._rotateStep=y,this._rotateStepForced=!1)}return u(e,[{key:"dispose",value:function(){}},{key:"_calcScreen",value:function(){var e={width:screen.width,height:screen.height};this._PPI=a(e.width,e.height,this.screen),this._PPM=this._PPI/25.4}},{key:"url",value:function(e){return e.replace(p,this.baseUrl)}},{key:"refProvider",get:function(){return this._refProvider}},{key:"commander",set:function(e){this._commander=e},get:function(){return this._commander}},{key:"screen",get:function(){return this._screen},set:function(e){this._screen=e,this._calcScreen()}},{key:"DPPX",get:function(){return d.DPPX}},{key:"PPI",get:function(){return this._PPI}},{key:"PPM",get:function(){return this._PPM}},{key:"mode",get:function(){return this._mode},set:function(e){var t=this._mode;t!==e&&(this._mode=e,this.trigger("mode",e,t))}},{key:"isViewMode",get:function(){return this._mode==d.MODE_VIEW}},{key:"isEditMode",get:function(){return this._mode==d.MODE_EDIT}},{key:"baseUrl",get:function(){return this._baseUrl},set:function(e){this._baseUrl=e}},{key:"rotateStep",get:function(){return this._rotateStep},set:function(e){this._rotateStep=Number(e)||y}},{key:"rotateStepForced",get:function(){return this._rotateStepForced},set:function(e){this._rotateStepForced=!!e}}]),e}();n["default"]=v,l.mixin(v.prototype,l.event.withEvent)},{"../const":56,"../core":60,"./config":127}],126:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../core"),i=r(o),a=e("../core/utils"),u=null,s={};i.mixin(s,i.event.withEvent),n["default"]={put:function(e){e instanceof Array?u=e.map(function(e){var t=a.clone(e);return delete t.id,t}):(u=a.clone(e),delete u.id),s.trigger("clipboard-put",u)},get:function(){return u instanceof Array?u.map(function(e){return a.clone(e)}):a.clone(u)},reset:function(){u=null,s.trigger("clipboard-reset")}}},{"../core":60,"../core/utils":69}],127:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=13.3;n["default"]={screen:function(e){return"undefined"!=typeof e&&(r=e),r}}},{}],128:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=e.target,n=e.model,r=e.style,o=e.layers,i=void 0===o?[]:o,a=e.handlers,s=void 0===a?[]:a,c=e.mode,h=void 0===c?f.MODE_VIEW:c,p=e.refProvider,y=null;if("string"==typeof t){if(y=document.getElementById(t),!y)throw"target element '"+t+"' is not exist";if(y.firstChild)throw"target element '"+t+"' already has children"}else y=t;return y&&y.style&&(y.style.cursor="default"),new d["default"](new u["default"]({target_element:y,model:n,style:r,layers:i,handlers:s},new l["default"](h,p)))}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=i;var a=e("../components/root-container"),u=o(a),s=e("./application-context"),l=o(s),c=e("../const"),f=r(c),h=e("./scene"),d=o(h)},{"../components/root-container":49,"../const":56,"./application-context":125,"./scene":131}],129:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0}),n.Scene=n.ReferenceMap=n.EventMap=n.Layer=n.Model=n.clipboard=n.create=n.config=n.polyfill=void 0;var i=e("./polyfill");Object.defineProperty(n,"polyfill",{enumerable:!0,get:function(){return o(i)["default"]}});var a=e("./config");Object.defineProperty(n,"config",{enumerable:!0,get:function(){return a.config}});var u=e("./create");Object.defineProperty(n,"create",{enumerable:!0,get:function(){return o(u)["default"]}});var s=e("./clipboard");Object.defineProperty(n,"clipboard",{enumerable:!0,get:function(){return o(s)["default"]}});var l=e("../layer/layer");Object.defineProperty(n,"Layer",{enumerable:!0,get:function(){return o(l)["default"]}});var c=e("../event-map/event-map");Object.defineProperty(n,"EventMap",{enumerable:!0,get:function(){return o(c)["default"]}});var f=e("../const");Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return f[e]}})});var h=e("../components/");Object.keys(h).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return h[e]}})});var d=e("../layout");Object.keys(d).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return d[e]}})});var p=e("../core/reference-map");Object.defineProperty(n,"ReferenceMap",{enumerable:!0,get:function(){return o(p)["default"]}});var y=e("./scene");Object.defineProperty(n,"Scene",{enumerable:!0,get:function(){return o(y)["default"]}});{var v=e("../model"),m=r(v);n.Model=m}},{"../components/":36,"../const":56,"../core/reference-map":65,"../event-map/event-map":73,"../layer/layer":84,"../layout":99,"../model":105,"./clipboard":126,"./config":127,"./create":128,"./polyfill":130,"./scene":131}],130:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n["default"]="done","function"!=typeof Object.assign&&!function(){Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r)for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])}return t}}(),"function"!=typeof Object.values&&!function(){Object.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t}}(),"function"!=typeof Object.keys&&!function(){Object.values=function(e){var t=[];for(var n in e)t.push(n);return t}}(),"undefined"!=typeof CanvasRenderingContext2D&&void 0==CanvasRenderingContext2D.prototype.ellipse&&(CanvasRenderingContext2D.prototype.ellipse=function(e,t,n,r,o,i,a,u){this.save(),this.translate(e,t),this.rotate(o),this.translate(-n,-r),this.scale(n,r),this.arc(1,1,1,i,a,u),this.restore()}),function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),o=window.setTimeout(function(){t(n+r)},r);return e=n+r,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e})},{}],131:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("./api"),s=o(u),l=e("../animation/animate"),c=r(l),f=e("../command/snapshot-commander"),h=r(f),d=function(){function e(t){i(this,e),this._container=t,this._model_layer=t.model_layer,this.app=t.app,this._commander=new h["default"](this._container),this.app.commander=this._commander}return a(e,[{key:"play",value:function(){s.play.apply(this._container,arguments)}},{key:"add",value:function(){return s.add.apply(this._container,arguments)}},{key:"duplicate",value:function(){return s.duplicate.apply(this._container,arguments)}},{key:"remove",value:function(){return s.remove.apply(this._container,arguments)}},{key:"animate",value:function(){return c["default"].apply(this,arguments)}},{key:"fullscreen",value:function(){return s.fullscreen.apply(this._container,arguments)}},{key:"variable",value:function(){return this._container.variable.apply(this._container,arguments)}},{key:"resize",value:function(){this._container.resize()}},{key:"dispose",value:function(){this._commander&&this._commander.dispose(),this._container&&this._container.dispose()}},{key:"select",value:function(e){for(var t,n=arguments.length,r=Array(n>1?n-1:0),o=1;n>o;o++)r[o-1]=arguments[o];return this._container.selected=(t=this._model_layer).findAll.apply(t,[e].concat(r)),this.selected}},{key:"undo",value:function(){this.commander.undo(),this._model_layer=this._container.model_layer,this.root.selected=[]}},{key:"redo",value:function(){this.commander.redo(),this._model_layer=this._container.model_layer,this.root.selected=[]}},{key:"cut",value:function(){return s.cut.apply(this._container,arguments)}},{key:"copy",value:function(){return s.copy.apply(this._container,arguments)}},{key:"paste",value:function(){return s.paste.apply(this._container,arguments)}},{key:"undoableChange",value:function(){return s.undoableChange.apply(this._container,arguments)}},{key:"change",value:function(){return s.change.apply(this._model_layer,arguments)}},{key:"findAll",value:function(){return this._model_layer.findAll.apply(this._model_layer,arguments)}},{key:"findFirst",value:function(){return this._model_layer.findFirst.apply(this._model_layer,arguments)}},{key:"findById",value:function(){return this._container.findById.apply(this._container,arguments)}},{key:"serialize",value:function(){return this._model_layer.trim(),this._model_layer.serialize.apply(this._model_layer,arguments)}},{key:"align",value:function(){return s.align.apply(this._container,arguments)}},{key:"distribute",value:function(){return s.distribute.apply(this._container,arguments)}},{key:"zorder",value:function(){return s.zorder.apply(this._container,arguments)}},{key:"symmetryX",value:function(){return s.symmetryX.apply(this._container,arguments)}},{key:"symmetryY",value:function(){return s.symmetryY.apply(this._container,arguments)}},{key:"on",value:function(){return s.on.apply(this._container,arguments)}},{key:"once",value:function(){return s.once.apply(this._container,arguments)}},{key:"off",value:function(){return s.off.apply(this._container,arguments)}},{key:"toDataURL",value:function(){return s.toDataURL.apply(this._container,arguments)}},{key:"group",value:function(){return s.group.apply(this._container,arguments)}},{key:"ungroup",value:function(){return s.ungroup.apply(this._container,arguments)}},{key:"fit",value:function(){return s.fit.apply(this._container,arguments)}},{key:"target",get:function(){return this._container.target_element},set:function(e){var t;if("string"==typeof e){if(t=document.getElementById(e),!t)throw"target element '"+e+"' is not exist";if(t.firstChild)throw"target element '"+e+"' already has children"}else t=e;t&&t.style&&(t.style.cursor="default"),this._container.target_element=t,this._container.invalidate()}},{key:"scale",get:function(){return this._model_layer.get("scale")},set:function(e){this._model_layer.set("scale",e)}},{key:"translate",get:function(){return this._model_layer.get("translate")},set:function(e){this._model_layer.set("translate",e)}},{key:"unit",get:function(){return this._model_layer.get("unit")||"px"}},{key:"PPM",get:function(){return this.app.PPM}},{key:"PPI",get:function(){return this.app.PPI}},{key:"DPPX",get:function(){return this.app.DPPX}},{key:"unitScale",get:function(){return this._container.unitScale}},{key:"screen",get:function(){return this.app.screen},set:function(e){this.app.screen=e,this._container.resize()}},{key:"selected",get:function(){return this._container.selected.slice()}},{key:"commander",get:function(){return this._commander}},{key:"model",get:function(){return this._model_layer.hierarchy},set:function(e){this._container.rebuildContentModel(e),this._model_layer=this._container.model_layer}},{key:"root",get:function(){return this._model_layer}},{key:"mode",get:function(){return this.app.mode},set:function(e){void 0!==e&&(this.app.mode=e)}},{key:"ids",get:function(){return s.getIds.apply(this._container)}},{key:"variables",get:function(){return s.getVariables.apply(this._container)},set:function(e){s.setVariables.apply(this._container,[e])}}]),e}();n["default"]=d},{"../animation/animate":2,"../command/snapshot-commander":15,"./api":118}]},{},[1]);